var Handlebars=function(){var c=function(){"use strict";function e(e){this.string=e}return e.prototype.toString=function(){return""+this.string},e}(),l=function(){"use strict";var e={},t=c,i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},n=/[&<>"'`]/g,o=/[&<>"'`]/;function s(e){return i[e]||"&amp;"}e.extend=function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])};var r=Object.prototype.toString;e.toString=r;var a=function(e){return"function"==typeof e};a(/x/)&&(a=function(e){return"function"==typeof e&&"[object Function]"===r.call(e)}),e.isFunction=a;var l=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===r.call(e)};return e.isArray=l,e.escapeExpression=function(e){return e instanceof t?e.toString():e||0===e?(e=""+e,o.test(e)?e.replace(n,s):e):""},e.isEmpty=function(e){return!e&&0!==e||!(!l(e)||0!==e.length)},e}(),h=function(){"use strict";var s=["description","fileName","lineNumber","message","name","number","stack"];function e(e,t){var i;t&&t.firstLine&&(e+=" - "+(i=t.firstLine)+":"+t.firstColumn);for(var n=Error.prototype.constructor.call(this,e),o=0;o<s.length;o++)this[s[o]]=n[s[o]];i&&(this.lineNumber=i,this.column=t.firstColumn)}return e.prototype=new Error,e}(),u=function(){"use strict";var e={},n=l,s=h;e.VERSION="1.3.0";e.COMPILER_REVISION=4;e.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};var c=n.isArray,d=n.isFunction,o=n.toString,r="[object Object]";function t(e,t){var o;this.helpers=e||{},this.partials=t||{},(o=this).registerHelper("helperMissing",function(e){if(2!==arguments.length)throw new s("Missing helper: '"+e+"'")}),o.registerHelper("blockHelperMissing",function(e,t){var i=t.inverse||function(){},n=t.fn;return d(e)&&(e=e.call(this)),!0===e?n(this):!1===e||null==e?i(this):c(e)?0<e.length?o.helpers.each(e,t):i(this):n(e)}),o.registerHelper("each",function(e,t){var i,n=t.fn,o=t.inverse,s=0,r="";if(d(e)&&(e=e.call(this)),t.data&&(i=u(t.data)),e&&"object"==typeof e)if(c(e))for(var a=e.length;s<a;s++)i&&(i.index=s,i.first=0===s,i.last=s===e.length-1),r+=n(e[s],{data:i});else for(var l in e)e.hasOwnProperty(l)&&(i&&(i.key=l,i.index=s,i.first=0===s),r+=n(e[l],{data:i}),s++);return 0===s&&(r=o(this)),r}),o.registerHelper("if",function(e,t){return d(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||n.isEmpty(e)?t.inverse(this):t.fn(this)}),o.registerHelper("unless",function(e,t){return o.helpers.if.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})}),o.registerHelper("with",function(e,t){if(d(e)&&(e=e.call(this)),!n.isEmpty(e))return t.fn(e)}),o.registerHelper("log",function(e,t){var i=t.data&&null!=t.data.level?parseInt(t.data.level,10):1;o.log(i,e)})}(e.HandlebarsEnvironment=t).prototype={constructor:t,logger:a,log:i,registerHelper:function(e,t,i){if(o.call(e)===r){if(i||t)throw new s("Arg not supported with multiple helpers");n.extend(this.helpers,e)}else i&&(t.not=i),this.helpers[e]=t},registerPartial:function(e,t){o.call(e)===r?n.extend(this.partials,e):this.partials[e]=t}};var a={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){var i;a.level<=e&&(i=a.methodMap[e],"undefined"!=typeof console&&console[i]&&console[i].call(console,t))}};function i(e,t){a.log(e,t)}e.logger=a,e.log=i;var u=function(e){var t={};return n.extend(t,e),t};return e.createFrame=u,e}(),a=function(){"use strict";var e={},n=l,c=h,o=u.COMPILER_REVISION,s=u.REVISION_CHANGES;function d(e,i,n){function t(e,t){return i(e,(t=t||{}).data||n)}return t.program=e,t.depth=0,t}return e.checkRevision=function(e){var t=e&&e[0]||1;if(t!==o){if(t<o){var i=s[o],n=s[t];throw new c("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+n+").")}throw new c("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}},e.template=function(r,l){if(!l)throw new c("No environment passed to template");var a={escapeExpression:n.escapeExpression,invokePartial:function(e,t,i,n,o,s){var r=l.VM.invokePartial.apply(this,arguments);if(null!=r)return r;if(l.compile){var a={helpers:n,partials:o,data:s};return o[t]=l.compile(e,{data:void 0!==s},l),o[t](i,a)}throw new c("The partial "+t+" could not be compiled when running in runtime-only mode")},programs:[],program:function(e,t,i){var n=this.programs[e];return n=i?d(e,t,i):n||(this.programs[e]=d(e,t))},merge:function(e,t){var i=e||t;return e&&t&&e!==t&&(i={},n.extend(i,t),n.extend(i,e)),i},programWithDepth:l.VM.programWithDepth,noop:l.VM.noop,compilerInfo:null};return function(e,t){var i,n,o=(t=t||{}).partial?t:l;t.partial||(i=t.helpers,n=t.partials);var s=r.call(a,o,e,i,n,t.data);return t.partial||l.VM.checkRevision(a.compilerInfo),s}},e.programWithDepth=function(e,i,n){function t(e,t){return t=t||{},i.apply(this,[e,t.data||n].concat(o))}var o=Array.prototype.slice.call(arguments,3);return t.program=e,t.depth=o.length,t},e.program=d,e.invokePartial=function(e,t,i,n,o,s){var r={partial:!0,helpers:n,partials:o,data:s};if(void 0===e)throw new c("The partial "+t+" could not be found");if(e instanceof Function)return e(i,r)},e.noop=function(){return""},e}(),i=function(){"use strict";function e(){var t=new i.HandlebarsEnvironment;return s.extend(t,i),t.SafeString=n,t.Exception=o,t.Utils=s,t.VM=r,t.template=function(e){return r.template(e,t)},t}var i=u,n=c,o=h,s=l,r=a,t=e();return t.create=e,t}(),p=function(){"use strict";var l=h;function c(e){e=e||{},this.firstLine=e.first_line,this.firstColumn=e.first_column,this.lastColumn=e.last_column,this.lastLine=e.last_line}var r={ProgramNode:function(e,t,i,n){var o,s;3===arguments.length?(n=i,i=null):2===arguments.length&&(n=t,t=null),c.call(this,n),this.type="program",this.statements=e,this.strip={},i?((s=i[0])?(o={first_line:s.firstLine,last_line:s.lastLine,last_column:s.lastColumn,first_column:s.firstColumn},this.inverse=new r.ProgramNode(i,t,o)):this.inverse=new r.ProgramNode(i,t),this.strip.right=t.left):t&&(this.strip.left=t.right)},MustacheNode:function(e,t,i,n,o){var s;c.call(this,o),this.type="mustache",this.strip=n,null!=i&&i.charAt?(s=i.charAt(3)||i.charAt(2),this.escaped="{"!==s&&"&"!==s):this.escaped=!!i,e instanceof r.SexprNode?this.sexpr=e:this.sexpr=new r.SexprNode(e,t),this.sexpr.isRoot=!0,this.id=this.sexpr.id,this.params=this.sexpr.params,this.hash=this.sexpr.hash,this.eligibleHelper=this.sexpr.eligibleHelper,this.isHelper=this.sexpr.isHelper},SexprNode:function(e,t,i){c.call(this,i),this.type="sexpr",this.hash=t;var n=this.id=e[0],o=this.params=e.slice(1),s=this.eligibleHelper=n.isSimple;this.isHelper=s&&(o.length||t)},PartialNode:function(e,t,i,n){c.call(this,n),this.type="partial",this.partialName=e,this.context=t,this.strip=i},BlockNode:function(e,t,i,n,o){if(c.call(this,o),e.sexpr.id.original!==n.path.original)throw new l(e.sexpr.id.original+" doesn't match "+n.path.original,this);this.type="block",this.mustache=e,this.program=t,this.inverse=i,this.strip={left:e.strip.left,right:n.strip.right},(t||i).strip.left=e.strip.right,(i||t).strip.right=n.strip.left,i&&!t&&(this.isInverse=!0)},ContentNode:function(e,t){c.call(this,t),this.type="content",this.string=e},HashNode:function(e,t){c.call(this,t),this.type="hash",this.pairs=e},IdNode:function(e,t){c.call(this,t),this.type="ID";for(var i="",n=[],o=0,s=0,r=e.length;s<r;s++){var a=e[s].part;if(i+=(e[s].separator||"")+a,".."===a||"."===a||"this"===a){if(0<n.length)throw new l("Invalid path: "+i,this);".."===a?o++:this.isScoped=!0}else n.push(a)}this.original=i,this.parts=n,this.string=n.join("."),this.depth=o,this.isSimple=1===e.length&&!this.isScoped&&0===o,this.stringModeValue=this.string},PartialNameNode:function(e,t){c.call(this,t),this.type="PARTIAL_NAME",this.name=e.original},DataNode:function(e,t){c.call(this,t),this.type="DATA",this.id=e},StringNode:function(e,t){c.call(this,t),this.type="STRING",this.original=this.string=this.stringModeValue=e},IntegerNode:function(e,t){c.call(this,t),this.type="INTEGER",this.original=this.integer=e,this.stringModeValue=Number(e)},BooleanNode:function(e,t){c.call(this,t),this.type="BOOLEAN",this.bool=e,this.stringModeValue="true"===e},CommentNode:function(e,t){c.call(this,t),this.type="comment",this.comment=e}};return r}(),n=function(){"use strict";var e,t;function a(e,t){return{left:"~"===e.charAt(2),right:"~"===t.charAt(0)||"~"===t.charAt(1)}}function i(){this.yy={}}return t={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,i=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var o=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===n.length?this.yylloc.first_column:0)+n[n.length-i.length].length-i[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[o[0],o[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(20<e.length?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(20<e.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;var e,t,i,n,o;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var s=this._currentRules(),r=0;r<s.length&&(!(i=this._input.match(this.rules[s[r]]))||t&&!(i[0].length>t[0].length)||(t=i,n=r,this.options.flex));r++);return t?((o=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=o.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:o?o[o.length-1].length-o[o.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,s[n],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e||void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},options:{},performAction:function(e,i,t){function n(e,t){return i.yytext=i.yytext.substr(e,i.yyleng-t)}switch(t){case 0:if("\\\\"===i.yytext.slice(-2)?(n(0,1),this.begin("mu")):"\\"===i.yytext.slice(-1)?(n(0,1),this.begin("emu")):this.begin("mu"),i.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return n(0,4),this.popState(),15;case 4:return 35;case 5:return 36;case 6:return 25;case 7:return 16;case 8:return 20;case 9:case 10:return 19;case 11:return 23;case 12:return 22;case 13:this.popState(),this.begin("com");break;case 14:return n(3,5),this.popState(),15;case 15:return 22;case 16:return 41;case 17:case 18:return 40;case 19:return 44;case 20:break;case 21:return this.popState(),24;case 22:return this.popState(),18;case 23:return i.yytext=n(1,2).replace(/\\"/g,'"'),32;case 24:return i.yytext=n(1,2).replace(/\\'/g,"'"),32;case 25:return 42;case 26:case 27:return 34;case 28:return 33;case 29:return 40;case 30:return i.yytext=n(1,2),40;case 31:return"INVALID";case 32:return 5}},rules:[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:-?[0-9]+(?=([~}\s)])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],conditions:{mu:{rules:[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],inclusive:!(e={trace:function(){},yy:{},symbols_:{error:2,root:3,statements:4,EOF:5,program:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,sexpr:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,partial_option0:27,sexpr_repetition0:28,sexpr_option0:29,dataName:30,param:31,STRING:32,INTEGER:33,BOOLEAN:34,OPEN_SEXPR:35,CLOSE_SEXPR:36,hash:37,hash_repetition_plus0:38,hashSegment:39,ID:40,EQUALS:41,DATA:42,pathSegments:43,SEP:44,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",32:"STRING",33:"INTEGER",34:"BOOLEAN",35:"OPEN_SEXPR",36:"CLOSE_SEXPR",40:"ID",41:"EQUALS",42:"DATA",44:"SEP"},productions_:[0,[3,2],[3,1],[6,2],[6,3],[6,2],[6,1],[6,1],[6,0],[4,1],[4,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,4],[7,2],[17,3],[17,1],[31,1],[31,1],[31,1],[31,1],[31,1],[31,3],[37,1],[39,3],[26,1],[26,1],[26,1],[30,2],[21,1],[43,3],[43,1],[27,0],[27,1],[28,0],[28,2],[29,0],[29,1],[38,1],[38,2]],performAction:function(e,t,i,n,o,s){var r=s.length-1;switch(o){case 1:return new n.ProgramNode(s[r-1],this._$);case 2:return new n.ProgramNode([],this._$);case 3:this.$=new n.ProgramNode([],s[r-1],s[r],this._$);break;case 4:this.$=new n.ProgramNode(s[r-2],s[r-1],s[r],this._$);break;case 5:this.$=new n.ProgramNode(s[r-1],s[r],[],this._$);break;case 6:this.$=new n.ProgramNode(s[r],this._$);break;case 7:case 8:this.$=new n.ProgramNode([],this._$);break;case 9:this.$=[s[r]];break;case 10:s[r-1].push(s[r]),this.$=s[r-1];break;case 11:this.$=new n.BlockNode(s[r-2],s[r-1].inverse,s[r-1],s[r],this._$);break;case 12:this.$=new n.BlockNode(s[r-2],s[r-1],s[r-1].inverse,s[r],this._$);break;case 13:case 14:this.$=s[r];break;case 15:this.$=new n.ContentNode(s[r],this._$);break;case 16:this.$=new n.CommentNode(s[r],this._$);break;case 17:case 18:this.$=new n.MustacheNode(s[r-1],null,s[r-2],a(s[r-2],s[r]),this._$);break;case 19:this.$={path:s[r-1],strip:a(s[r-2],s[r])};break;case 20:case 21:this.$=new n.MustacheNode(s[r-1],null,s[r-2],a(s[r-2],s[r]),this._$);break;case 22:this.$=new n.PartialNode(s[r-2],s[r-1],a(s[r-3],s[r]),this._$);break;case 23:this.$=a(s[r-1],s[r]);break;case 24:this.$=new n.SexprNode([s[r-2]].concat(s[r-1]),s[r],this._$);break;case 25:this.$=new n.SexprNode([s[r]],null,this._$);break;case 26:this.$=s[r];break;case 27:this.$=new n.StringNode(s[r],this._$);break;case 28:this.$=new n.IntegerNode(s[r],this._$);break;case 29:this.$=new n.BooleanNode(s[r],this._$);break;case 30:this.$=s[r];break;case 31:s[r-1].isHelper=!0,this.$=s[r-1];break;case 32:this.$=new n.HashNode(s[r],this._$);break;case 33:this.$=[s[r-2],s[r]];break;case 34:this.$=new n.PartialNameNode(s[r],this._$);break;case 35:this.$=new n.PartialNameNode(new n.StringNode(s[r],this._$),this._$);break;case 36:this.$=new n.PartialNameNode(new n.IntegerNode(s[r],this._$));break;case 37:this.$=new n.DataNode(s[r],this._$);break;case 38:this.$=new n.IdNode(s[r],this._$);break;case 39:s[r-2].push({part:s[r],separator:s[r-1]}),this.$=s[r-2];break;case 40:this.$=[{part:s[r]}];break;case 43:this.$=[];break;case 44:s[r-1].push(s[r]);break;case 47:this.$=[s[r]];break;case 48:s[r-1].push(s[r])}},table:[{3:1,4:2,5:[1,3],8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[3]},{5:[1,16],8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[2,2]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{4:20,6:18,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{4:20,6:22,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{17:23,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:29,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:30,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:31,21:24,30:25,40:[1,28],42:[1,27],43:26},{21:33,26:32,32:[1,34],33:[1,35],40:[1,28],43:26},{1:[2,1]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{10:36,20:[1,37]},{4:38,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,7],22:[1,13],23:[1,14],25:[1,15]},{7:39,8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,6],22:[1,13],23:[1,14],25:[1,15]},{17:23,18:[1,40],21:24,30:25,40:[1,28],42:[1,27],43:26},{10:41,20:[1,37]},{18:[1,42]},{18:[2,43],24:[2,43],28:43,32:[2,43],33:[2,43],34:[2,43],35:[2,43],36:[2,43],40:[2,43],42:[2,43]},{18:[2,25],24:[2,25],36:[2,25]},{18:[2,38],24:[2,38],32:[2,38],33:[2,38],34:[2,38],35:[2,38],36:[2,38],40:[2,38],42:[2,38],44:[1,44]},{21:45,40:[1,28],43:26},{18:[2,40],24:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],40:[2,40],42:[2,40],44:[2,40]},{18:[1,46]},{18:[1,47]},{24:[1,48]},{18:[2,41],21:50,27:49,40:[1,28],43:26},{18:[2,34],40:[2,34]},{18:[2,35],40:[2,35]},{18:[2,36],40:[2,36]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{21:51,40:[1,28],43:26},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,3],22:[1,13],23:[1,14],25:[1,15]},{4:52,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,5],22:[1,13],23:[1,14],25:[1,15]},{14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]},{18:[2,45],21:56,24:[2,45],29:53,30:60,31:54,32:[1,57],33:[1,58],34:[1,59],35:[1,61],36:[2,45],37:55,38:62,39:63,40:[1,64],42:[1,27],43:26},{40:[1,65]},{18:[2,37],24:[2,37],32:[2,37],33:[2,37],34:[2,37],35:[2,37],36:[2,37],40:[2,37],42:[2,37]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,66]},{18:[2,42]},{18:[1,67]},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],25:[1,15]},{18:[2,24],24:[2,24],36:[2,24]},{18:[2,44],24:[2,44],32:[2,44],33:[2,44],34:[2,44],35:[2,44],36:[2,44],40:[2,44],42:[2,44]},{18:[2,46],24:[2,46],36:[2,46]},{18:[2,26],24:[2,26],32:[2,26],33:[2,26],34:[2,26],35:[2,26],36:[2,26],40:[2,26],42:[2,26]},{18:[2,27],24:[2,27],32:[2,27],33:[2,27],34:[2,27],35:[2,27],36:[2,27],40:[2,27],42:[2,27]},{18:[2,28],24:[2,28],32:[2,28],33:[2,28],34:[2,28],35:[2,28],36:[2,28],40:[2,28],42:[2,28]},{18:[2,29],24:[2,29],32:[2,29],33:[2,29],34:[2,29],35:[2,29],36:[2,29],40:[2,29],42:[2,29]},{18:[2,30],24:[2,30],32:[2,30],33:[2,30],34:[2,30],35:[2,30],36:[2,30],40:[2,30],42:[2,30]},{17:68,21:24,30:25,40:[1,28],42:[1,27],43:26},{18:[2,32],24:[2,32],36:[2,32],39:69,40:[1,70]},{18:[2,47],24:[2,47],36:[2,47],40:[2,47]},{18:[2,40],24:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],40:[2,40],41:[1,71],42:[2,40],44:[2,40]},{18:[2,39],24:[2,39],32:[2,39],33:[2,39],34:[2,39],35:[2,39],36:[2,39],40:[2,39],42:[2,39],44:[2,39]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{36:[1,72]},{18:[2,48],24:[2,48],36:[2,48],40:[2,48]},{41:[1,71]},{21:56,30:60,31:73,32:[1,57],33:[1,58],34:[1,59],35:[1,61],40:[1,28],42:[1,27],43:26},{18:[2,31],24:[2,31],32:[2,31],33:[2,31],34:[2,31],35:[2,31],36:[2,31],40:[2,31],42:[2,31]},{18:[2,33],24:[2,33],36:[2,33],40:[2,33]}],defaultActions:{3:[2,2],16:[2,1],50:[2,42]},parseError:function(e){throw new Error(e)},parse:function(e){var t=this,i=[0],n=[null],o=[],s=this.table,r="",a=0,l=0,c=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,void 0===(this.yy.parser=this).lexer.yylloc&&(this.lexer.yylloc={});var d=this.lexer.yylloc;o.push(d);var u=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,p,f,m,g,v,y,w,C,b,S={};;){if(f=i[i.length-1],void 0===(m=this.defaultActions[f]?this.defaultActions[f]:(null==h&&(b=void 0,"number"!=typeof(b=t.lexer.lex()||1)&&(b=t.symbols_[b]||b),h=b),s[f]&&s[f][h]))||!m.length||!m[0]){var _="";if(!c){for(v in C=[],s[f])this.terminals_[v]&&2<v&&C.push("'"+this.terminals_[v]+"'");_=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+C.join(", ")+", got '"+(this.terminals_[h]||h)+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(_,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:d,expected:C})}}if(m[0]instanceof Array&&1<m.length)throw new Error("Parse Error: multiple actions possible at state: "+f+", token: "+h);switch(m[0]){case 1:i.push(h),n.push(this.lexer.yytext),o.push(this.lexer.yylloc),i.push(m[1]),h=null,p?(h=p,p=null):(l=this.lexer.yyleng,r=this.lexer.yytext,a=this.lexer.yylineno,d=this.lexer.yylloc,0<c&&c--);break;case 2:if(y=this.productions_[m[1]][1],S.$=n[n.length-y],S._$={first_line:o[o.length-(y||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(y||1)].first_column,last_column:o[o.length-1].last_column},u&&(S._$.range=[o[o.length-(y||1)].range[0],o[o.length-1].range[1]]),void 0!==(g=this.performAction.call(S,r,l,a,this.yy,m[1],n,o)))return g;y&&(i=i.slice(0,-1*y*2),n=n.slice(0,-1*y),o=o.slice(0,-1*y)),i.push(this.productions_[m[1]][0]),n.push(S.$),o.push(S._$),w=s[i[i.length-2]][i[i.length-1]],i.push(w);break;case 3:return!0}}return!0}})},emu:{rules:[2],inclusive:!1},com:{rules:[3],inclusive:!1},INITIAL:{rules:[0,1,32],inclusive:!0}}},e.lexer=t,new((i.prototype=e).Parser=i)}(),f=function(){"use strict";var e={},t=n,i=p;return e.parser=t,e.parse=function(e){return e.constructor===i.ProgramNode?e:(t.yy=i,t.parse(e))},e}(),m=function(){"use strict";var e={},c=h;function t(){}return(e.Compiler=t).prototype={compiler:t,disassemble:function(){for(var e,t,i,n=this.opcodes,o=[],s=0,r=n.length;s<r;s++)if("DECLARE"===(e=n[s]).opcode)o.push("DECLARE "+e.name+"="+e.value);else{t=[];for(var a=0;a<e.args.length;a++)"string"==typeof(i=e.args[a])&&(i='"'+i.replace("\n","\\n")+'"'),t.push(i);o.push(e.opcode+" "+t.join(" "))}return o.join("\n")},equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var i=0;i<t;i++){var n=this.opcodes[i],o=e.opcodes[i];if(n.opcode!==o.opcode||n.args.length!==o.args.length)return!1;for(var s=0;s<n.args.length;s++)if(n.args[s]!==o.args[s])return!1}if(t=this.children.length,e.children.length!==t)return!1;for(i=0;i<t;i++)if(!this.children[i].equals(e.children[i]))return!1;return!0},guid:0,compile:function(e,t){this.opcodes=[],this.children=[],this.depths={list:[]},this.options=t;var i=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0},i)for(var n in i)this.options.knownHelpers[n]=i[n];return this.accept(e)},accept:function(e){var t,i=e.strip||{};return i.left&&this.opcode("strip"),t=this[e.type](e),i.right&&this.opcode("strip"),t},program:function(e){for(var t=e.statements,i=0,n=t.length;i<n;i++)this.accept(t[i]);return this.isSimple=1===n,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t,i=(new this.compiler).compile(e,this.options),n=this.guid++;this.usePartial=this.usePartial||i.usePartial;for(var o=0,s=(this.children[n]=i).depths.list.length;o<s;o++)(t=i.depths.list[o])<2||this.addDepth(t-1);return n},block:function(e){var t=e.mustache,i=e.program,n=e.inverse,i=i&&this.compileProgram(i),n=n&&this.compileProgram(n),o=t.sexpr,s=this.classifySexpr(o);"helper"===s?this.helperSexpr(o,i,n):"simple"===s?(this.simpleSexpr(o),this.opcode("pushProgram",i),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousSexpr(o,i,n),this.opcode("pushProgram",i),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(e){var t,i,n=e.pairs;this.opcode("pushHash");for(var o=0,s=n.length;o<s;o++)i=(t=n[o])[1],this.options.stringParams?(i.depth&&this.addDepth(i.depth),this.opcode("getContext",i.depth||0),this.opcode("pushStringParam",i.stringModeValue,i.type),"sexpr"===i.type&&this.sexpr(i)):this.accept(i),this.opcode("assignToHash",t[0]);this.opcode("popHash")},partial:function(e){var t=e.partialName;this.usePartial=!0,e.context?this.ID(e.context):this.opcode("push","depth0"),this.opcode("invokePartial",t.name),this.opcode("append")},content:function(e){this.opcode("appendContent",e.string)},mustache:function(e){this.sexpr(e.sexpr),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousSexpr:function(e,t,i){var n=e.id,o=n.parts[0],s=null!=t||null!=i;this.opcode("getContext",n.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",i),this.opcode("invokeAmbiguous",o,s)},simpleSexpr:function(e){var t=e.id;"DATA"===t.type?this.DATA(t):t.parts.length?this.ID(t):(this.addDepth(t.depth),this.opcode("getContext",t.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,t,i){var n=this.setupFullMustacheParams(e,t,i),o=e.id.parts[0];if(this.options.knownHelpers[o])this.opcode("invokeKnownHelper",n.length,o);else{if(this.options.knownHelpersOnly)throw new c("You specified knownHelpersOnly, but used the unknown helper "+o,e);this.opcode("invokeHelper",n.length,o,e.isRoot)}},sexpr:function(e){var t=this.classifySexpr(e);"simple"===t?this.simpleSexpr(e):"helper"===t?this.helperSexpr(e):this.ambiguousSexpr(e)},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth),e.parts[0]?this.opcode("lookupOnContext",e.parts[0]):this.opcode("pushContext");for(var t=1,i=e.parts.length;t<i;t++)this.opcode("lookup",e.parts[t])},DATA:function(e){if(this.options.data=!0,e.id.isScoped||e.id.depth)throw new c("Scoped data references are not supported: "+e.original,e);this.opcode("lookupData");for(var t=e.id.parts,i=0,n=t.length;i<n;i++)this.opcode("lookup",t[i])},STRING:function(e){this.opcode("pushString",e.string)},INTEGER:function(e){this.opcode("pushLiteral",e.integer)},BOOLEAN:function(e){this.opcode("pushLiteral",e.bool)},comment:function(){},opcode:function(e){this.opcodes.push({opcode:e,args:[].slice.call(arguments,1)})},declare:function(e,t){this.opcodes.push({opcode:"DECLARE",name:e,value:t})},addDepth:function(e){0!==e&&(this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e)))},classifySexpr:function(e){var t,i=e.isHelper,n=e.eligibleHelper,o=this.options;return n&&!i&&(t=e.id.parts[0],o.knownHelpers[t]?i=!0:o.knownHelpersOnly&&(n=!1)),i?"helper":n?"ambiguous":"simple"},pushParams:function(e){for(var t,i=e.length;i--;)t=e[i],this.options.stringParams?(t.depth&&this.addDepth(t.depth),this.opcode("getContext",t.depth||0),this.opcode("pushStringParam",t.stringModeValue,t.type),"sexpr"===t.type&&this.sexpr(t)):this[t.type](t)},setupFullMustacheParams:function(e,t,i){var n=e.params;return this.pushParams(n),this.opcode("pushProgram",t),this.opcode("pushProgram",i),e.hash?this.hash(e.hash):this.opcode("emptyHash"),n}},e.precompile=function(e,t,i){if(null==e||"string"!=typeof e&&e.constructor!==i.AST.ProgramNode)throw new c("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);"data"in(t=t||{})||(t.data=!0);var n=i.parse(e),o=(new i.Compiler).compile(n,t);return(new i.JavaScriptCompiler).compile(o,t)},e.compile=function(s,r,a){if(null==s||"string"!=typeof s&&s.constructor!==a.AST.ProgramNode)throw new c("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+s);var l;return"data"in(r=r||{})||(r.data=!0),function(e,t){var i,n,o;return l||(i=a.parse(s),n=(new a.Compiler).compile(i,r),o=(new a.JavaScriptCompiler).compile(n,r,void 0,!0),l=a.template(o)),l.call(this,e,t)}},e}(),g=function(){"use strict";var e=u.COMPILER_REVISION,t=u.REVISION_CHANGES,l=u.log,a=h;function c(e){this.value=e}function o(){}o.prototype={nameLookup:function(e,t){var i,n;return 0===e.indexOf("depth")&&(i=!0),n=/^[0-9]+$/.test(t)?e+"["+t+"]":o.isValidJavaScriptVariableName(t)?e+"."+t:e+"['"+t+"']",i?"("+e+" && "+n+")":n},compilerInfo:function(){return"this.compilerInfo = ["+e+",'"+t[e]+"'];\n"},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":{appendToBuffer:!0,content:e,toString:function(){return"buffer += "+e+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(e,t,i,n){this.environment=e,this.options=t||{},l("debug",this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!i,this.context=i||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.compileChildren(e,t);var o,s=e.opcodes;this.i=0;for(var r=s.length;this.i<r;this.i++)"DECLARE"===(o=s[this.i]).opcode?this[o.name]=o.value:this[o.opcode].apply(this,o.args),o.opcode!==this.stripNext&&(this.stripNext=!1);if(this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new a("Compile completed with content left on stack");return this.createFunctionContext(n)},preamble:function(){var e,t,i=[];this.isChild?i.push(""):(t="helpers = this.merge(helpers, "+(e=this.namespace)+".helpers);",this.environment.usePartial&&(t=t+" partials = this.merge(partials, "+e+".partials);"),this.options.data&&(t+=" data = data || {};"),i.push(t)),this.environment.isSimple?i.push(""):i.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=i},createFunctionContext:function(e){var t=this.stackVars.concat(this.registers.list);if(0<t.length&&(this.source[1]=this.source[1]+", "+t.join(", ")),!this.isChild)for(var i in this.context.aliases)this.context.aliases.hasOwnProperty(i)&&(this.source[1]=this.source[1]+", "+i+"="+this.context.aliases[i]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.pushSource("return buffer;");for(var n=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],o=0,s=this.environment.depths.list.length;o<s;o++)n.push("depth"+this.environment.depths.list[o]);var r=this.mergeSource();if(this.isChild||(r=this.compilerInfo()+r),e)return n.push(r),Function.apply(this,n);var a="function "+(this.name||"")+"("+n.join(",")+") {\n  "+r+"}";return l("debug",a+"\n\n"),a},mergeSource:function(){for(var e,t="",i=0,n=this.source.length;i<n;i++){var o=this.source[i];o.appendToBuffer?e=e?e+"\n    + "+o.content:o.content:(e&&(t+="buffer += "+e+";\n  ",e=void 0),t+=o+"\n  ")}return t},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var t=["depth0"];this.setupParams(0,t),this.replaceStack(function(e){return t.splice(1,0,e),"blockHelperMissing.call("+t.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e);var t=this.topStack();e.splice(1,0,t),this.pushSource("if (!"+this.lastHelper+") { "+t+" = blockHelperMissing.call("+e.join(", ")+"); }")},appendContent:function(e){this.pendingContent&&(e=this.pendingContent+e),this.stripNext&&(e=e.replace(/^\s+/,"")),this.pendingContent=e},strip:function(){this.pendingContent&&(this.pendingContent=this.pendingContent.replace(/\s+$/,"")),this.stripNext="strip"},append:function(){this.flushInline();var e=this.popStack();this.pushSource("if("+e+" || "+e+" === 0) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.pushSource("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(e){this.lastContext!==e&&(this.lastContext=e)},lookupOnContext:function(e){this.push(this.nameLookup("depth"+this.lastContext,e,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(e){return"typeof "+e+" === functionType ? "+e+".apply(depth0) : "+e})},lookup:function(t){this.replaceStack(function(e){return e+" == null || "+e+" === false ? "+e+" : "+this.nameLookup(e,t,"context")})},lookupData:function(){this.pushStackLiteral("data")},pushStringParam:function(e,t){this.pushStackLiteral("depth"+this.lastContext),this.pushString(t),"sexpr"!==t&&("string"==typeof e?this.pushString(e):this.pushStackLiteral(e))},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.push("{}"),this.push("{}"))},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[]}},popHash:function(){var e=this.hash;this.hash=this.hashes.pop(),this.options.stringParams&&(this.push("{"+e.contexts.join(",")+"}"),this.push("{"+e.types.join(",")+"}")),this.push("{\n    "+e.values.join(",\n    ")+"\n  }")},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},push:function(e){return this.inlineStack.push(e),e},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},invokeHelper:function(e,t,i){this.context.aliases.helperMissing="helpers.helperMissing",this.useRegister("helper");var n=this.lastHelper=this.setupHelper(e,t,!0),o=this.nameLookup("depth"+this.lastContext,t,"context"),s="helper = "+n.name+" || "+o;n.paramsInit&&(s+=","+n.paramsInit),this.push("("+s+",helper ? helper.call("+n.callParams+") : helperMissing.call("+n.helperMissingParams+"))"),i||this.flushInline()},invokeKnownHelper:function(e,t){var i=this.setupHelper(e,t);this.push(i.name+".call("+i.callParams+")")},invokeAmbiguous:function(e,t){this.context.aliases.functionType='"function"',this.useRegister("helper"),this.emptyHash();var i=this.setupHelper(0,e,t),n=this.lastHelper=this.nameLookup("helpers",e,"helper"),o=this.nameLookup("depth"+this.lastContext,e,"context"),s=this.nextStack();i.paramsInit&&this.pushSource(i.paramsInit),this.pushSource("if (helper = "+n+") { "+s+" = helper.call("+i.callParams+"); }"),this.pushSource("else { helper = "+o+"; "+s+" = typeof helper === functionType ? helper.call("+i.callParams+") : helper; }")},invokePartial:function(e){var t=[this.nameLookup("partials",e,"partial"),"'"+e+"'",this.popStack(),"helpers","partials"];this.options.data&&t.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+t.join(", ")+")")},assignToHash:function(e){var t,i,n=this.popStack();this.options.stringParams&&(i=this.popStack(),t=this.popStack());var o=this.hash;t&&o.contexts.push("'"+e+"': "+t),i&&o.types.push("'"+e+"': "+i),o.values.push("'"+e+"': ("+n+")")},compiler:o,compileChildren:function(e,t){for(var i,n,o=e.children,s=0,r=o.length;s<r;s++){i=o[s],n=new this.compiler;var a=this.matchExistingProgram(i);null==a?(this.context.programs.push(""),a=this.context.programs.length,i.index=a,i.name="program"+a,this.context.programs[a]=n.compile(i,t,this.context),this.context.environments[a]=i):(i.index=a,i.name="program"+a)}},matchExistingProgram:function(e){for(var t=0,i=this.context.environments.length;t<i;t++){var n=this.context.environments[t];if(n&&n.equals(e))return t}},programExpression:function(e){if(this.context.aliases.self="this",null==e)return"self.noop";for(var t,i=this.environment.children[e],n=i.depths.list,o=[i.index,i.name,"data"],s=0,r=n.length;s<r;s++)1===(t=n[s])?o.push("depth0"):o.push("depth"+(t-1));return(0===n.length?"self.program(":"self.programWithDepth(")+o.join(", ")+")"},register:function(e,t){this.useRegister(e),this.pushSource(e+" = "+t+";")},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},pushStackLiteral:function(e){return this.push(new c(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent))),this.pendingContent=void 0),e&&this.source.push(e)},pushStack:function(e){this.flushInline();var t=this.incrStack();return e&&this.pushSource(t+" = "+e+";"),this.compileStack.push(t),t},replaceStack:function(e){var t,i,n,o,s,r="",a=this.isInline();a?(n=this.popStack(!0))instanceof c?(s=n.value,i=!0):(o=(t=!this.stackSlot)?this.incrStack():this.topStackName(),r="("+this.push(o)+" = "+n+"),",s=this.topStack()):s=this.topStack();var l=e.call(this,s);return a?(i||this.popStack(),t&&this.stackSlot--,this.push("("+r+l+")")):(/^stack/.test(s)||(s=this.nextStack()),this.pushSource(s+" = ("+r+l+");")),s},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;if(e.length){this.inlineStack=[];for(var t=0,i=e.length;t<i;t++){var n=e[t];n instanceof c?this.compileStack.push(n):this.pushStack(n)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),i=(t?this.inlineStack:this.compileStack).pop();if(!e&&i instanceof c)return i.value;if(!t){if(!this.stackSlot)throw new a("Invalid stack pop");this.stackSlot--}return i},topStack:function(e){var t=this.isInline()?this.inlineStack:this.compileStack,i=t[t.length-1];return!e&&i instanceof c?i.value:i},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(e,t,i){var n=[];return{params:n,paramsInit:this.setupParams(e,n,i),name:this.nameLookup("helpers",t,"helper"),callParams:["depth0"].concat(n).join(", "),helperMissingParams:i&&["depth0",this.quotedString(t)].concat(n).join(", ")}},setupOptions:function(e,t){var i,n,o,s=[],r=[],a=[];s.push("hash:"+this.popStack()),this.options.stringParams&&(s.push("hashTypes:"+this.popStack()),s.push("hashContexts:"+this.popStack())),n=this.popStack(),((o=this.popStack())||n)&&(o||(this.context.aliases.self="this",o="self.noop"),n||(this.context.aliases.self="this",n="self.noop"),s.push("inverse:"+n),s.push("fn:"+o));for(var l=0;l<e;l++)i=this.popStack(),t.push(i),this.options.stringParams&&(a.push(this.popStack()),r.push(this.popStack()));return this.options.stringParams&&(s.push("contexts:["+r.join(",")+"]"),s.push("types:["+a.join(",")+"]")),this.options.data&&s.push("data:data"),s},setupParams:function(e,t,i){var n="{"+this.setupOptions(e,t).join(",")+"}";return i?(this.useRegister("options"),t.push("options"),"options="+n):(t.push(n),"")}};for(var i="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),n=o.RESERVED_WORDS={},s=0,r=i.length;s<r;s++)n[i[s]]=!0;return o.isValidJavaScriptVariableName=function(e){return!(o.RESERVED_WORDS[e]||!/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(e))},o}();return function(){"use strict";function e(){var i=d();return i.compile=function(e,t){return a(e,t,i)},i.precompile=function(e,t){return l(e,t,i)},i.AST=n,i.Compiler=r,i.JavaScriptCompiler=c,i.Parser=o,i.parse=s,i}var t=i,n=p,o=f.parser,s=f.parse,r=m.Compiler,a=m.compile,l=m.precompile,c=g,d=t.create;return(t=e()).create=e,t}()}();!function(e,t){"object"==typeof exports?module.exports=t(require("handlebars")):"function"==typeof define&&define.amd?define(["handlebars"],t):e.HandlebarsHelpersRegistry=t(e.Handlebars)}(this,function(i){function e(){this.expressions=[]}e.prototype.add=function(e,t){this.expressions[e]=t},e.prototype.call=function(e,t,i){if(!this.expressions.hasOwnProperty(e))throw new Error('Unknown operator "'+e+'"');return this.expressions[e](t,i)};var s=new e;s.add("not",function(e,t){return e!=t}),s.add(">",function(e,t){return t<e}),s.add("<",function(e,t){return e<t}),s.add(">=",function(e,t){return t<=e}),s.add("<=",function(e,t){return e<=t}),s.add("===",function(e,t){return e===t}),s.add("!==",function(e,t){return e!==t}),s.add("in",function(e,t){var i;return i=t,"[object Array]"!==Object.prototype.toString.call(i)&&(t=t.split(",")),-1!==t.indexOf(e)});return i.registerHelper("is",function(){var e=arguments,t=e[0],i=e[1],n=e[2],o=e[3];return 2==e.length?(o=e[1],t?o.fn(this):o.inverse(this)):3==e.length?(o=e[2],t==(n=e[1])?o.fn(this):o.inverse(this)):s.call(i,t,n)?o.fn(this):o.inverse(this)}),i.registerHelper("nl2br",function(e){var t=(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br>$2");return new i.SafeString(t)}),i.registerHelper("log",function(){console.log(["Values:"].concat(Array.prototype.slice.call(arguments,0,-1)))}),i.registerHelper("debug",function(){console.log("Context:",this),console.log(["Values:"].concat(Array.prototype.slice.call(arguments,0,-1)))}),s}),function(){var e=this,t=e._,r={},o=Array.prototype,i=Object.prototype,n=Function.prototype,s=o.push,a=o.slice,l=o.concat,u=i.toString,c=i.hasOwnProperty,d=o.forEach,h=o.map,p=o.reduce,f=o.reduceRight,m=o.filter,g=o.every,v=o.some,y=o.indexOf,w=o.lastIndexOf,C=Array.isArray,b=Object.keys,S=n.bind,_=function(e){return e instanceof _?e:this instanceof _?void(this._wrapped=e):new _(e)};void 0!==exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):e._=_,_.VERSION="1.6.0";var x=_.each=_.forEach=function(e,t,i){if(null==e)return e;if(d&&e.forEach===d)e.forEach(t,i);else if(e.length===+e.length){for(var n=0,o=e.length;n<o;n++)if(t.call(i,e[n],n,e)===r)return}else for(var s=_.keys(e),n=0,o=s.length;n<o;n++)if(t.call(i,e[s[n]],s[n],e)===r)return;return e};_.map=_.collect=function(e,n,o){var s=[];return null==e?s:h&&e.map===h?e.map(n,o):(x(e,function(e,t,i){s.push(n.call(o,e,t,i))}),s)};var A="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(e,n,o,s){var r=2<arguments.length;if(null==e&&(e=[]),p&&e.reduce===p)return s&&(n=_.bind(n,s)),r?e.reduce(n,o):e.reduce(n);if(x(e,function(e,t,i){r?o=n.call(s,o,e,t,i):(o=e,r=!0)}),!r)throw new TypeError(A);return o},_.reduceRight=_.foldr=function(n,o,s,r){var a=2<arguments.length;if(null==n&&(n=[]),f&&n.reduceRight===f)return r&&(o=_.bind(o,r)),a?n.reduceRight(o,s):n.reduceRight(o);var l,c=n.length;if(c!==+c&&(l=_.keys(n),c=l.length),x(n,function(e,t,i){t=l?l[--c]:--c,a?s=o.call(r,s,n[t],t,i):(s=n[t],a=!0)}),!a)throw new TypeError(A);return s},_.find=_.detect=function(e,n,o){var s;return I(e,function(e,t,i){if(n.call(o,e,t,i))return s=e,!0}),s},_.filter=_.select=function(e,n,o){var s=[];return null==e?s:m&&e.filter===m?e.filter(n,o):(x(e,function(e,t,i){n.call(o,e,t,i)&&s.push(e)}),s)},_.reject=function(e,n,o){return _.filter(e,function(e,t,i){return!n.call(o,e,t,i)},o)},_.every=_.all=function(e,n,o){n=n||_.identity;var s=!0;return null==e?s:g&&e.every===g?e.every(n,o):(x(e,function(e,t,i){if(!(s=s&&n.call(o,e,t,i)))return r}),!!s)};var I=_.some=_.any=function(e,n,o){n=n||_.identity;var s=!1;return null==e?s:v&&e.some===v?e.some(n,o):(x(e,function(e,t,i){if(s=s||n.call(o,e,t,i))return r}),!!s)};_.contains=_.include=function(e,t){return null!=e&&(y&&e.indexOf===y?-1!=e.indexOf(t):I(e,function(e){return e===t}))},_.invoke=function(e,t){var i=a.call(arguments,2),n=_.isFunction(t);return _.map(e,function(e){return(n?t:e[t]).apply(e,i)})},_.pluck=function(e,t){return _.map(e,_.property(t))},_.where=function(e,t){return _.filter(e,_.matches(t))},_.findWhere=function(e,t){return _.find(e,_.matches(t))},_.max=function(e,o,s){if(!o&&_.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var r=-1/0,a=-1/0;return x(e,function(e,t,i){var n=o?o.call(s,e,t,i):e;a<n&&(r=e,a=n)}),r},_.min=function(e,o,s){if(!o&&_.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var r=1/0,a=1/0;return x(e,function(e,t,i){var n=o?o.call(s,e,t,i):e;n<a&&(r=e,a=n)}),r},_.shuffle=function(e){var t,i=0,n=[];return x(e,function(e){t=_.random(i++),n[i-1]=n[t],n[t]=e}),n},_.sample=function(e,t,i){return null==t||i?(e.length!==+e.length&&(e=_.values(e)),e[_.random(e.length-1)]):_.shuffle(e).slice(0,Math.max(0,t))};function O(e){return null==e?_.identity:_.isFunction(e)?e:_.property(e)}_.sortBy=function(e,n,o){return n=O(n),_.pluck(_.map(e,function(e,t,i){return{value:e,index:t,criteria:n.call(o,e,t,i)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(n<i||void 0===i)return 1;if(i<n||void 0===n)return-1}return e.index-t.index}),"value")};function E(a){return function(n,o,s){var r={};return o=O(o),x(n,function(e,t){var i=o.call(s,e,t,n);a(r,i,e)}),r}}_.groupBy=E(function(e,t,i){_.has(e,t)?e[t].push(i):e[t]=[i]}),_.indexBy=E(function(e,t,i){e[t]=i}),_.countBy=E(function(e,t){_.has(e,t)?e[t]++:e[t]=1}),_.sortedIndex=function(e,t,i,n){for(var o=(i=O(i)).call(n,t),s=0,r=e.length;s<r;){var a=s+r>>>1;i.call(n,e[a])<o?s=1+a:r=a}return s},_.toArray=function(e){return e?_.isArray(e)?a.call(e):e.length===+e.length?_.map(e,_.identity):_.values(e):[]},_.size=function(e){return null==e?0:e.length===+e.length?e.length:_.keys(e).length},_.first=_.head=_.take=function(e,t,i){if(null!=e)return null==t||i?e[0]:t<0?[]:a.call(e,0,t)},_.initial=function(e,t,i){return a.call(e,0,e.length-(null==t||i?1:t))},_.last=function(e,t,i){if(null!=e)return null==t||i?e[e.length-1]:a.call(e,Math.max(e.length-t,0))},_.rest=_.tail=_.drop=function(e,t,i){return a.call(e,null==t||i?1:t)},_.compact=function(e){return _.filter(e,_.identity)};var V=function(e,t,i){return t&&_.every(e,_.isArray)?l.apply(i,e):(x(e,function(e){_.isArray(e)||_.isArguments(e)?t?s.apply(i,e):V(e,t,i):i.push(e)}),i)};_.flatten=function(e,t){return V(e,t,[])},_.without=function(e){return _.difference(e,a.call(arguments,1))},_.partition=function(e,t,i){t=O(t);var n=[],o=[];return x(e,function(e){(t.call(i,e)?n:o).push(e)}),[n,o]},_.uniq=_.unique=function(i,n,e,t){_.isFunction(n)&&(t=e,e=n,n=!1);var o=e?_.map(i,e,t):i,s=[],r=[];return x(o,function(e,t){(n?t&&r[r.length-1]===e:_.contains(r,e))||(r.push(e),s.push(i[t]))}),s},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=function(e){var i=a.call(arguments,1);return _.filter(_.uniq(e),function(t){return _.every(i,function(e){return _.contains(e,t)})})},_.difference=function(e){var t=l.apply(o,a.call(arguments,1));return _.filter(e,function(e){return!_.contains(t,e)})},_.zip=function(){for(var e=_.max(_.pluck(arguments,"length").concat(0)),t=new Array(e),i=0;i<e;i++)t[i]=_.pluck(arguments,""+i);return t},_.object=function(e,t){if(null==e)return{};for(var i={},n=0,o=e.length;n<o;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},_.indexOf=function(e,t,i){if(null==e)return-1;var n=0,o=e.length;if(i){if("number"!=typeof i)return e[n=_.sortedIndex(e,t)]===t?n:-1;n=i<0?Math.max(0,o+i):i}if(y&&e.indexOf===y)return e.indexOf(t,i);for(;n<o;n++)if(e[n]===t)return n;return-1},_.lastIndexOf=function(e,t,i){if(null==e)return-1;var n=null!=i;if(w&&e.lastIndexOf===w)return n?e.lastIndexOf(t,i):e.lastIndexOf(t);for(var o=n?i:e.length;o--;)if(e[o]===t)return o;return-1},_.range=function(e,t,i){arguments.length<=1&&(t=e||0,e=0),i=i||1;for(var n=Math.max(Math.ceil((t-e)/i),0),o=0,s=new Array(n);o<n;)s[o++]=e,e+=i;return s};function P(){}_.bind=function(i,n){var o,s;if(S&&i.bind===S)return S.apply(i,a.call(arguments,1));if(!_.isFunction(i))throw new TypeError;return o=a.call(arguments,2),s=function(){if(!(this instanceof s))return i.apply(n,o.concat(a.call(arguments)));P.prototype=i.prototype;var e=new P;P.prototype=null;var t=i.apply(e,o.concat(a.call(arguments)));return Object(t)===t?t:e}},_.partial=function(o){var s=a.call(arguments,1);return function(){for(var e=0,t=s.slice(),i=0,n=t.length;i<n;i++)t[i]===_&&(t[i]=arguments[e++]);for(;e<arguments.length;)t.push(arguments[e++]);return o.apply(this,t)}},_.bindAll=function(t){var e=a.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return x(e,function(e){t[e]=_.bind(t[e],t)}),t},_.memoize=function(t,i){var n={};return i=i||_.identity,function(){var e=i.apply(this,arguments);return _.has(n,e)?n[e]:n[e]=t.apply(this,arguments)}},_.delay=function(e,t){var i=a.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},_.defer=function(e){return _.delay.apply(_,[e,1].concat(a.call(arguments,1)))},_.throttle=function(i,n,o){var s,r,a,l=null,c=0;o=o||{};function d(){c=!1===o.leading?0:_.now(),l=null,a=i.apply(s,r),s=r=null}return function(){var e=_.now();c||!1!==o.leading||(c=e);var t=n-(e-c);return s=this,r=arguments,t<=0?(clearTimeout(l),l=null,c=e,a=i.apply(s,r),s=r=null):l||!1===o.trailing||(l=setTimeout(d,t)),a}},_.debounce=function(t,i,n){var o,s,r,a,l,c=function(){var e=_.now()-a;e<i?o=setTimeout(c,i-e):(o=null,n||(l=t.apply(r,s),r=s=null))};return function(){r=this,s=arguments,a=_.now();var e=n&&!o;return o=o||setTimeout(c,i),e&&(l=t.apply(r,s),r=s=null),l}},_.once=function(e){var t,i=!1;return function(){return i||(i=!0,t=e.apply(this,arguments),e=null),t}},_.wrap=function(e,t){return _.partial(t,e)},_.compose=function(){var i=arguments;return function(){for(var e=arguments,t=i.length-1;0<=t;t--)e=[i[t].apply(this,e)];return e[0]}},_.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},_.keys=function(e){if(!_.isObject(e))return[];if(b)return b(e);var t=[];for(var i in e)_.has(e,i)&&t.push(i);return t},_.values=function(e){for(var t=_.keys(e),i=t.length,n=new Array(i),o=0;o<i;o++)n[o]=e[t[o]];return n},_.pairs=function(e){for(var t=_.keys(e),i=t.length,n=new Array(i),o=0;o<i;o++)n[o]=[t[o],e[t[o]]];return n},_.invert=function(e){for(var t={},i=_.keys(e),n=0,o=i.length;n<o;n++)t[e[i[n]]]=i[n];return t},_.functions=_.methods=function(e){var t=[];for(var i in e)_.isFunction(e[i])&&t.push(i);return t.sort()},_.extend=function(i){return x(a.call(arguments,1),function(e){if(e)for(var t in e)i[t]=e[t]}),i},_.pick=function(t){var i={},e=l.apply(o,a.call(arguments,1));return x(e,function(e){e in t&&(i[e]=t[e])}),i},_.omit=function(e){var t={},i=l.apply(o,a.call(arguments,1));for(var n in e)_.contains(i,n)||(t[n]=e[n]);return t},_.defaults=function(i){return x(a.call(arguments,1),function(e){if(e)for(var t in e)void 0===i[t]&&(i[t]=e[t])}),i},_.clone=function(e){return _.isObject(e)?_.isArray(e)?e.slice():_.extend({},e):e},_.tap=function(e,t){return t(e),e};var T=function(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof _&&(e=e._wrapped),t instanceof _&&(t=t._wrapped);var o=u.call(e);if(o!=u.call(t))return!1;switch(o){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=i.length;s--;)if(i[s]==e)return n[s]==t;var r=e.constructor,a=t.constructor;if(r!==a&&!(_.isFunction(r)&&r instanceof r&&_.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1;i.push(e),n.push(t);var l=0,c=!0;if("[object Array]"==o){if(c=(l=e.length)==t.length)for(;l--&&(c=T(e[l],t[l],i,n)););}else{for(var d in e)if(_.has(e,d)&&(l++,!(c=_.has(t,d)&&T(e[d],t[d],i,n))))break;if(c){for(d in t)if(_.has(t,d)&&!l--)break;c=!l}}return i.pop(),n.pop(),c};_.isEqual=function(e,t){return T(e,t,[],[])},_.isEmpty=function(e){if(null==e)return!0;if(_.isArray(e)||_.isString(e))return 0===e.length;for(var t in e)if(_.has(e,t))return!1;return!0},_.isElement=function(e){return!(!e||1!==e.nodeType)},_.isArray=C||function(e){return"[object Array]"==u.call(e)},_.isObject=function(e){return e===Object(e)},x(["Arguments","Function","String","Number","Date","RegExp"],function(t){_["is"+t]=function(e){return u.call(e)=="[object "+t+"]"}}),_.isArguments(arguments)||(_.isArguments=function(e){return!(!e||!_.has(e,"callee"))}),"function"!=typeof/./&&(_.isFunction=function(e){return"function"==typeof e}),_.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},_.isNaN=function(e){return _.isNumber(e)&&e!=+e},_.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==u.call(e)},_.isNull=function(e){return null===e},_.isUndefined=function(e){return void 0===e},_.has=function(e,t){return c.call(e,t)},_.noConflict=function(){return e._=t,this},_.identity=function(e){return e},_.constant=function(e){return function(){return e}},_.property=function(t){return function(e){return e[t]}},_.matches=function(i){return function(e){if(e===i)return!0;for(var t in i)if(i[t]!==e[t])return!1;return!0}},_.times=function(e,t,i){for(var n=Array(Math.max(0,e)),o=0;o<e;o++)n[o]=t.call(i,o);return n},_.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},_.now=Date.now||function(){return(new Date).getTime()};var z={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};z.unescape=_.invert(z.escape);var M={escape:new RegExp("["+_.keys(z.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(z.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(t){_[t]=function(e){return null==e?"":(""+e).replace(M[t],function(e){return z[t][e]})}}),_.result=function(e,t){if(null!=e){var i=e[t];return _.isFunction(i)?i.call(e):i}},_.mixin=function(i){x(_.functions(i),function(e){var t=_[e]=i[e];_.prototype[e]=function(){var e=[this._wrapped];return s.apply(e,arguments),H.call(this,t.apply(_,e))}})};var N=0;_.uniqueId=function(e){var t=++N+"";return e?e+t:t},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var k=/(.)^/,R={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},F=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(s,e,t){var i;t=_.defaults({},t,_.templateSettings);var n=new RegExp([(t.escape||k).source,(t.interpolate||k).source,(t.evaluate||k).source].join("|")+"|$","g"),r=0,a="__p+='";s.replace(n,function(e,t,i,n,o){return a+=s.slice(r,o).replace(F,function(e){return"\\"+R[e]}),t&&(a+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'"),i&&(a+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),n&&(a+="';\n"+n+"\n__p+='"),r=o+e.length,e}),a+="';\n",t.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{i=new Function(t.variable||"obj","_",a)}catch(e){throw e.source=a,e}if(e)return i(e,_);function o(e){return i.call(this,e,_)}return o.source="function("+(t.variable||"obj")+"){\n"+a+"}",o},_.chain=function(e){return _(e).chain()};var H=function(e){return this._chain?_(e).chain():e};_.mixin(_),x(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var i=o[t];_.prototype[t]=function(){var e=this._wrapped;return i.apply(e,arguments),"shift"!=t&&"splice"!=t||0!==e.length||delete e[0],H.call(this,e)}}),x(["concat","join","slice"],function(e){var t=o[e];_.prototype[e]=function(){return H.call(this,t.apply(this._wrapped,arguments))}}),_.extend(_.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}.call(this),function(n,o){var e;"function"==typeof define&&define.amd?define(["underscore","jquery","exports"],function(e,t,i){n.Backbone=o(n,i,e,t)}):void 0!==exports?(e=require("underscore"),o(n,exports,e)):n.Backbone=o(n,{},n._,n.jQuery||n.Zepto||n.ender||n.$)}(this,function(e,l,b,t){var i=e.Backbone,o=[].slice;l.VERSION="1.1.2",l.$=t,l.noConflict=function(){return e.Backbone=i,this},l.emulateHTTP=!1,l.emulateJSON=!1;var n=l.Events={on:function(e,t,i){return u(this,"on",e,[t,i])&&t&&(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:i,ctx:i||this})),this},once:function(e,t,i){if(!u(this,"once",e,[t,i])||!t)return this;var n=this,o=b.once(function(){n.off(e,o),t.apply(this,arguments)});return o._callback=t,this.on(e,o,i)},off:function(e,t,i){if(!this._events||!u(this,"off",e,[t,i]))return this;if(!e&&!t&&!i)return this._events=void 0,this;for(var n=e?[e]:b.keys(this._events),o=0,s=n.length;o<s;o++){e=n[o];var r=this._events[e];if(r)if(t||i){for(var a=[],l=0,c=r.length;l<c;l++){var d=r[l];(t&&t!==d.callback&&t!==d.callback._callback||i&&i!==d.context)&&a.push(d)}a.length?this._events[e]=a:delete this._events[e]}else delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=o.call(arguments,1);if(!u(this,"trigger",e,t))return this;var i=this._events[e],n=this._events.all;return i&&s(i,t),n&&s(n,arguments),this},stopListening:function(e,t,i){var n=this._listeningTo;if(!n)return this;var o=!t&&!i;for(var s in i||"object"!=typeof t||(i=this),e&&((n={})[e._listenId]=e),n)(e=n[s]).off(t,i,this),(o||b.isEmpty(e._events))&&delete this._listeningTo[s];return this}},c=/\s+/,u=function(e,t,i,n){if(!i)return!0;if("object"==typeof i){for(var o in i)e[t].apply(e,[o,i[o]].concat(n));return!1}if(c.test(i)){for(var s=i.split(c),r=0,a=s.length;r<a;r++)e[t].apply(e,[s[r]].concat(n));return!1}return!0},s=function(e,t){var i,n=-1,o=e.length,s=t[0],r=t[1],a=t[2];switch(t.length){case 0:for(;++n<o;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<o;)(i=e[n]).callback.call(i.ctx,s);return;case 2:for(;++n<o;)(i=e[n]).callback.call(i.ctx,s,r);return;case 3:for(;++n<o;)(i=e[n]).callback.call(i.ctx,s,r,a);return;default:for(;++n<o;)(i=e[n]).callback.apply(i.ctx,t);return}};b.each({listenTo:"on",listenToOnce:"once"},function(o,e){n[e]=function(e,t,i){var n=this._listeningTo||(this._listeningTo={});return i||"object"!=typeof t||(i=this),(n[e._listenId||(e._listenId=b.uniqueId("l"))]=e)[o](t,i,this),this}}),n.bind=n.on,n.unbind=n.off,b.extend(l,n);var r=l.Model=function(e,t){var i=e||{};t=t||{},this.cid=b.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(i=this.parse(i,t)||{}),i=b.defaults({},i,b.result(this,"defaults")),this.set(i,t),this.changed={},this.initialize.apply(this,arguments)};b.extend(r.prototype,n,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return b.clone(this.attributes)},sync:function(){return l.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return b.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,i){var n,o,s,r,a,l,c,d;if(null==e)return this;if("object"==typeof e?(o=e,i=t):(o={})[e]=t,i=i||{},!this._validate(o,i))return!1;for(n in s=i.unset,a=i.silent,r=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=b.clone(this.attributes),this.changed={}),d=this.attributes,c=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]),o)t=o[n],b.isEqual(d[n],t)||r.push(n),b.isEqual(c[n],t)?delete this.changed[n]:this.changed[n]=t,s?delete d[n]:d[n]=t;if(!a){r.length&&(this._pending=i);for(var u=0,h=r.length;u<h;u++)this.trigger("change:"+r[u],this,d[r[u]],i)}if(l)return this;if(!a)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,b.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var i in this.attributes)t[i]=void 0;return this.set(t,b.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!b.isEmpty(this.changed):b.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&b.clone(this.changed);var t,i=!1,n=this._changing?this._previousAttributes:this.attributes;for(var o in e)b.isEqual(n[o],t=e[o])||((i=i||{})[o]=t);return i},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return b.clone(this._previousAttributes)},fetch:function(t){void 0===(t=t?b.clone(t):{}).parse&&(t.parse=!0);var i=this,n=t.success;return t.success=function(e){if(!i.set(i.parse(e,t),t))return!1;n&&n(i,e,t),i.trigger("sync",i,e,t)},V(this,t),this.sync("read",this,t)},save:function(e,t,i){var n,o,s,r=this.attributes;if(null==e||"object"==typeof e?(n=e,i=t):(n={})[e]=t,i=b.extend({validate:!0},i),n&&!i.wait){if(!this.set(n,i))return!1}else if(!this._validate(n,i))return!1;n&&i.wait&&(this.attributes=b.extend({},r,n)),void 0===i.parse&&(i.parse=!0);var a=this,l=i.success;return i.success=function(e){a.attributes=r;var t=a.parse(e,i);if(i.wait&&(t=b.extend(n||{},t)),b.isObject(t)&&!a.set(t,i))return!1;l&&l(a,e,i),a.trigger("sync",a,e,i)},V(this,i),"patch"==(o=this.isNew()?"create":i.patch?"patch":"update")&&(i.attrs=n),s=this.sync(o,this,i),n&&i.wait&&(this.attributes=r),s},destroy:function(t){t=t?b.clone(t):{};function i(){n.trigger("destroy",n,n.collection,t)}var n=this,o=t.success;if(t.success=function(e){(t.wait||n.isNew())&&i(),o&&o(n,e,t),n.isNew()||n.trigger("sync",n,e,t)},this.isNew())return t.success(),!1;V(this,t);var e=this.sync("delete",this,t);return t.wait||i(),e},url:function(){var e=b.result(this,"urlRoot")||b.result(this.collection,"url")||E();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},b.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=b.extend({},this.attributes,e);var i=this.validationError=this.validate(e,t)||null;return!i||(this.trigger("invalid",this,i,b.extend(t,{validationError:i})),!1)}});b.each(["keys","values","pairs","invert","pick","omit"],function(t){b[t]&&(r.prototype[t]=function(){var e=o.call(arguments);return e.unshift(this.attributes),b[t].apply(b,e)})});var a=l.Collection=function(e,t){(t=t||{}).model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,b.extend({silent:!0},t))},S={add:!0,remove:!0,merge:!0},d={add:!0,remove:!1};b.extend(a.prototype,n,{model:r,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return l.sync.apply(this,arguments)},add:function(e,t){return this.set(e,b.extend({merge:!1},t,d))},remove:function(e,t){var i=!b.isArray(e);t=t||{};for(var n=0,o=(e=i?[e]:b.clone(e)).length;n<o;n++){var s,r=e[n]=this.get(e[n]);r&&(delete this._byId[r.id],delete this._byId[r.cid],s=this.indexOf(r),this.models.splice(s,1),this.length--,t.silent||(t.index=s,r.trigger("remove",r,this,t)),this._removeReference(r,t))}return i?e[0]:e},set:function(e,t){(t=b.defaults({},t,S)).parse&&(e=this.parse(e,t));var i,n,o,s,r,a=!b.isArray(e);e=a?e?[e]:[]:e.slice();for(var l=t.at,c=this.comparator&&null==l&&!1!==t.sort,d=b.isString(this.comparator)?this.comparator:null,u=[],h=[],p={},f=t.add,m=t.merge,g=t.remove,v=!(c||!f||!g)&&[],y=0,w=e.length;y<w;y++){if(o=e[y]||{},i=this._isModel(o)?n=o:o[this.model.prototype.idAttribute||"id"],s=this.get(i))g&&(p[s.cid]=!0),m&&(o=o===n?n.attributes:o,t.parse&&(o=s.parse(o,t)),s.set(o,t),c&&!r&&s.hasChanged(d)&&(r=!0)),e[y]=s;else if(f){if(!(n=e[y]=this._prepareModel(o,t)))continue;u.push(n),this._addReference(n,t)}(n=s||n)&&(!v||!n.isNew()&&p[n.id]||v.push(n),p[n.id]=!0)}if(g){for(y=0,w=this.length;y<w;y++)p[(n=this.models[y]).cid]||h.push(n);h.length&&this.remove(h,t)}if(u.length||v&&v.length)if(c&&(r=!0),this.length+=u.length,null!=l)for(y=0,w=u.length;y<w;y++)this.models.splice(l+y,0,u[y]);else{v&&(this.models.length=0);for(var C=v||u,y=0,w=C.length;y<w;y++)this.models.push(C[y])}if(r&&this.sort({silent:!0}),!t.silent){for(y=0,w=u.length;y<w;y++)(n=u[y]).trigger("add",n,this,t);(r||v&&v.length)&&this.trigger("sort",this,t)}return a?e[0]:e},reset:function(e,t){t=t||{};for(var i=0,n=this.models.length;i<n;i++)this._removeReference(this.models[i],t);return t.previousModels=this.models,this._reset(),e=this.add(e,b.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,b.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,b.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return o.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(i,e){return b.isEmpty(i)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var t in i)if(i[t]!==e.get(t))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e=e||{},b.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(b.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return b.invoke(this.models,"get",e)},fetch:function(i){void 0===(i=i?b.clone(i):{}).parse&&(i.parse=!0);var n=i.success,o=this;return i.success=function(e){var t=i.reset?"reset":"set";o[t](e,i),n&&n(o,e,i),o.trigger("sync",o,e,i)},V(this,i),this.sync("read",this,i)},create:function(e,i){if(i=i?b.clone(i):{},!(e=this._prepareModel(e,i)))return!1;i.wait||this.add(e,i);var n=this,o=i.success;return i.success=function(e,t){i.wait&&n.add(e,i),o&&o(e,t,i)},e.save(null,i),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;var i=new(((t=t?b.clone(t):{}).collection=this).model)(e,t);return i.validationError?(this.trigger("invalid",this,i.validationError,t),!1):i},_isModel:function(e){return e instanceof r},_addReference:function(e,t){null!=(this._byId[e.cid]=e).id&&(this._byId[e.id]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){("add"!==e&&"remove"!==e||i===this)&&("destroy"===e&&this.remove(t,n),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});b.each(["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample","partition"],function(t){b[t]&&(a.prototype[t]=function(){var e=o.call(arguments);return e.unshift(this.models),b[t].apply(b,e)})});b.each(["groupBy","countBy","sortBy","indexBy"],function(n){b[n]&&(a.prototype[n]=function(t,e){var i=b.isFunction(t)?t:function(e){return e.get(t)};return b[n](this.models,i,e)})});var h=l.View=function(e){this.cid=b.uniqueId("view"),e=e||{},b.extend(this,b.pick(e,f)),this._ensureElement(),this.initialize.apply(this,arguments)},p=/^(\S+)\s*(.*)$/,f=["model","collection","el","id","attributes","className","tagName","events"];b.extend(h.prototype,n,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof l.$?e:l.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(!(e=e||b.result(this,"events")))return this;for(var t in this.undelegateEvents(),e){var i,n=e[t];b.isFunction(n)||(n=this[e[t]]),n&&(i=t.match(p),this.delegate(i[1],i[2],b.bind(n,this)))}return this},delegate:function(e,t,i){this.$el.on(e+".delegateEvents"+this.cid,t,i)},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,i){this.$el.off(e+".delegateEvents"+this.cid,t,i)},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){var e;this.el?this.setElement(b.result(this,"el")):(e=b.extend({},b.result(this,"attributes")),this.id&&(e.id=b.result(this,"id")),this.className&&(e.class=b.result(this,"className")),this.setElement(this._createElement(b.result(this,"tagName"))),this._setAttributes(e))},_setAttributes:function(e){this.$el.attr(e)}}),l.sync=function(e,t,n){var i=g[e];b.defaults(n=n||{},{emulateHTTP:l.emulateHTTP,emulateJSON:l.emulateJSON});var o,s={type:i,dataType:"json"};n.url||(s.url=b.result(t,"url")||E()),null!=n.data||!t||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",s.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),!n.emulateHTTP||"PUT"!==i&&"DELETE"!==i&&"PATCH"!==i||(s.type="POST",n.emulateJSON&&(s.data._method=i),o=n.beforeSend,n.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",i),o)return o.apply(this,arguments)}),"GET"===s.type||n.emulateJSON||(s.processData=!1),"PATCH"===s.type&&m&&(s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var r=n.error;n.error=function(e,t,i){n.textStatus=t,n.errorThrown=i,r&&r.apply(this,arguments)};var a=n.xhr=l.ajax(b.extend(s,n));return t.trigger("request",t,a,n),a};var m=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),g={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};l.ajax=function(){return l.$.ajax.apply(l.$,arguments)};var v=l.Router=function(e){(e=e||{}).routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},y=/\((.*?)\)/g,w=/(\(\?)?:\w+/g,C=/\*\w+/g,_=/[\-{}\[\]+?.,\\\^$|#\s]/g;b.extend(v.prototype,n,{initialize:function(){},route:function(i,n,o){b.isRegExp(i)||(i=this._routeToRegExp(i)),b.isFunction(n)&&(o=n,n=""),o=o||this[n];var s=this;return l.history.route(i,function(e){var t=s._extractParameters(i,e);!1!==s.execute(o,t,n)&&(s.trigger.apply(s,["route:"+n].concat(t)),s.trigger("route",n,t),l.history.trigger("route",s,n,t))}),this},execute:function(e,t,i){e&&e.apply(this,t)},navigate:function(e,t){return l.history.navigate(e,t),this},_bindRoutes:function(){if(this.routes){this.routes=b.result(this,"routes");for(var e,t=b.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(_,"\\$&").replace(y,"(?:$1)?").replace(w,function(e,t){return t?e:"([^/?]+)"}).replace(C,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var i=e.exec(t).slice(1);return b.map(i,function(e,t){return t===i.length-1?e||null:e?decodeURIComponent(e):null})}});var x=l.History=function(){this.handlers=[],b.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},A=/^[#\/]|\s+$/g,I=/^\/+|\/+$/g,O=/#.*$/;x.started=!1,b.extend(x.prototype,n,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.location.search},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=decodeURI(this.location.pathname+this.location.search),t=this.root.slice(0,-1);return e.indexOf(t)||(e=e.slice(t.length)),e.slice(1)},getFragment:function(e){return null==e&&(e=this._hasPushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(A,"")},start:function(e){if(x.started)throw new Error("Backbone.history has already been started");x.started=!0,this.options=b.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState),this.fragment=this.getFragment();var t,i,n=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};if(this.root=("/"+this.root+"/").replace(I,"/"),this._hasHashChange||!this._wantsHashChange||this._wantsPushState&&this._hasPushState||((t=document.createElement("iframe")).src="javascript:0",t.style.display="none",t.tabIndex=-1,i=document.body,this.iframe=i.insertBefore(t,i.firstChild).contentWindow,this.navigate(this.fragment)),this._hasPushState?n("popstate",this.checkUrl,!1):this._wantsHashChange&&this._hasHashChange&&!this.iframe?n("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.location.replace(this.root+"#"+this.getPath()),!0;this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._hasPushState?e("popstate",this.checkUrl,!1):this._wantsHashChange&&this._hasHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe.frameElement),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),x.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(t){return t=this.fragment=this.getFragment(t),b.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0})},navigate:function(e,t){if(!x.started)return!1;t&&!0!==t||(t={trigger:!!t});var i=this.root+(e=this.getFragment(e||""));if(e=decodeURI(e.replace(O,"")),this.fragment!==e){if(""===(this.fragment=e)&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe)&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){var n;i?(n=e.href.replace(/(javascript:|#).*$/,""),e.replace(n+"#"+t)):e.hash="#"+t}}),l.history=new x;r.extend=a.extend=v.extend=h.extend=x.extend=function(e,t){var i=this,n=e&&b.has(e,"constructor")?e.constructor:function(){return i.apply(this,arguments)};b.extend(n,i,t);function o(){this.constructor=n}return o.prototype=i.prototype,n.prototype=new o,e&&b.extend(n.prototype,e),n.__super__=i.prototype,n};var E=function(){throw new Error('A "url" property or function must be specified')},V=function(t,i){var n=i.error;i.error=function(e){n&&n(t,e,i),t.trigger("error",t,e,i)}};return l});var TAFFY,exports,T,Marionette=function(o,c){"use strict";var e,t,i,s,n,r,a,l,d,u,h;function p(e){this.options=e,this._wreqrHandlers={},r.isFunction(this.initialize)&&this.initialize(e)}function f(e){this.options=e,this._commands={},s.isFunction(this.initialize)&&this.initialize(e)}function m(){}function g(e){this.vent=new i.Wreqr.EventAggregator,this.reqres=new i.Wreqr.RequestResponse,this.commands=new i.Wreqr.Commands,this.channelName=e}t=(e=o).ChildViewContainer,e.ChildViewContainer=function(n){function e(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),n.each(e,this.add,this)}return n.extend(e.prototype,{add:function(e,t){var i=e.cid;return(this._views[i]=e).model&&(this._indexByModel[e.model.cid]=i),t&&(this._indexByCustom[t]=i),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return n.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var i=e.cid;return e.model&&delete this._indexByModel[e.model.cid],n.any(this._indexByCustom,function(e,t){if(e===i)return delete this._indexByCustom[t],!0},this),delete this._views[i],this._updateLength(),this},call:function(e){this.apply(e,n.tail(arguments))},apply:function(t,i){n.each(this._views,function(e){n.isFunction(e[t])&&e[t].apply(e,i||[])})},_updateLength:function(){this.length=n.size(this._views)}}),n.each(["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"],function(t){e.prototype[t]=function(){var e=[n.values(this._views)].concat(n.toArray(arguments));return n[t].apply(n,e)}}),e}(c),e.ChildViewContainer.VERSION="0.1.4",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=t,this},e.ChildViewContainer,s=c,u=(i=o).Wreqr,h=i.Wreqr={},i.Wreqr.VERSION="1.3.1",i.Wreqr.noConflict=function(){return i.Wreqr=u,this},h.Handlers=(r=s,p.extend=(n=i).Model.extend,r.extend(p.prototype,n.Events,{setHandlers:function(e){r.each(e,function(e,t){var i=null;r.isObject(e)&&!r.isFunction(e)&&(i=e.context,e=e.callback),this.setHandler(t,e,i)},this)},setHandler:function(e,t,i){var n={callback:t,context:i};this._wreqrHandlers[e]=n,this.trigger("handler:add",e,t,i)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(t)return function(){var e=Array.prototype.slice.apply(arguments);return t.callback.apply(t.context,e)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),p),h.CommandStorage=(s.extend(f.prototype,i.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){this.getCommands(e).instances.push(t)},clearCommands:function(e){this.getCommands(e).instances=[]}}),f),h.Commands=(a=h).Handlers.extend({storageType:a.CommandStorage,constructor:function(e){this.options=e||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var t=Array.prototype.slice.call(arguments);a.Handlers.prototype.constructor.apply(this,t)},execute:function(e,t){e=arguments[0],t=Array.prototype.slice.call(arguments,1),this.hasHandler(e)?this.getHandler(e).apply(this,t):this.storage.addCommand(e,t)},_executeCommands:function(e,t,i){var n=this.storage.getCommands(e);s.each(n.instances,function(e){t.apply(i,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var t=e.storageType||this.storageType,i=s.isFunction(t)?new t:t;this.storage=i}}),h.RequestResponse=h.Handlers.extend({request:function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);if(this.hasHandler(e))return this.getHandler(e).apply(this,t)}}),h.EventAggregator=(d=s,m.extend=(l=i).Model.extend,d.extend(m.prototype,l.Events),m),h.Channel=(s.extend(g.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(e,t){return this._connect("vent",e,t),this},connectCommands:function(e,t){return this._connect("commands",e,t),this},connectRequests:function(e,t){return this._connect("reqres",e,t),this},_connect:function(i,e,n){var o;e&&(n=n||this,o="vent"===i?"on":"setHandler",s.each(e,function(e,t){this[i][o](t,s.bind(e,n))},this))}}),g),h.radio=function(i){function e(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()}s.extend(e.prototype,{channel:function(e){if(!e)throw new Error("Channel must receive a name");return this._getChannel(e)},_getChannel:function(e){var t=this._channels[e];return t||(t=new i.Channel(e),this._channels[e]=t),t},_proxyMethods:function(){s.each(["vent","commands","reqres"],function(t){s.each(n[t],function(e){this[t][e]=o(this,t,e)},this)},this)}});var n={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},o=function(n,o,s){return function(e){var t=n._getChannel(e)[o],i=Array.prototype.slice.call(arguments,1);return t[s].apply(t,i)}};return new e}(h),i.Wreqr;var v={};(o.Marionette=v).$=o.$;var y,w,C,b,S,_,x,A,I,O=Array.prototype.slice;function E(e,t){var i=new Error(e);throw i.name=t||"Error",i}function V(e,t,i){return i.toUpperCase()}function P(e){var t;e._isShown&&e._isRendered&&(t=e,w.contains(t.el))&&c.isFunction(e.triggerMethod)&&e.triggerMethod("dom:refresh")}function T(i,n,o,e){var t=e.split(/\s+/);c.each(t,function(e){var t=i[e];t||E("Method '"+e+"' was configured as an event handler, but does not exist."),i.listenTo(n,o,t)})}function z(e,t,i,n){e.listenTo(t,i,n)}function M(i,n,o,e){var t=e.split(/\s+/);c.each(t,function(e){var t=i[e];i.stopListening(n,o,t)})}function N(e,t,i,n){e.stopListening(t,i,n)}function k(i,n,e,o,s){n&&e&&(c.isFunction(e)&&(e=e.call(i)),c.each(e,function(e,t){(c.isFunction(e)?o:s)(i,n,t,e)}))}function R(e,t){this.view=t,this.defaults=_.result(this,"defaults")||{},this.options=_.extend({},this.defaults,e),this.$=function(){return this.view.$.apply(this.view,arguments)},this.initialize.apply(this,arguments)}function F(e){this.behaviors=F.parseBehaviors(e,A.result(e,"behaviors")),F.wrap(e,this.behaviors,["bindUIElements","unbindUIElements","delegateEvents","undelegateEvents","behaviorEvents","triggerMethod","setElement","close"])}return v.extend=o.Model.extend,v.getOption=function(e,t){if(e&&t){var i=e.options&&t in e.options&&void 0!==e.options[t]?e.options[t]:e[t];return i}},v.normalizeMethods=function(e){var i,n={};return c.each(e,function(e,t){i=e,c.isFunction(i)||(i=this[i]),i&&(n[t]=i)},this),n},v.normalizeUIKeys=function(i,n){if(void 0!==i)return c.each(c.keys(i),function(e){var t=/@ui.[a-zA-Z_$0-9]*/g;e.match(t)&&(i[e.replace(t,function(e){return n[e.slice(4)]})]=i[e],delete i[e])}),i},v.actAsCollection=function(e,i){c.each(["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"],function(t){e[t]=function(){var e=[c.values(c.result(this,i))].concat(c.toArray(arguments));return c[t].apply(c,e)}})},v.triggerMethod=(y=/(^|:)(\w)/gi,function(e){var t=this["on"+e.replace(y,V)];if(c.isFunction(this.trigger)&&this.trigger.apply(this,arguments),c.isFunction(t))return t.apply(this,c.tail(arguments))}),v.MonitorDOMRefresh=(w=document.documentElement,function(t){t.listenTo(t,"show",function(){var e;(e=t)._isShown=!0,P(e)}),t.listenTo(t,"render",function(){var e;(e=t)._isRendered=!0,P(e)})}),(C=v).bindEntityEvents=function(e,t,i){k(e,t,i,z,T)},C.unbindEntityEvents=function(e,t,i){k(e,t,i,N,M)},v.Callbacks=function(){this._deferred=v.$.Deferred(),this._callbacks=[]},c.extend(v.Callbacks.prototype,{add:function(i,n){this._callbacks.push({cb:i,ctx:n}),this._deferred.done(function(e,t){n&&(e=n),i.call(e,t)})},run:function(e,t){this._deferred.resolve(t,e)},reset:function(){var e=this._callbacks;this._deferred=v.$.Deferred(),this._callbacks=[],c.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),v.Controller=function(e){this.triggerMethod=v.triggerMethod,this.options=e||{},c.isFunction(this.initialize)&&this.initialize(this.options)},v.Controller.extend=v.extend,c.extend(v.Controller.prototype,o.Events,{close:function(){this.stopListening();var e=Array.prototype.slice.call(arguments);this.triggerMethod.apply(this,["close"].concat(e)),this.off()}}),v.Region=function(e){var t;this.options=e||{},this.el=v.getOption(this,"el"),this.el||E("An 'el' must be specified for a region.","NoElError"),this.initialize&&(t=Array.prototype.slice.apply(arguments),this.initialize.apply(this,t))},c.extend(v.Region,{buildRegion:function(i,e){var t,n,o=c.isString(i),s=c.isString(i.selector),r=c.isUndefined(i.regionType),a=c.isFunction(i);a||o||s||E("Region must be specified as a Region type, a selector string or an object with selector property"),o&&(t=i),i.selector&&(t=i.selector,delete i.selector),a&&(n=i),!a&&r&&(n=e),i.regionType&&(n=i.regionType,delete i.regionType),(o||a)&&(i={}),i.el=t;var l=new n(i);return i.parentEl&&(l.getEl=function(e){var t=i.parentEl;return c.isFunction(t)&&(t=t()),t.find(e)}),l}}),c.extend(v.Region.prototype,o.Events,{show:function(e,t){this.ensureEl();var i=t||{},n=e.isClosed||c.isUndefined(e.$el),o=e!==this.currentView;return!!!i.preventClose&&o&&this.close(),e.render(),v.triggerMethod.call(this,"before:show",e),c.isFunction(e.triggerMethod)?e.triggerMethod("before:show"):v.triggerMethod.call(e,"before:show"),(o||n)&&this.open(e),this.currentView=e,v.triggerMethod.call(this,"show",e),c.isFunction(e.triggerMethod)?e.triggerMethod("show"):v.triggerMethod.call(e,"show"),this},ensureEl:function(){this.$el&&0!==this.$el.length||(this.$el=this.getEl(this.el))},getEl:function(e){return v.$(e)},open:function(e){this.$el.empty().append(e.el)},close:function(){var e=this.currentView;e&&!e.isClosed&&(e.close?e.close():e.remove&&e.remove(),v.triggerMethod.call(this,"close",e),delete this.currentView)},attachView:function(e){this.currentView=e},reset:function(){this.close(),delete this.$el}}),v.Region.extend=v.extend,v.RegionManager=(S=(b=v).Controller.extend({constructor:function(e){this._regions={},b.Controller.prototype.constructor.call(this,e)},addRegions:function(e,n){var o={};return c.each(e,function(e,t){c.isString(e)&&(e={selector:e}),e.selector&&(e=c.defaults({},e,n));var i=this.addRegion(t,e);o[t]=i},this),o},addRegion:function(e,t){var i=c.isObject(t),n=c.isString(t),o=!!t.selector,s=n||i&&o||c.isFunction(t)?b.Region.buildRegion(t,b.Region):t;return this._store(e,s),this.triggerMethod("region:add",e,s),s},get:function(e){return this._regions[e]},removeRegion:function(e){var t=this._regions[e];this._remove(e,t)},removeRegions:function(){c.each(this._regions,function(e,t){this._remove(t,e)},this)},closeRegions:function(){c.each(this._regions,function(e,t){e.close()},this)},close:function(){this.removeRegions(),b.Controller.prototype.close.apply(this,arguments)},_store:function(e,t){this._regions[e]=t,this._setLength()},_remove:function(e,t){t.close(),t.stopListening(),delete this._regions[e],this._setLength(),this.triggerMethod("region:remove",e,t)},_setLength:function(){this.length=c.size(this._regions)}}),b.actAsCollection(S.prototype,"_regions"),S),v.TemplateCache=function(e){this.templateId=e},c.extend(v.TemplateCache,{templateCaches:{},get:function(e){var t=this.templateCaches[e];return t||(t=new v.TemplateCache(e),this.templateCaches[e]=t),t.load()},clear:function(){var e,t=O.call(arguments),i=t.length;if(0<i)for(e=0;e<i;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),c.extend(v.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var e=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(e),this.compiledTemplate},loadTemplate:function(e){var t=v.$(e).html();return t&&0!==t.length||E("Could not find template: '"+e+"'","NoTemplateError"),t},compileTemplate:function(e){return c.template(e)}}),v.Renderer={render:function(e,t){return e||E("Cannot render the template since it's false, null or undefined.","TemplateNotFoundError"),("function"==typeof e?e:v.TemplateCache.get(e))(t)}},v.View=o.View.extend({constructor:function(e){c.bindAll(this,"render"),this.options=c.extend({},c.result(this,"options"),c.isFunction(e)?e.call(this):e),this.events=this.normalizeUIKeys(c.result(this,"events")),c.isObject(this.behaviors)&&new v.Behaviors(this),o.View.prototype.constructor.apply(this,arguments),v.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled)},triggerMethod:v.triggerMethod,normalizeMethods:v.normalizeMethods,getTemplate:function(){return v.getOption(this,"template")},mixinTemplateHelpers:function(e){e=e||{};var t=v.getOption(this,"templateHelpers");return c.isFunction(t)&&(t=t.call(this)),c.extend(e,t)},normalizeUIKeys:function(e){var t=c.result(this,"ui");return v.normalizeUIKeys(e,t)},configureTriggers:function(){if(this.triggers){var t={},e=this.normalizeUIKeys(c.result(this,"triggers"));return c.each(e,function(r,e){var a=c.isObject(r),l=a?r.event:r;t[e]=function(e){var t,i,n,o;e&&(t=e.preventDefault,i=e.stopPropagation,n=a?r.preventDefault:t,o=a?r.stopPropagation:i,n&&t&&t.apply(e),o&&i&&i.apply(e));var s={view:this,model:this.model,collection:this.collection};this.triggerMethod(l,s)}},this),t}},delegateEvents:function(e){this._delegateDOMEvents(e),v.bindEntityEvents(this,this.model,v.getOption(this,"modelEvents")),v.bindEntityEvents(this,this.collection,v.getOption(this,"collectionEvents"))},_delegateDOMEvents:function(e){e=e||this.events,c.isFunction(e)&&(e=e.call(this));var t={},i=c.result(this,"behaviorEvents")||{},n=this.configureTriggers();c.extend(t,i,e,n),o.View.prototype.delegateEvents.call(this,t)},undelegateEvents:function(){var e=Array.prototype.slice.call(arguments);o.View.prototype.undelegateEvents.apply(this,e),v.unbindEntityEvents(this,this.model,v.getOption(this,"modelEvents")),v.unbindEntityEvents(this,this.collection,v.getOption(this,"collectionEvents"))},onShowCalled:function(){},close:function(){var e;this.isClosed||(e=Array.prototype.slice.call(arguments),!1!==this.triggerMethod.apply(this,["before:close"].concat(e))&&(this.isClosed=!0,this.triggerMethod.apply(this,["close"].concat(e)),this.unbindUIElements(),this.remove()))},bindUIElements:function(){var i;this.ui&&(this._uiBindings||(this._uiBindings=this.ui),i=c.result(this,"_uiBindings"),this.ui={},c.each(c.keys(i),function(e){var t=i[e];this.ui[e]=this.$(t)},this))},unbindUIElements:function(){this.ui&&this._uiBindings&&(c.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings)}}),v.ItemView=v.View.extend({constructor:function(){v.View.prototype.constructor.apply(this,arguments)},serializeData:function(){var e={};return this.model?e=this.model.toJSON():this.collection&&(e={items:this.collection.toJSON()}),e},render:function(){this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this);var e=this.serializeData(),e=this.mixinTemplateHelpers(e),t=this.getTemplate(),i=v.Renderer.render(t,e);return this.$el.html(i),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},close:function(){this.isClosed||(this.triggerMethod("item:before:close"),v.View.prototype.close.apply(this,arguments),this.triggerMethod("item:closed"))}}),v.CollectionView=v.View.extend({itemViewEventPrefix:"itemview",constructor:function(e){this._initChildViewStorage(),v.View.prototype.constructor.apply(this,arguments),this._initialEvents(),this.initRenderBuffer()},initRenderBuffer:function(){this.elBuffer=document.createDocumentFragment(),this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this.appendBuffer(this,this.elBuffer),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerShowBufferedChildren:function(){this._isShown&&(c.each(this._bufferedChildren,function(e){c.isFunction(e.triggerMethod)?e.triggerMethod("show"):v.triggerMethod.call(e,"show")}),this._bufferedChildren=[])},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView),this.listenTo(this.collection,"remove",this.removeItemView),this.listenTo(this.collection,"reset",this.render))},addChildView:function(e,t,i){this.closeEmptyView();var n=this.getItemView(e),o=this.collection.indexOf(e);this.addItemView(e,n,o)},onShowCalled:function(){this.children.each(function(e){c.isFunction(e.triggerMethod)?e.triggerMethod("show"):v.triggerMethod.call(e,"show")})},triggerBeforeRender:function(){this.triggerMethod("before:render",this),this.triggerMethod("collection:before:render",this)},triggerRendered:function(){this.triggerMethod("render",this),this.triggerMethod("collection:rendered",this)},render:function(){return this.isClosed=!1,this.triggerBeforeRender(),this._renderChildren(),this.triggerRendered(),this},_renderChildren:function(){this.startBuffering(),this.closeEmptyView(),this.closeChildren(),this.isEmpty(this.collection)?this.showEmptyView():this.showCollection(),this.endBuffering()},showCollection:function(){var i;this.collection.each(function(e,t){i=this.getItemView(e),this.addItemView(e,i,t)},this)},showEmptyView:function(){var e,t=this.getEmptyView();t&&!this._showingEmptyView&&(this._showingEmptyView=!0,e=new o.Model,this.addItemView(e,t,0))},closeEmptyView:function(){this._showingEmptyView&&(this.closeChildren(),delete this._showingEmptyView)},getEmptyView:function(){return v.getOption(this,"emptyView")},getItemView:function(e){var t=v.getOption(this,"itemView");return t||E("An `itemView` must be specified","NoItemViewError"),t},addItemView:function(e,t,i){var n=v.getOption(this,"itemViewOptions");c.isFunction(n)&&(n=n.call(this,e,i));var o=this.buildItemView(e,t,n);return this.addChildViewEventForwarding(o),this.triggerMethod("before:item:added",o),this.children.add(o),this.renderItemView(o,i),this._isShown&&!this.isBuffering&&(c.isFunction(o.triggerMethod)?o.triggerMethod("show"):v.triggerMethod.call(o,"show")),this.triggerMethod("after:item:added",o),o},addChildViewEventForwarding:function(n){var o=v.getOption(this,"itemViewEventPrefix");this.listenTo(n,"all",function(){var e=O.call(arguments),t=e[0],i=this.normalizeMethods(this.getItemEvents());e[0]=o+":"+t,e.splice(1,0,n),void 0!==i&&c.isFunction(i[t])&&i[t].apply(this,e),v.triggerMethod.apply(this,e)},this)},getItemEvents:function(){return c.isFunction(this.itemEvents)?this.itemEvents.call(this):this.itemEvents},renderItemView:function(e,t){e.render(),this.appendHtml(this,e,t)},buildItemView:function(e,t,i){return new t(c.extend({model:e},i))},removeItemView:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},removeChildView:function(e){e&&(e.close?e.close():e.remove&&e.remove(),this.stopListening(e),this.children.remove(e)),this.triggerMethod("item:removed",e)},isEmpty:function(e){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},appendBuffer:function(e,t){e.$el.append(t)},appendHtml:function(e,t,i){e.isBuffering?(e.elBuffer.appendChild(t.el),e._bufferedChildren.push(t)):e.$el.append(t.el)},_initChildViewStorage:function(){this.children=new o.ChildViewContainer},close:function(){this.isClosed||(this.triggerMethod("collection:before:close"),this.closeChildren(),this.triggerMethod("collection:closed"),v.View.prototype.close.apply(this,arguments))},closeChildren:function(){this.children.each(function(e){this.removeChildView(e)},this),this.checkEmpty()}}),v.CompositeView=v.CollectionView.extend({constructor:function(){v.CollectionView.prototype.constructor.apply(this,arguments)},_initialEvents:function(){this.once("render",function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView),this.listenTo(this.collection,"remove",this.removeItemView),this.listenTo(this.collection,"reset",this._renderChildren))})},getItemView:function(e){var t=v.getOption(this,"itemView")||this.constructor;return t||E("An `itemView` must be specified","NoItemViewError"),t},serializeData:function(){var e={};return this.model&&(e=this.model.toJSON()),e},render:function(){this.isRendered=!0,this.isClosed=!1,this.resetItemViewContainer(),this.triggerBeforeRender();var e=this.renderModel();return this.$el.html(e),this.bindUIElements(),this.triggerMethod("composite:model:rendered"),this._renderChildren(),this.triggerMethod("composite:rendered"),this.triggerRendered(),this},_renderChildren:function(){this.isRendered&&(this.triggerMethod("composite:collection:before:render"),v.CollectionView.prototype._renderChildren.call(this),this.triggerMethod("composite:collection:rendered"))},renderModel:function(){var e={},e=this.serializeData();e=this.mixinTemplateHelpers(e);var t=this.getTemplate();return v.Renderer.render(t,e)},appendBuffer:function(e,t){this.getItemViewContainer(e).append(t)},appendHtml:function(e,t,i){e.isBuffering?(e.elBuffer.appendChild(t.el),e._bufferedChildren.push(t)):this.getItemViewContainer(e).append(t.el)},getItemViewContainer:function(e){if("$itemViewContainer"in e)return e.$itemViewContainer;var t,i,n=v.getOption(e,"itemViewContainer");return n?(i="@"===(t=c.isFunction(n)?n.call(e):n).charAt(0)&&e.ui?e.ui[t.substr(4)]:e.$(t)).length<=0&&E("The specified `itemViewContainer` was not found: "+e.itemViewContainer,"ItemViewContainerMissingError"):i=e.$el,e.$itemViewContainer=i},resetItemViewContainer:function(){this.$itemViewContainer&&delete this.$itemViewContainer}}),v.Layout=v.ItemView.extend({regionType:v.Region,constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),v.ItemView.prototype.constructor.call(this,e)},render:function(){return this.isClosed&&this._initializeRegions(),this._firstRender?this._firstRender=!1:this.isClosed||this._reInitializeRegions(),v.ItemView.prototype.render.apply(this,arguments)},close:function(){this.isClosed||(this.regionManager.close(),v.ItemView.prototype.close.apply(this,arguments))},addRegion:function(e,t){var i={};return i[e]=t,this._buildRegions(i)[e]},addRegions:function(e){return this.regions=c.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},_buildRegions:function(e){var t=this,i={regionType:v.getOption(this,"regionType"),parentEl:function(){return t.$el}};return this.regionManager.addRegions(e,i)},_initializeRegions:function(e){var t;this._initRegionManager(),t=c.isFunction(this.regions)?this.regions(e):this.regions||{},this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.closeRegions(),this.regionManager.each(function(e){e.reset()})},_initRegionManager:function(){this.regionManager=new v.RegionManager,this.listenTo(this.regionManager,"region:add",function(e,t){this[e]=t,this.trigger("region:add",e,t)}),this.listenTo(this.regionManager,"region:remove",function(e,t){delete this[e],this.trigger("region:remove",e,t)})}}),v.Behavior=((_=c).extend(R.prototype,o.Events,{initialize:function(){},close:function(){this.stopListening()},triggerMethod:v.triggerMethod}),R.extend=v.extend,R),v.Behaviors=(x=v,I={setElement:function(e,t){e.apply(this,A.tail(arguments,2)),A.each(t,function(e){e.$el=this.$el},this)},close:function(e,t){var i=A.tail(arguments,2);e.apply(this,i),A.invoke(t,"close",i)},bindUIElements:function(e,t){e.apply(this),A.invoke(t,e)},unbindUIElements:function(e,t){e.apply(this),A.invoke(t,e)},triggerMethod:function(t,e){var i=A.tail(arguments,2);t.apply(this,i),A.each(e,function(e){t.apply(e,i)})},delegateEvents:function(e,t){var i=A.tail(arguments,2);e.apply(this,i),A.each(t,function(e){x.bindEntityEvents(e,this.model,x.getOption(e,"modelEvents")),x.bindEntityEvents(e,this.collection,x.getOption(e,"collectionEvents"))},this)},undelegateEvents:function(e,t){var i=A.tail(arguments,2);e.apply(this,i),A.each(t,function(e){x.unbindEntityEvents(e,this.model,x.getOption(e,"modelEvents")),x.unbindEntityEvents(e,this.collection,x.getOption(e,"collectionEvents"))},this)},behaviorEvents:function(e,t){var i={},a=A.result(this,"ui");return A.each(t,function(n,o){var s={},r=A.clone(A.result(n,"events"))||{},e=A.result(n,"ui"),t=A.extend({},a,e),r=x.normalizeUIKeys(r,t);A.each(A.keys(r),function(e){var t=e+new Array(o+2).join(" "),i=A.isFunction(r[e])?r[e]:n[r[e]];s[t]=A.bind(i,n)}),i=A.extend(i,s)}),i}},(A=c).extend(F,{behaviorsLookup:function(){throw new Error("You must define where your behaviors are stored. See https://github.com/marionettejs/backbone.marionette/blob/master/docs/marionette.behaviors.md#behaviorslookup")},getBehaviorClass:function(e,t){return e.behaviorClass?e.behaviorClass:A.isFunction(F.behaviorsLookup)?F.behaviorsLookup.apply(this,arguments)[t]:F.behaviorsLookup[t]},parseBehaviors:function(i,e){return A.map(e,function(e,t){return new(F.getBehaviorClass(e,t))(e,i)})},wrap:function(t,i,e){A.each(e,function(e){t[e]=A.partial(I[e],t[e],i)})}}),F),v.AppRouter=o.Router.extend({constructor:function(e){o.Router.prototype.constructor.apply(this,arguments),this.options=e||{};var t=v.getOption(this,"appRoutes"),i=this._getController();this.processAppRoutes(i,t),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var i=this._getController();this._addAppRoute(i,e,t)},_processOnRoute:function(e,t){var i=c.invert(this.appRoutes)[e];c.isFunction(this.onRoute)&&this.onRoute(e,i,t)},processAppRoutes:function(t,i){var e;i&&(e=c.keys(i).reverse(),c.each(e,function(e){this._addAppRoute(t,e,i[e])},this))},_getController:function(){return v.getOption(this,"controller")},_addAppRoute:function(e,t,i){var n=e[i];n||E("Method '"+i+"' was not found on the controller"),this.route(t,i,c.bind(n,e))}}),v.Application=function(e){this._initRegionManager(),this._initCallbacks=new v.Callbacks,this.vent=new o.Wreqr.EventAggregator,this.commands=new o.Wreqr.Commands,this.reqres=new o.Wreqr.RequestResponse,this.submodules={},c.extend(this,e),this.triggerMethod=v.triggerMethod},c.extend(v.Application.prototype,o.Events,{execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("initialize:before",e),this._initCallbacks.run(e,this),this.triggerMethod("initialize:after",e),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},closeRegions:function(){this._regionManager.closeRegions()},removeRegion:function(e){this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},module:function(e,t){var i=v.Module.getClass(t),n=O.call(arguments);return n.unshift(this),i.create.apply(i,n)},_initRegionManager:function(){this._regionManager=new v.RegionManager,this.listenTo(this._regionManager,"region:add",function(e,t){this[e]=t}),this.listenTo(this._regionManager,"region:remove",function(e,t){delete this[e]})}}),v.Application.extend=v.extend,v.Module=function(e,t,i){this.moduleName=e,this.options=c.extend({},this.options,i),this.initialize=i.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,this.startWithParent=!0,this.triggerMethod=v.triggerMethod,c.isFunction(this.initialize)&&this.initialize(this.options,e,t)},v.Module.extend=v.extend,c.extend(v.Module.prototype,o.Events,{initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(t){this._isInitialized||(c.each(this.submodules,function(e){e.startWithParent&&e.start(t)}),this.triggerMethod("before:start",t),this._initializerCallbacks.run(t,this),this._isInitialized=!0,this.triggerMethod("start",t))},stop:function(){this._isInitialized&&(this._isInitialized=!1,v.triggerMethod.call(this,"before:stop"),c.each(this.submodules,function(e){e.stop()}),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),v.triggerMethod.call(this,"stop"))},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,t){var i;e&&(i=c.flatten([this,this.app,o,v,v.$,c,t]),e.apply(this,i))},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new v.Callbacks,this._finalizerCallbacks=new v.Callbacks}}),c.extend(v.Module,{create:function(n,e,o){var s=n,r=O.call(arguments);r.splice(0,3);var t=(e=e.split(".")).length,a=[];return a[t-1]=o,c.each(e,function(e,t){var i=s;s=this._getModule(i,e,n,o),this._addModuleDefinition(i,s,a[t],r)},this),s},_getModule:function(e,t,i,n,o){var s=c.extend({},n),r=this.getClass(n),a=e[t];return a||(a=new r(t,i,s),e[t]=a,e.submodules[t]=a),a},getClass:function(e){var t=v.Module;return e?e.prototype instanceof t?e:e.moduleClass||t:t},_addModuleDefinition:function(e,t,i,n){var o=this._getDefine(i),s=this._getStartWithParent(i,t);o&&t.addDefinition(o,n),this._addStartWithParent(e,t,s)},_getStartWithParent:function(e,t){var i;return c.isFunction(e)&&e.prototype instanceof v.Module?(i=t.constructor.prototype.startWithParent,!!c.isUndefined(i)||i):!c.isObject(e)||(i=e.startWithParent,!!c.isUndefined(i)||i)},_getDefine:function(e){return!c.isFunction(e)||e.prototype instanceof v.Module?c.isObject(e)?e.define:null:e},_addStartWithParent:function(e,t,i){t.startWithParent=t.startWithParent&&i,t.startWithParent&&!t.startWithParentIsConfigured&&(t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)}))}}),v}(Backbone,_);!function(){"use strict";var e,t,i,n,v,o,y,w,C,s,r,b,c,S,a,_,l,d,u,h,p,f,m;if(!TAFFY){for(v=1,y=function(e){return TAFFY.isArray(e)||TAFFY.isObject(e)?e:JSON.parse(e)},d=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},l=function(e){var t=T.isArray(e)?[]:T.isObject(e)?{}:null;if(null===e)return e;for(var i in e)t[i]=d(e[i])?e[i].toString():T.isArray(e[i])||T.isObject(e[i])?l(e[i]):e[i];return t},_=function(e){var t=JSON.stringify(e);return null===t.match(/regex/)?t:JSON.stringify(l(e))},w=function(e,t,i){var n,o,s;if(e&&(T.isArray(e)&&1===e.length||!T.isArray(e)))t(T.isArray(e)?e[0]:e,0);else for(o=0,s=(e=T.isArray(e)?e:[e]).length;o<s&&(n=e[o],T.isUndefined(n)&&!i||t(n,o)!==T.EXIT);o++);},C=function(e,t){var i,n=0;for(i in e)if(e.hasOwnProperty(i)&&t(e[i],i,n++)===T.EXIT)break},(o={}).extend=function(e,t){o[e]=function(){return t.apply(this,arguments)}},s=function(e){var t;return!(!T.isString(e)||!/[t][0-9]*[r][0-9]*/i.test(e))||(!!(T.isObject(e)&&e.___id&&e.___s)||!!T.isArray(e)&&(t=!0,w(e,function(e){if(!s(e))return t=!1,TAFFY.EXIT}),t))},b=function(t,e){var i=!0;return w(e,function(e){switch(T.typeOf(e)){case"function":if(!e.apply(t))return i=!1,TAFFY.EXIT;break;case"array":i=1===e.length?b(t,e[0]):2===e.length?b(t,e[0])||b(t,e[1]):3===e.length?b(t,e[0])||b(t,e[1])||b(t,e[2]):4===e.length&&(b(t,e[0])||b(t,e[1])||b(t,e[2])||b(t,e[3])),4<e.length&&w(e,function(e){b(t,e)&&(i=!0)})}}),i},r=function(e){var n=[];return T.isString(e)&&/[t][0-9]*[r][0-9]*/i.test(e)&&(e={___id:e}),T.isArray(e)?(w(e,function(e){n.push(r(e))}),e=function(){var t=this,i=!1;return w(n,function(e){b(t,e)&&(i=!0)}),i}):T.isObject(e)?(T.isObject(e)&&e.___id&&e.___s&&(e={___id:e.___id}),C(e,function(e,r){T.isObject(e)||(e={is:e}),C(e,function(e,o){var s=[];("hasAll"===o?function(e,t){t(e)}:w)(e,function(i){var n=!0,e=function(){var e,t=this[r];return void 0!==t&&(0===o.indexOf("!")&&"!="!==o&&"!=="!==o&&(n=!1,o=o.substring(1,o.length)),e=!((e="regex"===o?i.test(t):"lt"===o||"<"===o?t<i:"gt"===o||">"===o?i<t:"lte"===o||"<="===o?t<=i:"gte"===o||">="===o?i<=t:"left"===o?0===t.indexOf(i):"leftnocase"===o?0===t.toLowerCase().indexOf(i.toLowerCase()):"right"===o?t.substring(t.length-i.length)===i:"rightnocase"===o?t.toLowerCase().substring(t.length-i.length)===i.toLowerCase():"like"===o?0<=t.indexOf(i):"likenocase"===o?0<=t.toLowerCase().indexOf(i.toLowerCase()):"==="===o||"is"===o?t===i:"=="===o?t==i:"!=="===o?t!==i:"!="===o?t!=i:"isnocase"===o?t.toLowerCase?t.toLowerCase()===i.toLowerCase():t===i:"has"===o?T.has(t,i):"hasall"===o?T.hasAll(t,i):"contains"===o?TAFFY.isArray(t)&&-1<t.indexOf(i):-1!==o.indexOf("is")||TAFFY.isNull(t)||TAFFY.isUndefined(t)||TAFFY.isObject(i)||TAFFY.isArray(i)?T[o]&&T.isFunction(T[o])&&0===o.indexOf("is")?T[o](t)===i:!(!T[o]||!T.isFunction(T[o]))&&T[o](t,i):i===t[o])&&!n)&&(!e&&!n||e))};s.push(e)}),1===s.length?n.push(s[0]):n.push(function(){var t=this,i=!1;return w(s,function(e){e.apply(t)&&(i=!0)}),i})})}),e=function(){var t=this,i=!0,i=!(1===n.length&&!n[0].apply(t))&&(!!(2!==n.length||n[0].apply(t)&&n[1].apply(t))&&(!!(3!==n.length||n[0].apply(t)&&n[1].apply(t)&&n[2].apply(t))&&!!(4!==n.length||n[0].apply(t)&&n[1].apply(t)&&n[2].apply(t)&&n[3].apply(t))));return 4<n.length&&w(n,function(e){b(t,e)||(i=!1)}),i}):T.isFunction(e)?e:void 0},S=function(e,t){return e&&e.push?e.sort(function(r,a){var l=0;return T.each(t,function(e){var i,n,t=e.split(" "),o=t[0],s=1===t.length?"logical":t[1];if("logical"===s)i=c(r[o]),n=c(a[o]),T.each(i.length<=n.length?i:n,function(e,t){return i[t]<n[t]?(l=-1,TAFFY.EXIT):i[t]>n[t]?(l=1,TAFFY.EXIT):void 0});else if("logicaldesc"===s)i=c(r[o]),n=c(a[o]),T.each(i.length<=n.length?i:n,function(e,t){return i[t]>n[t]?(l=-1,TAFFY.EXIT):i[t]<n[t]?(l=1,TAFFY.EXIT):void 0});else{if("asec"===s&&r[o]<a[o])return l=-1,T.EXIT;if("asec"===s&&r[o]>a[o])return l=1,T.EXIT;if("desc"===s&&r[o]>a[o])return l=-1,T.EXIT;if("desc"===s&&r[o]<a[o])return l=1,T.EXIT}if(0===l&&"logical"===s&&i.length<n.length?l=-1:0===l&&"logical"===s&&i.length>n.length?l=1:0===l&&"logicaldesc"===s&&i.length>n.length?l=-1:0===l&&"logicaldesc"===s&&i.length<n.length&&(l=1),0!==l)return T.EXIT}),l}):e},f={},m=0,c=function(a){return 1e3<m&&(f={},m=0),f["_"+a]||function(){for(var e,t=String(a),i=[],n="_",o="",s=0,r=t.length;s<r;s++)48<=(e=t.charCodeAt(s))&&e<=57||46===e?"n"!==o&&(o="n",i.push(n.toLowerCase()),n=""):"s"!==o&&(o="s",i.push(parseFloat(n)),n=""),n+=t.charAt(s);return i.push("n"===o?parseFloat(n):n.toLowerCase()),i.shift(),f["_"+a]=i,m++,i}()},a=function(){this.context({results:this.getDBI().query(this.context())})},o.extend("filter",function(){var t=TAFFY.mergeObj(this.context(),{run:null}),i=[];return w(t.q,function(e){i.push(e)}),t.q=i,w(T.args(arguments),function(e){t.q.push(r(e)),t.filterRaw.push(e)}),this.getroot(t)}),o.extend("order",function(e){e=e.split(",");var t,i=[];return w(e,function(e){i.push(e.replace(/^\s*/,"").replace(/\s*$/,""))}),(t=TAFFY.mergeObj(this.context(),{sort:null})).order=i,this.getroot(t)}),o.extend("limit",function(i){var n,e=TAFFY.mergeObj(this.context(),{});return e.limit=i,e.run&&e.sort&&(n=[],w(e.results,function(e,t){return i<t+1?TAFFY.EXIT:void n.push(e)}),e.results=n),this.getroot(e)}),o.extend("start",function(i){var n,e=TAFFY.mergeObj(this.context(),{});return e.start=i,e.run&&e.sort&&!e.limit?(n=[],w(e.results,function(e,t){i<t+1&&n.push(e)}),e.results=n):e=TAFFY.mergeObj(this.context(),{run:null,start:i}),this.getroot(e)}),o.extend("update",function(e,t,i){var n,o=!0,s={},r=T.args(arguments);return!TAFFY.isString(e)||2!==arguments.length&&3!==arguments.length?(s=e,2===r.length&&(o=t)):(s[e]=t,3===arguments.length&&(o=i)),a.call(n=this),w(this.context().results,function(e){var t=s;TAFFY.isFunction(t)?t=t.apply(TAFFY.mergeObj(e,{})):T.isFunction(t)&&(t=t(TAFFY.mergeObj(e,{}))),TAFFY.isObject(t)&&n.getDBI().update(e.___id,t,o)}),this.context().results.length&&this.context({run:null}),this}),o.extend("remove",function(e){var t=this,i=0;return a.call(this),w(this.context().results,function(e){t.getDBI().remove(e.___id),i++}),this.context().results.length&&(this.context({run:null}),t.getDBI().removeCommit(e)),i}),o.extend("count",function(){return a.call(this),this.context().results.length}),o.extend("callback",function(e,t){var i;return e&&(i=this,setTimeout(function(){a.call(i),e.call(i.getroot(i.context()))},t||0)),null}),o.extend("get",function(){return a.call(this),this.context().results}),o.extend("stringify",function(){return JSON.stringify(this.get())}),o.extend("first",function(){return a.call(this),this.context().results[0]||!1}),o.extend("last",function(){return a.call(this),this.context().results[this.context().results.length-1]||!1}),o.extend("sum",function(){var i=0,e=this;return a.call(e),w(T.args(arguments),function(t){w(e.context().results,function(e){i+=e[t]||0})}),i}),o.extend("min",function(t){var i=null;return a.call(this),w(this.context().results,function(e){(null===i||e[t]<i)&&(i=e[t])}),i}),u=function(e,t,i){var n,o,s=2===i.length?(n=e[i[0]],o="===",t[i[1]]):(n=e[i[0]],o=i[1],t[i[2]]);switch(o){case"===":return n===s;case"!==":return n!==s;case"<":return n<s;case">":return s<n;case"<=":return n<=s;case">=":return s<=n;case"==":return n==s;case"!=":return n!=s;default:throw String(o)+" is not supported"}},h=function(e,t){var i,n={};for(i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);for(i in t)t.hasOwnProperty(i)&&"___id"!==i&&"___s"!==i&&(n[(TAFFY.isUndefined(n[i])?"":"right_")+String(i)]=t[i]);return n},p=function(e){var t,o,s=T.args(arguments),r=s.length,a=[];if("function"!=typeof e.filter){if(!e.TAFFY)throw"TAFFY DB or result not supplied";t=e()}else t=e;return this.context({results:this.getDBI().query(this.context())}),TAFFY.each(this.context().results,function(n){t.each(function(e){var t,i=!0;for(o=1;o<r&&(i="function"==typeof(t=s[o])?t(n,e):!("object"!=typeof t||!t.length)&&u(n,e,t));o++);i&&a.push(h(n,e))})}),TAFFY(a)()},o.extend("join",p),o.extend("max",function(t){var i=null;return a.call(this),w(this.context().results,function(e){(null===i||e[t]>i)&&(i=e[t])}),i}),o.extend("select",function(){var n=[],o=T.args(arguments);return a.call(this),w(this.context().results,1===arguments.length?function(e){n.push(e[o[0]])}:function(t){var i=[];w(o,function(e){i.push(t[e])}),n.push(i)}),n}),o.extend("distinct",function(){var n=[],s=T.args(arguments);return a.call(this),w(this.context().results,1===arguments.length?function(e){var t=e[s[0]],i=!1;w(n,function(e){if(t===e)return i=!0,TAFFY.EXIT}),i||n.push(t)}:function(t){var o=[],e=!1;w(s,function(e){o.push(t[e])}),w(n,function(i){var n=!0;if(w(s,function(e,t){if(o[t]!==i[t])return n=!1,TAFFY.EXIT}),n)return e=!0,TAFFY.EXIT}),e||n.push(o)}),n}),o.extend("supplant",function(e,t){var i=[];return a.call(this),w(this.context().results,function(n){i.push(e.replace(/\{([^\{\}]*)\}/g,function(e,t){var i=n[t];return"string"==typeof i||"number"==typeof i?i:e}))}),t?i:i.join("")}),o.extend("each",function(e){return a.call(this),w(this.context().results,e),this}),o.extend("map",function(t){var i=[];return a.call(this),w(this.context().results,function(e){i.push(t(e))}),i}),(TAFFY=T=function(e){var l=[],c={},a=1,d={template:!1,onInsert:!1,onUpdate:!1,onRemove:!1,onDBChange:!1,storageName:!1,forcePropertyCase:null,cacheSize:100,name:""},t=new Date,u=0,h=0,p={},f=function(e){var t=[],i=!1;return 0===e.length?l:(w(e,function(e){T.isString(e)&&/[t][0-9]*[r][0-9]*/i.test(e)&&l[c[e]]&&(t.push(l[c[e]]),i=!0),T.isObject(e)&&e.___id&&e.___s&&l[c[e.___id]]&&(t.push(l[c[e.___id]]),i=!0),T.isArray(e)&&w(e,function(e){w(f(e),function(e){t.push(e)})})}),i&&1<t.length&&(t=[]),t)},m={dm:function(e){return e&&(t=e,p={},h=u=0),d.onDBChange&&setTimeout(function(){d.onDBChange.call(l)},0),d.storageName&&setTimeout(function(){localStorage.setItem("taffy_"+d.storageName,JSON.stringify(l))}),t},insert:function(e,t){var s=[],r=[],i=y(e);return w(i,function(i,e){var n,o;return T.isArray(i)&&0===e?(w(i,function(e){s.push("lower"===d.forcePropertyCase?e.toLowerCase():"upper"===d.forcePropertyCase?e.toUpperCase():e)}),!0):(T.isArray(i)?(n={},w(i,function(e,t){n[s[t]]=e}),i=n):T.isObject(i)&&d.forcePropertyCase&&(o={},C(i,function(e,t){o["lower"===d.forcePropertyCase?t.toLowerCase():"upper"===d.forcePropertyCase?t.toUpperCase():t]=i[t]}),i=o),a++,i.___id="T"+String("000000"+v).slice(-6)+"R"+String("000000"+a).slice(-6),i.___s=!0,r.push(i.___id),d.template&&(i=T.mergeObj(d.template,i)),l.push(i),c[i.___id]=l.length-1,d.onInsert&&(t||TAFFY.isUndefined(t))&&d.onInsert.call(i),void m.dm(new Date))}),g(r)},sort:function(e){return l=S(l,e.split(",")),c={},w(l,function(e,t){c[e.___id]=t}),m.dm(new Date),!0},update:function(e,t,i){var n,o,s,r,a={};d.forcePropertyCase&&(C(t,function(e,t){a["lower"===d.forcePropertyCase?t.toLowerCase():"upper"===d.forcePropertyCase?t.toUpperCase():t]=e}),t=a),n=l[c[e]],o=T.mergeObj(n,t),r=!(s={}),C(o,function(e,t){!TAFFY.isUndefined(n[t])&&n[t]===e||(s[t]=e,r=!0)}),r&&(d.onUpdate&&(i||TAFFY.isUndefined(i))&&d.onUpdate.call(o,l[c[e]],s),l[c[e]]=o,m.dm(new Date))},remove:function(e){l[c[e]].___s=!1},removeCommit:function(e){for(var t=l.length-1;-1<t;t--)l[t].___s||(d.onRemove&&(e||TAFFY.isUndefined(e))&&d.onRemove.call(l[t]),c[l[t].___id]=void 0,l.splice(t,1));c={},w(l,function(e,t){c[e.___id]=t}),m.dm(new Date)},query:function(i){var e,t,n,o,s,r;if(d.cacheSize&&(t="",w(i.filterRaw,function(e){if(T.isFunction(e))return t="nocache",TAFFY.EXIT}),""===t&&(t=_(T.mergeObj(i,{q:!1,run:!1,sort:!1})))),!i.results||!i.run||i.run&&m.dm()>i.run){if(n=[],d.cacheSize&&p[t])return p[t].i=u++,p[t].results;e=(0===i.q.length&&0===i.index.length?w(l,function(e){n.push(e)}):(o=f(i.index),w(o,function(e){0!==i.q.length&&!b(e,i.q)||n.push(e)})),n)}else e=i.results;return!(0<i.order.length)||i.run&&i.sort||(e=S(e,i.order)),e.length&&(i.limit&&i.limit<e.length||i.start)&&(s=[],w(e,function(e,t){if(!i.start||i.start&&t+1>=i.start)if(i.limit){if((r=i.start?t+1-i.start:t)<i.limit)s.push(e);else if(r>i.limit)return TAFFY.EXIT}else s.push(e)}),e=s),d.cacheSize&&"nocache"!==t&&(h++,setTimeout(function(){var i,n;h>=2*d.cacheSize&&(h=0,i=u-d.cacheSize,n={},C(function(e,t){e.i>=i&&(n[t]=e)}),p=n)},0),p[t]={i:u++,results:e}),e}},g=function(){var e=TAFFY.mergeObj(TAFFY.mergeObj(o,{insert:void 0}),{getDBI:function(){return m},getroot:function(e){return g.call(e)},context:function(e){return e&&(t=TAFFY.mergeObj(t,e.hasOwnProperty("results")?TAFFY.mergeObj(e,{run:new Date,sort:new Date}):e)),t},extend:void 0}),t=this&&this.q?this:{limit:!1,start:!1,q:[],filterRaw:[],index:[],order:[],results:!1,run:null,sort:null,settings:d};return w(T.args(arguments),function(e){s(e)?t.index.push(e):t.q.push(r(e)),t.filterRaw.push(e)}),e};return v++,e&&m.insert(e),g.insert=m.insert,g.merge=function(e,i,n){var o={},s=[],t={};return n=n||!1,i=i||"id",w(e,function(e){var t;o[i]=e[i],s.push(e[i]),(t=g(o).first())?m.update(t.___id,e,n):m.insert(e,n)}),t[i]=s,g(t)},g.TAFFY=!0,g.sort=m.sort,g.settings=function(e){return e&&(d=TAFFY.mergeObj(d,e),e.template&&g().update(e.template)),d},g.store=function(e){var t;return localStorage&&(e&&((t=localStorage.getItem("taffy_"+e))&&0<t.length&&(g.insert(t),0),0<l.length&&setTimeout(function(){localStorage.setItem("taffy_"+d.storageName,JSON.stringify(l))})),g.settings({storageName:e})),g},g}).each=w,T.eachin=C,T.extend=o.extend,TAFFY.EXIT="TAFFYEXIT",TAFFY.mergeObj=function(i,n){var o={};return C(i,function(e,t){o[t]=i[t]}),C(n,function(e,t){o[t]=n[t]}),o},TAFFY.has=function(n,o){var e,s=!1;if(n.TAFFY)return 0<(s=n(o)).length;switch(T.typeOf(n)){case"object":if(T.isObject(o))C(o,function(e,t){return!0!==s||T.isUndefined(n[t])||!n.hasOwnProperty(t)?(s=!1,TAFFY.EXIT):void(s=T.has(n[t],o[t]))});else if(T.isArray(o))w(o,function(e,t){if(s=T.has(n,o[t]))return TAFFY.EXIT});else if(T.isString(o))return!TAFFY.isUndefined(n[o]);return s;case"array":if(T.isObject(o))w(n,function(e,t){if(!0===(s=T.has(n[t],o)))return TAFFY.EXIT});else if(T.isArray(o))w(o,function(e,i){if(w(n,function(e,t){if(!0===(s=T.has(n[t],o[i])))return TAFFY.EXIT}),!0===s)return TAFFY.EXIT});else if(T.isString(o)||T.isNumber(o))for(s=!1,e=0;e<n.length;e++)if(s=T.has(n[e],o))return!0;return s;case"string":if(T.isString(o)&&o===n)return!0;break;default:if(T.typeOf(n)===T.typeOf(o)&&n===o)return!0}return!1},TAFFY.hasAll=function(t,e){var i,n=TAFFY;return n.isArray(e)?(i=!0,w(e,function(e){if(!1===(i=n.has(t,e)))return TAFFY.EXIT}),i):n.has(t,e)},TAFFY.typeOf=function(e){var t=typeof e;return"object"===t&&(e?"number"!=typeof e.length||e.propertyIsEnumerable("length")||(t="array"):t="null"),t},TAFFY.getObjectKeys=function(e){var i=[];return C(e,function(e,t){i.push(t)}),i.sort(),i},TAFFY.isSameArray=function(e,t){return!(!TAFFY.isArray(e)||!TAFFY.isArray(t)||e.join(",")!==t.join(","))},TAFFY.isSameObject=function(i,n){var o=TAFFY,s=!0;return o.isObject(i)&&o.isObject(n)&&o.isSameArray(o.getObjectKeys(i),o.getObjectKeys(n))?C(i,function(e,t){if(!(o.isObject(i[t])&&o.isObject(n[t])&&o.isSameObject(i[t],n[t])||o.isArray(i[t])&&o.isArray(n[t])&&o.isSameArray(i[t],n[t])||i[t]===n[t]))return s=!1,TAFFY.EXIT}):s=!1,s},e=["String","Number","Object","Array","Boolean","Null","Function","Undefined"],t=function(t){return function(e){return TAFFY.typeOf(e)===t.toLowerCase()}},i=0;i<e.length;i++)TAFFY["is"+(n=e[i])]=t(n);TAFFY.args=function(t){return Object.keys&&Array.prototype.map?Object.keys(t).map(function(e){return t[e]}):t}}}(),"object"==typeof exports&&(exports.taffy=TAFFY),Handlebars.registerHelper("when",function(e,t){return new RegExp(t.hash.match).test(e)?t.fn(this):t.inverse(this)}),Handlebars.registerHelper("currency",function(e){return parseFloat(e).toFixed(2).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")}),Backbone.Marionette.TemplateCache.prototype.compileTemplate=function(e){return Handlebars.compile(e)},Backbone.Marionette.CompositeView.prototype.mixinTemplateHelpers=function(e){var i=this,t=Marionette.getOption(i,"templateHelpers"),n={};return e=e||{},_.isFunction(t)&&(t=t.call(i)),_.each(t,function(e,t){_.isFunction(e)?n[t]=e.call(i):n[t]=e}),_.extend(e,n)},Store=function(e){"use strict";var t=new Marionette.Application;return t.addInitializer(function(e){t.config=$.extend(!0,{configurator:{collapseOnScollLimit:50}},e.config),t.config.debug&&t.vent.on("all",function(e){console.info("[[APP.VENT]]: ",e,arguments)}),t.db={added:{},available:{}},t.globals={productCode:null,cartId:null,promoId:null,maxQuantity:t.config.maxQuantity||9}}),t.on("initialize:after",function(){e.history&&e.history.start()}),t.vent.on("configurator:closed promotion:closed condiments:closed",function(){t.globals=$.extend({},t.globals,{productCode:null,cartId:null,promoId:null})}),t}(Backbone,WOS),Store.module("AlertApp",function(e,t,i,n,o,s,r){"use strict";var a=function(){e.Controller.showAlert()},l=function(){e.Controller.hideAlert()};e.addInitializer(function(){t.vent.on("app:alert:start",a),t.vent.on("app:alert:end",l)})},WOS),Store.module("AlertApp",function(e,t,i,n,o,s,r){"use strict";e.Controller={showAlert:function(){this._getView().showView()},hideAlert:function(){this._getView().hideView()},_getView:function(){return this.AlertView||(this.AlertView=new e.ItemView({})),this.AlertView}}},WOS),Store.module("AlertApp",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.Layout.extend({el:"#alertExperiencingDifficulties",showView:function(){this.$el.modal("show")},hideView:function(){this.$el.modal("hide")}})},WOS),Store.module("CondimentsApp.AddedCondiments",function(n,e,t,i,o,s,r){"use strict";var a=function(e,t,i){n.Controller.update(e,t,i)};n.addInitializer(function(){e.vent.on("addedcondiments:quantitychange",a)})},WOS),Store.module("CondimentsApp.AddedCondiments",function(e,n,t,i,o,s,r){"use strict";e.Controller={update:function(e,t,i){n.commands.execute("addedcondiments:entity:update",e,t,i)}}},WOS),Store.module("CondimentsApp.AvailableCondiments",function(t,e,i,n,o,s,r){"use strict";var a=function(e){t.Controller.list(e)};t.addInitializer(function(){e.vent.on("condiments:loaded",a)})},WOS),Store.module("CondimentsApp.AvailableCondiments",function(i,o,e,t,s,r,n){"use strict";i.Controller={list:function(n){var e=r.bind(function(e,t){var i=this._getView(e,t);i.on("addedcondiments:quantitychange",function(e,t,i,n){o.vent.trigger("addedcondiments:quantitychange",t,i,n)}),n.availableItemsRegion.show(i)},this);s.when(o.request("addedcondiments:entity:findAll"),o.request("availablecondiments:entity:findAll")).then(e)},_getView:function(e,t){return new i.ListView({collection:t,addedCondimentsCollection:e})}}},WOS),Store.module("CondimentsApp.AvailableCondiments",function(e,i,t,n,o,s,r){"use strict";e.ItemView=n.ItemView.extend({tagName:"tr",template:"#productset-template",templateHelpers:function(){return{maxQuantity:i.globals.maxQuantity,maxLength:i.globals.maxQuantity.toString().length}},events:{"click .action-decrease":"changeQuantity","click .action-increase":"changeQuantity","change .form-control":"changeQuantity"},ui:{quantityinput:".form-control"},onShow:function(){r.Components.QuantityInput.init(this.$el,{pattern:this.quantityInputPattern}),this.updateQuantity(null,this.options.addedCondimentsCollection)},initialize:function(e){if(this.listenTo(this.options.addedCondimentsCollection,"add remove",this.updateQuantity),this.quantityInputPattern="9",1<i.globals.maxQuantity.toString().length){this.quantityInputPattern+="?";for(var t=1;t<i.globals.maxQuantity.toString().length;t++)this.quantityInputPattern+="9"}},changeQuantity:function(){var e=this.ui.quantityinput,t=parseInt(e.data("oldvalue"),10),i=parseInt(e.data("newvalue"),10),n=i-t,o=i;this.$el.toggleClass("selected",!!o),this.trigger("quantitychange",this.model,n,o)},updateQuantity:function(e,t){var i=t.where({productCode:this.model.get("productCode")}).length;this.ui.quantityinput.val(i),this.ui.quantityinput.data("newvalue",i),this.ui.quantityinput.data("oldvalue",i),this.$el.toggleClass("selected",!!i)}}),e.ListView=n.CompositeView.extend({template:"#productsets-template",itemView:e.ItemView,itemViewEventPrefix:"addedcondiments",itemViewContainer:"tbody",itemViewOptions:function(e,t){return{addedCondimentsCollection:this.options.addedCondimentsCollection}}})},WOS),Store.module("CondimentsApp",function(e,t,i,n,o,s,r){"use strict";var a=n.AppRouter.extend({appRoutes:{"choose-condiments":"chooseCondiments"}}),l={chooseCondiments:function(){e.Controller.chooseCondiments()}};e.addInitializer(function(){t.addInitializer(function(){new a({controller:l}),t.addRegions({menuRegion:"#food-menu",productCardsRegion:"#product-cards",configuratorRegion:"#product-configurator",orderWidgetRegion:"#order-widget",choicesModalsRegion:"#modals-choices"}),t.commands.execute("availablecondiments:entity:reset"),t.commands.execute("addedcondiments:entity:reset")}),t.vent.on("condiments:closed",function(){o(window).trigger("resize"),t.commands.execute("addedcondiments:entity:reset"),t.commands.execute("availablecondiments:entity:reset")}),t.vent.trigger("app:started","condiments")})},WOS),Store.module("CondimentsApp",function(n,o,i,e,s,r,t){"use strict";n.Controller={chooseCondiments:function(){var e=r.bind(this._showView,this);o.vent.trigger("app:loading:start"),s.when(o.request("addedcondiments:entity:findAll"),o.request("availablecondiments:entity:findAll")).then(e).always(function(){o.vent.trigger("app:loading:end")})},cancelOrder:function(e){o.vent.trigger("condiments:cancelorder",e),this._hideView()},saveOrder:function(e){var t=r.bind(function(){i.history.navigate(""),o.vent.trigger("condiments:saveorder",e),location.reload()},this);o.vent.trigger("app:loading:start"),s.when(o.request("addedcondiments:save")).then(t)},_showView:function(e,t){var i;t.length&&((i=new n.View({addedCondimentsCollection:e,isNewOrder:!e.length})).on("condiments:loaded",function(e){o.vent.trigger("condiments:loaded",e)}),i.on("condiments:cancelorder",r.bind(n.Controller.cancelOrder,this)),i.on("condiments:saveorder",r.bind(n.Controller.saveOrder,this)),o.configuratorRegion.show(i))},_hideView:function(){o.configuratorRegion.close(),i.history.navigate(""),o.vent.trigger("condiments:closed")}}},WOS),Store.module("CondimentsApp",function(e,t,i,n,o,s,r){"use strict";e.View=n.Layout.extend({template:"#condiments-configurator-template",templateHelpers:function(){return{isNewOrder:this.options.isNewOrder}},regions:{availableItemsRegion:"#available-sets"},ui:{header:".configurator-header",body:".configurator-body",footer:".configurator-footer",quantity:".added-quantity",btnSave:".action-saveorder"},triggers:{"click .action-cancel":"condiments:cancelorder","click .action-saveorder":"condiments:saveorder"},initialize:function(e){this.listenTo(this.options.addedCondimentsCollection,"add remove reset",this.updateQuantity),this.listenTo(this.options.addedCondimentsCollection,"add remove reset",this.toggleSaveButton)},onShow:function(){o("body").addClass("show-configurator show-condiments-configurator"),o(window).on("scroll.configurator",s.bind(this.onScroll,this)),document.body.scrollTop=document.documentElement.scrollTop=0,this.updateQuantity(),this.toggleSaveButton(),this.trigger("condiments:loaded",this)},onClose:function(){o("body").removeClass("show-configurator show-condiments-configurator"),o(window).off("scroll.configurator")},onScroll:r.Poll(function(){var e=o(window).scrollTop();this.ui.header[e<t.config.configurator.collapseOnScollLimit?"removeClass":"addClass"]("collapsed"),this.ui.body[e<t.config.configurator.collapseOnScollLimit?"removeClass":"addClass"]("expanded")},25),updateQuantity:function(){this.ui.quantity.text(this.options.addedCondimentsCollection.length)},toggleSaveButton:function(){this.ui.btnSave[this.options.addedCondimentsCollection.length?"removeClass":"addClass"]("disabled"),this.ui.btnSave.prop("disabled",!this.options.addedCondimentsCollection.length)}})},WOS),Store.module("ConfiguratorApp.AddedMeals",function(n,e,t,i,o,s,r){"use strict";var a=function(e){n.Controller.list(e)},l=function(e,t,i){n.Controller.update(e,t,i)};n.addInitializer(function(){e.vent.on("configurator:loaded",a),e.vent.on("addedmeals:quantitychange",l)})},WOS),Store.module("ConfiguratorApp.AddedMeals",function(t,n,e,i,o,s,r){"use strict";t.Controller={list:function(i){var e=s.bind(function(e){var t=this._getView(e);t.on("addedmeals:meal:removed",function(e,t){n.vent.trigger("addedmeals:meal:removed",e,t)}),t.on("addedmeals:view:loaded",function(e){n.vent.trigger("addedmeals:view:loaded",e)}),t.on("addedmeals:view:customization:view:selectionchanged",function(e){n.vent.trigger("addedmeals:view:customization:view:selectionchanged",e),i.toggleSaveButton()}),t.on("addedmeals:view:customization:view:closed",function(e){i.toggleSaveButton()}),t.on("addedmeals:view:customization:view:loaded",function(e){n.vent.trigger("addedmeals:view:customization:view:loaded",e)}),i.addedItemsRegion.show(t)},this);o.when(n.request("addedmeals:entity:findAll")).then(e)},update:function(e,t,i){n.commands.execute("addedmeals:entity:update",e,t,i)},_getView:function(e){return new t.ListView({collection:e})}}},WOS),Store.module("ConfiguratorApp.AddedMeals",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.Layout.extend({className:"selected-meal-item",template:"#addedset-template",regions:{componentsRegion:".components-column",choicesRegion:".choices-column",customizeRegion:".meal-customization",customizeDetailsRegion:".customization-details"},ui:{toggleCustomization:".action-customize",header:".header-info-column"},initialize:function(){this.customising=!1},events:{"click .action-delete":"destroy","click .action-customize":"toggleCustomization"},onShow:function(){this.trigger("loaded"),r.Components.Popovers.init(this.ui.header)},destroy:function(e){e.preventDefault(),this.model.destroy()},toggleCustomization:function(e){this[this.customizing?"hideCustomization":"showCustomization"](),this.customizing=!this.customizing},toggleCustomizeButton:function(e){this.ui.toggleCustomization.prop("disabled",!e),this.ui.toggleCustomization[e?"removeClass":"addClass"]("disabled")},toggleCustomizationDetails:function(e){this.$el.removeClass("did-customize did-not-customize"),this.$el.addClass(e.included.length||e.addons.length?"did-customize":"did-not-customize")},showCustomization:function(){this.$el.addClass("selected-meal-expanded"),this.ui.toggleCustomization.find("span").text(this.ui.toggleCustomization.data("expanded-text"))},hideCustomization:function(){this.$el.removeClass("selected-meal-expanded"),this.ui.toggleCustomization.find("span").text(this.ui.toggleCustomization.data("collapsed-text"))}}),e.EmptyView=n.ItemView.extend({template:"#addedsetempty-template"}),e.ListView=n.CollectionView.extend({itemView:e.ItemView,emptyView:e.EmptyView,itemViewEventPrefix:"addedmeals:view",collectionEvents:{remove:"mealRemoved"},mealRemoved:function(e,t){this.trigger("addedmeals:meal:removed",e,t)}})},WOS),Store.module("ConfiguratorApp.AvailableChoices",function(i,e,t,n,o,s,r){"use strict";var a=function(e,t){i.Controller.list(e,t)};i.addInitializer(function(){e.vent.on("addedmeals:choice:changing",function(e,t){a(e,t)})})},WOS),Store.module("ConfiguratorApp.AvailableChoices",function(o,r,e,t,i,n,s){"use strict";o.Controller={list:function(e,s){var t=n.bind(function(e,t,i){var n=this._getLayoutView(),o=this._getRadioListView(t,e,s.model,i);o.on("availablechoices:view:hidden",function(){n.close(),o.close()}),o.on("availablechoices:choices:save",function(e,t,i){r.commands.execute("addedchoices:entity:update",e,t,i),s.view.trigger("changed"),n.close()}),n.on("availablechoices:modal:view:hidden",n.close),r.choicesModalsRegion.show(n),n.modalRegion.show(o)},this);r.vent.trigger("app:loading:start"),i.when(r.request("availablechoices:entity:findAll",s.model)).then(t).always(function(){r.vent.trigger("app:loading:end")})},_getLayoutView:function(){return new o.View},_getRadioListView:function(e,t,i,n){return new o.RadioListView({collection:t,model:i,displayOptions:e,categories:n})}}},WOS),Store.module("ConfiguratorApp.AvailableChoices",function(e,t,i,n,u,h,o){"use strict";e.View=n.Layout.extend({template:"#modal-container-template",regions:{modalRegion:"#modal-content"},className:"modal fade",initialize:function(){this.$el.on("hidden.bs.modal",h.bind(function(){this.trigger("availablechoices:modal:view:hidden")},this))},onShow:function(){this.$el.modal("show")},onClose:function(){this.$el.modal("hide")}}),e.RadioItemView=n.ItemView.extend({template:"#available-choice-template",triggers:{"ifChecked :radio":"selected"},ui:{radio:"input:radio",radioGroup:".radio"},onRender:function(){o.Forms.InputStates.init(this.ui.radioGroup)},onShow:function(){this.model.get("productCode")==this.options.productCode&&this.ui.radio.iCheck("check")}}),e.RadioListView=n.CompositeView.extend({template:"#available-choices-template",templateHelpers:function(){return{columnsToDisplay:this.getColumnsToDisplay(this.collection),categories:this.options.categories}},className:"modal-available-choices",itemView:e.RadioItemView,itemViewOptions:function(){return{productCode:this.model.get("selectedSolutionCode")}},itemViewContainer:".available-choices-list",itemViewEventPrefix:"availablechoice",itemEvents:{selected:"onChoiceSelected"},events:{"click .btn-submit":"onSave","click .category-tabs a":"filterProduct"},ui:{radioGroups:".radio",choiceImage:".choice-image",dialog:".modal-dialog",choicesContainer:".available-choices-list",tabs:".category-tabs a"},_selectedCategory:null,initialize:function(){this._selectedCategory="all",this.$el.on("hidden.bs.modal",h.bind(function(){this.trigger("availablechoices:view:hidden")},this))},onShow:function(){},onRender:function(){var t=this._selectedCategory;h.each(this.ui.tabs,function(e){t==u(e).data("categoryid").toString()&&u(e).addClass("active")})},onChoiceSelected:function(e,t,i){this.selectedChoice=i.model,this.ui.choiceImage.attr("src",i.model.get("images")[0].imageUrl)},filterProduct:function(e){e.preventDefault();var t=u(e.target).data("categoryid");this._selectedCategory=t.toString();this.collection.each(h.bind(function(e){"all"===this._selectedCategory||-1<e.attributes.choiceCategoriesID.indexOf(this._selectedCategory)?e.attributes.isHidden=!1:e.attributes.isHidden=!0},this));this.render()},onSave:function(e){var t,i;e.preventDefault(),this.selectedChoice&&(i={mealid:(t=u.extend(!0,{},this.model.toJSON())).mealid,productCode:t.productCode,selectedSolutionCode:this.selectedChoice.get("productCode"),selectedSolutionCartName:this.selectedChoice.get("cartName"),selectedSolutionPath:this.selectedChoice.get("solutionPath"),selectedSolutionHierarchyPath:this.selectedChoice.get("solutionHierarchyPath"),selectedQuantity:1,additionInfo:this.selectedChoice.get("additionInfo"),included:this.selectedChoice.get("included"),maxAddOn:this.selectedChoice.get("maxAddOn"),addons:this.selectedChoice.get("addons"),choices:this.selectedChoice.get("choices"),components:this.selectedChoice.get("components")},this.trigger("availablechoices:choices:save",[i],t,!1)),this.$el.modal("hideModal"),this.trigger("availablechoices:view:hidden")},getColumnsToDisplay:function(e){var t=Math.ceil(e.length/8);return 3<t?3:t},appendHtml:function(e,t,i){for(var n=this.collection.map(h.bind(function(e){return"all"===this._selectedCategory||-1<e.attributes.choiceCategoriesID.indexOf(this._selectedCategory)?e.attributes.productCode:null},this)).filter(function(e){return null!==e}),o=this.getItemViewContainer(e),s=this.getColumnsToDisplay(n),r="col-xs-"+(12/s).toString(),a=Math.ceil(n.length/s),l=0;l<s;l++){var c=o.find(".column-"+l);0==c.length&&(c=u('<div class="choices-column '+r+" column-"+l+'"></div>'),o.append(c))}var d=-1<n.indexOf(t.model.attributes.productCode)?Math.floor(n.indexOf(t.model.attributes.productCode)/a):0;o.find(".choices-column").eq(d).append(t.el)}})},WOS),Store.module("ConfiguratorApp.AddedMeals.Choices",function(t,e,i,n,o,s,r){"use strict";var a=function(e){t.Controller.list(e)};t.addInitializer(function(){e.vent.on("addedmeals:view:loaded addedmeals:choice:changed",function(e){setTimeout(function(){a(e)},300)})})},WOS),Store.module("ConfiguratorApp.AddedMeals.Choices",function(t,n,e,i,o,s,r){"use strict";t.Controller={list:function(i){var e=s.bind(function(e){var t=this._getView(e);t.on("addedmeals:choice:changing",function(e,t){n.vent.trigger("addedmeals:choice:changing",e,t)}),t.on("addedmeals:choice:changed",function(e,t){n.vent.trigger("addedmeals:choice:changed",i,e,t)}),i.choicesRegion.show(t)},this);o.when(n.request("addedchoices:entity:findAllByMeal",i.model)).then(e)},_getView:function(e){return new t.ListView({collection:e})}}},WOS),Store.module("ConfiguratorApp.AddedMeals.Choices",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.Layout.extend({template:"#addedset-choice-template",ui:{changeLink:".action-change"},regions:{availableChoices:".modal-available-choices"},triggers:{"click .action-change":"changing"},modelEvents:{change:"render onChanged"},onChanged:function(){this.trigger("changed")}}),e.ListView=n.CollectionView.extend({itemView:e.ItemView,className:"fooditem",itemViewEventPrefix:"addedmeals:choice"})},WOS),Store.module("ConfiguratorApp.AddedMeals.Components",function(t,e,i,n,o,s,r){"use strict";var a=function(e){t.Controller.list(e)};t.addInitializer(function(){e.vent.on("addedmeals:view:loaded addedmeals:choice:changed",function(e){setTimeout(function(){a(e)},50)})})},WOS),Store.module("ConfiguratorApp.AddedMeals.Components",function(t,n,e,i,o,s,r){"use strict";t.Controller={list:function(i){var e;i.model.get("components").length&&(e=s.bind(function(e){var t=this._getView(e);i.componentsRegion.show(t)},this),o.when(n.request("addedcomponents:entity:findAllByMeal",i.model)).then(e))},_getView:function(e){return new t.ListView({collection:e})}}},WOS),Store.module("ConfiguratorApp.AddedMeals.Components",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.ItemView.extend({template:"#addedset-component-template",className:"fooditem"}),e.ListView=n.CollectionView.extend({itemView:e.ItemView})},WOS),Store.module("ConfiguratorApp.AddedMeals.Customization",function(t,e,i,n,o,s,r){"use strict";var a=function(e){t.Controller.list(e)};t.addInitializer(function(){e.config.enableGrilling&&e.vent.on("addedmeals:view:loaded addedmeals:choice:changed",function(e){setTimeout(function(){a(e)},50)})})},WOS),Store.module("ConfiguratorApp.AddedMeals.Customization",function(t,n,e,i,o,s,r){"use strict";t.Controller={list:function(i){var e=s.bind(function(e){i.toggleCustomizeButton(!!e.length);var t=this._getView(e);t.on("addedmeals:customization:view:loaded",function(e){n.vent.trigger("addedmeals:customization:view:loaded",e),i.trigger("customization:view:loaded")}),t.on("addedmeals:customization:view:selectionchanged",function(e){i.trigger("customization:view:selectionchanged")}),t.on("addedmeals:customization:view:closed",function(e){-1<n.globals.errorMaxAddOn.indexOf(e.cid)&&n.globals.errorMaxAddOn.splice(n.globals.errorMaxAddOn.indexOf(e.cid),1),i.trigger("customization:view:closed")}),i.customizeRegion.show(t)},this);o.when(n.request("customizableitems:entity:findAllByMeal",i.model)).then(e)},_getView:function(e){return new t.ListView({collection:e})}}},WOS),Store.module("ConfiguratorApp.AddedMeals.Customization",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.Layout.extend({className:"customize-item",template:"#customize-item-template",regions:{includedRegion:".customization-options-included",addonsRegion:".customization-options-addons"},ui:{toggle:".item-toggle",body:".customize-item-body",message:".message-container"},onShow:function(){this.trigger("loaded")},onClose:function(){this.trigger("closed")},expand:function(){this.toggle(!0)},collapse:function(){this.toggle(!1)},toggle:function(e){this.ui.toggle[e?"removeClass":"addClass"]("collapsed"),this.ui.body[e?"addClass":"removeClass"]("in")}}),e.EmptyView=n.ItemView.extend({template:"#customize-items-empty-template"}),e.ListView=n.CompositeView.extend({itemView:e.ItemView,emptyView:e.EmptyView,template:"#customize-items-template",itemViewContainer:".customize-items",itemViewEventPrefix:"addedmeals:customization:view",onShow:function(){this.collection.length&&this.children.first().expand()}})},WOS),Store.module("ConfiguratorApp.AddedMeals.Customization.Options",function(t,e,i,n,o,s,r){"use strict";var a=function(e){t.Controller.list(e)};t.addInitializer(function(){e.vent.on("addedmeals:customization:view:loaded",function(e){setTimeout(function(){a(e)},50)})})},WOS),Store.module("ConfiguratorApp.AddedMeals.Customization.Options",function(t,a,e,i,n,l,o){"use strict";t.Controller={list:function(r){var e=l.bind(function(e,o){var t=this._getView(e),s=this._getView(o);t.on("addedmeals:customization:options:view:selectionchanged",function(e){r.trigger("selectionchanged")}),s.on("addedmeals:customization:options:view:selectionchanged",function(e){var t,i,n;0!=r.model.attributes.maxAddOn&&(t=r.model.attributes.maxAddOn,i=0,l.each(o.models,function(e){var t;!e.attributes.countable||0<(t=parseInt(e.attributes.selected)-parseInt(e.attributes.defaultOption))&&(i+=t)}),e.model.attributes.countable&&(s.hideAllErrors(),t<i?(s.highlightError(),-1==a.globals.errorMaxAddOn.indexOf(r.cid)&&a.globals.errorMaxAddOn.push(r.cid),a.globals.errorView=e,n=r.ui.message.data("maxaddonErr1"),e.showErrorMessage(n)):-1<a.globals.errorMaxAddOn.indexOf(r.cid)&&a.globals.errorMaxAddOn.splice(a.globals.errorMaxAddOn.indexOf(r.cid),1))),r.trigger("selectionchanged")}),r.includedRegion.show(t),r.addonsRegion.show(s)},this);n.when(a.request("customizableitemoptions:entity:findAllByMealItem",r.model)).then(e)},_getView:function(e){return new t.ListView({collection:e})}}},WOS),Store.module("ConfiguratorApp.AddedMeals.Customization.Options",function(e,t,i,n,s,o,r){"use strict";e.ItemView=n.ItemView.extend({className:"customize-item-option",template:"#customize-item-option-template",ui:{select:"select",formGroup:".form-group",controlField:".control-field"},events:{"change @ui.select":"onSelectionChanged","selectmenuopen @ui.select":"onSelectMenuOpened"},onShow:function(){this.ui.select.val(this.model.get("selected")),this.renderSelect(),this.selectmenu.list.css("width",165),void 0!==t.globals.errorView&&this.model.attributes.name===t.globals.errorView.model.attributes.name&&s('select[name="'+this.model.attributes.name+'"]').trigger("change")},onClose:function(){this.destroySelect()},showErrorMessage:function(e){var t=this;setTimeout(function(){t.ui.formGroup.addClass("form-group-error"),t.ui.controlField.parents(".customization-group-addons").find("p.text-center").append('<div class="customize-item-error">'+e+"</div>")},5)},hideError:function(e,t){this.ui.formGroup.removeClass("form-group-error"),this.ui.controlField.parents(".customization-group-addons").find(".customize-item-error").remove()},highlightError:function(){var e=this;this.model.attributes.defaultOption!==this.model.attributes.selected&&this.model.attributes.countable&&setTimeout(function(){e.ui.formGroup.addClass("form-group-error")},5)},onSelectionChanged:function(e){var t=this.model.attributes.selected;this.model.save({selected:this.ui.select.val(),previous:t}),this.trigger("selectionchanged")},onSelectMenuOpened:function(e){this.ui.select.show();var t=this.ui.select.width();this.selectmenu.list.css("width",t),this.ui.select.hide(),s(window).one("scroll",o.bind(function(){this.ui.select.selectmenu("close")},this))},renderSelect:function(){this.ui.select.selectmenu({format:function(e,t){var i=s.trim(e),n=[{find:/^([^\-]+) \- /g,replace:'<div class="media"><div class="media-left">$1</div>'},{find:/([^\|><]+) \| /g,replace:'<div class="media-body">$1</div>'},{find:/([^\|><\(\)]+) (\()/g,replace:'<div class="media-body">$1</div>$2'},{find:/([^\|><\(\)]+)$/g,replace:'<div class="media-body">$1</div>'},{find:/\(([^\|><]+)\)$/g,replace:'<div class="media-right ui-selectmenu-item-price">$1</div></div>'}];for(var o in n)i=i.replace(n[o].find,n[o].replace);return i},width:"98%",maxHeight:250}),this.selectmenu=this.ui.select.data("ui-selectmenu")},destroySelect:function(){this.ui.select.data("ui-selectmenu")&&this.ui.select.selectmenu("destroy"),this.selectmenu=null}}),e.ListView=n.CollectionView.extend({itemView:e.ItemView,itemViewEventPrefix:"addedmeals:customization:options:view",hideAllErrors:function(){this.children.each(function(e){e.hideError()})},highlightError:function(){this.children.each(function(e){e.highlightError()})}})},WOS),Store.module("ConfiguratorApp.AddedMeals.Details",function(t,e,i,n,o,s,r){"use strict";var a=function(e){t.Controller.list(e)};t.addInitializer(function(){e.config.enableGrilling&&e.vent.on("addedmeals:view:loaded addedmeals:choice:changed addedmeals:view:customization:view:selectionchanged",function(e){setTimeout(function(){a(e)},50)})})},WOS),Store.module("ConfiguratorApp.AddedMeals.Details",function(t,o,e,i,s,r,n){"use strict";t.Controller={list:function(n){var e=r.bind(function(e,t){var i=this._getView(e);n.toggleCustomizationDetails(t),i.on("addedmeals:details:view:loaded",function(e){o.vent.trigger("addedmeals:details:view:loaded",e)}),n.customizeDetailsRegion.show(i)},this);s.when(o.request("customizableitems:entity:findCustomizedItemsByMeal",n.model),o.request("customizableitems:entity:diffByMeal",n.model)).then(e)},_getView:function(e){return new t.ListView({collection:e})}}},WOS),Store.module("ConfiguratorApp.AddedMeals.Details",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.Layout.extend({template:"#customize-item-details-template",className:"customization-details-listitem",regions:{includedRegion:"div.options-included",addonsRegion:"div.options-addons"},onShow:function(){this.trigger("loaded")}}),e.EmptyView=n.ItemView.extend({template:"#customize-item-details-empty-template"}),e.ListView=n.CollectionView.extend({className:"customization-details-list",itemView:e.ItemView,emptyView:e.EmptyView,itemViewEventPrefix:"addedmeals:details:view"})},WOS),Store.module("ConfiguratorApp.AddedMeals.Details.Options",function(t,e,i,n,o,s,r){"use strict";var a=function(e){t.Controller.list(e)};t.addInitializer(function(){e.vent.on("addedmeals:details:view:loaded",function(e){setTimeout(function(){a(e)},50)})})},WOS),Store.module("ConfiguratorApp.AddedMeals.Details.Options",function(t,i,e,n,s,r,o){"use strict";t.Controller={list:function(o){var e=r.bind(function(e,t){var i,n;e.length&&(i=this._getView(e),o.includedRegion.show(i)),t.length&&(n=this._getView(t),o.addonsRegion.show(n))},this);s.when(i.request("customizableitemoptions:entity:findCustomizedOptionsByMealItem",o.model)).then(e)},_getView:function(e){return new t.CompositeView({collection:e})}}},WOS),Store.module("ConfiguratorApp.AddedMeals.Details.Options",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.ItemView.extend({template:"#customize-item-details-option-template",tagName:"tr",templateHelpers:function(){return{selectedLabel:function(){return s.findWhere(this.options,{value:this.selected}).label},selectedPrice:function(){return s.findWhere(this.options,{value:this.selected}).price}}}}),e.CompositeView=n.CompositeView.extend({itemView:e.ItemView,itemViewContainer:"tbody",template:"#customize-item-details-option-table-template"})},WOS),Store.module("ConfiguratorApp.AvailableMeals",function(t,e,i,n,o,s,r){"use strict";var a=function(e){t.Controller.list(e)};t.addInitializer(function(){e.vent.on("configurator:loaded",a)})},WOS),Store.module("ConfiguratorApp.AvailableMeals",function(i,o,e,t,s,r,n){"use strict";i.Controller={list:function(n){var e=r.bind(function(e,t){o.commands.execute("gtm:components",e.toJSON());var i=this._getView(e,t);i.on("addedmeals:quantitychange",function(e,t,i,n){o.vent.trigger("addedmeals:quantitychange",t,i,n)}),n.availableItemsRegion.show(i)},this);s.when(o.request("availablemeals:entity:findAll",n.model.get("productCode")),o.request("addedmeals:entity:findAll")).then(e)},_getView:function(e,t){return new i.ListView({collection:e,addedMealsCollection:t})}}},WOS),Store.module("ConfiguratorApp.AvailableMeals",function(e,i,t,n,o,s,r){"use strict";e.ItemView=n.ItemView.extend({tagName:"tr",template:"#productset-template",templateHelpers:function(){return{maxQuantity:i.globals.maxQuantity,maxLength:i.globals.maxQuantity.toString().length}},events:{"click @ui.quantitydecrease":"changeQuantity","click @ui.quantityincrease":"changeQuantity","change @ui.quantityinput":"changeQuantity"},ui:{quantityinput:".form-control",quantityincrease:".btn-increase",quantitydecrease:".btn-decrease",details:".calories-column"},onShow:function(){r.Components.QuantityInput.init(this.$el,{pattern:this.quantityInputPattern}),r.Components.Popovers.init(this.ui.details),this.updateQuantity(null,this.options.addedMealsCollection),this.setState(this.model.get("availability"))},initialize:function(e){if(this.listenTo(this.options.addedMealsCollection,"add remove",this.updateQuantity),this.quantityInputPattern="9",1<i.globals.maxQuantity.toString().length){this.quantityInputPattern+="?";for(var t=1;t<i.globals.maxQuantity.toString().length;t++)this.quantityInputPattern+="9"}},changeQuantity:function(){var e=this.ui.quantityinput,t=parseInt(e.data("oldvalue"),10),i=parseInt(e.data("newvalue"),10),n=i-t,o=i;this.$el.toggleClass("selected",!!o),this.trigger("quantitychange",this.model,n,o)},updateQuantity:function(e,t){var i=t.where({productCode:this.model.get("productCode")}).length;this.ui.quantityinput.val(i),this.ui.quantityinput.data("newvalue",i),this.ui.quantityinput.data("oldvalue",i),this.$el.toggleClass("selected",!!i)},setState:function(e){this.$el.toggleClass("disabled",!e),this.ui.quantityinput.prop("disabled",!e),this.ui.quantityincrease.prop("disabled",!e),this.ui.quantitydecrease.prop("disabled",!e),this.ui.quantityincrease.toggleClass("disabled",!e),this.ui.quantitydecrease.toggleClass("disabled",!e)}}),e.ListView=n.CompositeView.extend({template:"#productsets-template",itemView:e.ItemView,itemViewEventPrefix:"addedmeals",itemViewContainer:"tbody",itemViewOptions:function(e,t){return{addedMealsCollection:this.options.addedMealsCollection}}})},WOS),Store.module("ConfiguratorApp",function(i,n,e,t,o,s,r){"use strict";var a=t.AppRouter.extend({appRoutes:{"add/:productCode":"createOrder","edit/:cartId":"editOrder"}}),l={browseCategory:function(){},createOrder:function(e){var t=isNaN(e)?e:parseInt(e,10);n.globals.productCode=t,i.Controller.createOrder(t),n.globals.errorMaxAddOn=[]},editOrder:function(e){var t=isNaN(e)?e:parseInt(e,10);n.globals.cartId=t,i.Controller.editOrder(t),n.globals.errorMaxAddOn=[]}};i.addInitializer(function(){n.addInitializer(function(){new a({controller:l}),n.addRegions({menuRegion:"#food-menu",productCardsRegion:"#product-cards",configuratorRegion:"#product-configurator",orderWidgetRegion:"#order-widget",choicesModalsRegion:"#modals-choices"}),n.commands.execute("availablemeals:entity:reset"),n.commands.execute("availablechoices:entity:reset"),n.commands.execute("availableupsells:entity:reset"),n.commands.execute("addedmeals:entity:reset")}),n.vent.on("configurator:closed",function(){o(window).trigger("resize"),n.commands.execute("addedmeals:entity:reset"),n.commands.execute("availablemeals:entity:reset"),n.commands.execute("availableupsells:entity:reset")}),n.vent.trigger("app:started","configurator")})},WOS),Store.module("ConfiguratorApp",function(n,o,i,e,s,r,t){"use strict";n.Controller={createOrder:function(e){var t=r.bind(this._showView,this),i=r.bind(function(){this._hideView(),o.vent.trigger("app:alert:start")},this);o.vent.trigger("app:loading:start"),s.when(o.request("availablemeals:entity:findOne",e),o.request("addedmeals:entity:findAll")).then(t,i).always(function(){o.vent.trigger("app:loading:end")})},editOrder:function(e){var t=r.bind(this._showView,this);o.vent.trigger("app:loading:start"),s.when(o.request("addedmeals:entity:findAllByCartId",e)).then(t).always(function(){o.vent.trigger("app:loading:end")})},cancelOrder:function(e){o.vent.trigger("configurator:cancelorder",e),this._hideView()},saveOrder:function(e){var t=r.bind(function(){i.history.navigate(""),o.vent.trigger("configurator:saveorder",e),o.commands.execute("gtm:additem"),o.config.debug||setTimeout(function(){location.reload()},300)},this);o.vent.trigger("app:loading:start"),s.when(o.request("cart:save")).then(t)},_showView:function(e,t){var i;e&&((i=new n.View({model:e,addedMealsCollection:t,isNewOrder:!o.globals.cartId})).on("configurator:loaded",function(e){o.vent.trigger("configurator:loaded",e)}),i.on("configurator:cancelorder",r.bind(n.Controller.cancelOrder,this)),i.on("configurator:saveorder",r.bind(n.Controller.saveOrder,this)),o.configuratorRegion.show(i))},_hideView:function(){o.configuratorRegion.close(),i.history.navigate(""),o.vent.trigger("configurator:closed")}}},WOS),Store.module("ConfiguratorApp",function(e,t,i,n,o,s,r){"use strict";e.View=n.Layout.extend({template:"#configurator-template",templateHelpers:function(){return{isNewOrder:this.options.isNewOrder}},regions:{availableItemsRegion:"#available-sets",addedItemsRegion:"#added-sets",upsellsRegion:"#upsell-section",costRegion:"#cost-section"},ui:{header:".configurator-header",body:".configurator-body",footer:".configurator-footer",quantity:".added-quantity",btnSave:".action-saveorder"},triggers:{"click .action-cancel":"configurator:cancelorder","click .action-saveorder":"configurator:saveorder"},initialize:function(e){this.listenTo(this.options.addedMealsCollection,"add remove",this.updateQuantity),this.listenTo(this.options.addedMealsCollection,"add remove",this.toggleSaveButton)},onShow:function(){o("body").addClass("show-configurator"),r.Components.Popovers.init(this.ui.header),o(window).on("scroll.configurator",s.bind(this.onScroll,this)),document.body.scrollTop=document.documentElement.scrollTop=0,this.updateQuantity(),this.toggleSaveButton(),this.trigger("configurator:loaded",this)},onClose:function(){o("body").removeClass("show-configurator"),o(window).off("scroll.configurator")},onScroll:r.Poll(function(){var e=o(window).scrollTop();this.ui.header[e<t.config.configurator.collapseOnScollLimit?"removeClass":"addClass"]("collapsed"),this.ui.body[e<t.config.configurator.collapseOnScollLimit?"removeClass":"addClass"]("expanded")},25),updateQuantity:function(){this.ui.quantity.text(this.options.addedMealsCollection.length)},toggleSaveButton:function(){this.ui.btnSave[this.options.addedMealsCollection.length&&!t.globals.errorMaxAddOn.length?"removeClass":"addClass"]("disabled"),this.ui.btnSave.prop("disabled",!this.options.addedMealsCollection.length&&!!t.globals.errorMaxAddOn.length)}})},WOS),Store.module("ConfiguratorApp.Cost",function(e,t,i,n,o,s,r){"use strict";var a=function(){e.Controller.list()};e.addInitializer(function(){t.config.enableSubtotal&&t.vent.on(["configurator:loaded","addedmeals:quantitychange","addedmeals:meal:removed","addedmeals:choice:changed","addedupsells:quantitychange","addedmeals:view:customization:view:selectionchanged"].join(" "),a)})},WOS),Store.module("ConfiguratorApp.Cost",function(t,i,e,n,o,s,r){"use strict";t.Controller={list:s.debounce(function(){var e=this._getSpinnerView();i.configuratorRegion.currentView.costRegion.show(e);var t=s.bind(function(e){var t=this._getView(e);i.configuratorRegion.currentView.costRegion.show(t)},this);o.when(i.request("cost:entity:findAll")).then(t)},500),_getView:function(e){return new t.View({model:new i.Entities.Model(e)})},_getSpinnerView:function(){return new t.SpinnerView}}},WOS),Store.module("ConfiguratorApp.Cost",function(e,t,i,n,o,s,r){"use strict";e.View=n.ItemView.extend({template:"#cost-template"}),e.SpinnerView=n.ItemView.extend({template:"#cost-loading-template"})},WOS),Store.module("ConfiguratorApp.Upsells",function(n,e,t,i,o,s,r){"use strict";var a=function(e){n.Controller.list(e)},l=function(e,t,i){n.Controller.update(e,t,i)};n.addInitializer(function(){e.vent.on("configurator:loaded",a),e.vent.on("addedupsells:quantitychange",l)})},WOS),Store.module("ConfiguratorApp.Upsells",function(t,o,e,i,n,s,r){"use strict";t.Controller={list:function(i){var e=s.bind(function(e){var t;e.length&&((t=this._getView(e)).on("addedupsells:quantitychange",function(e,t,i,n){o.vent.trigger("addedupsells:quantitychange",t,i,n)}),i.upsellsRegion.show(t))},this);n.when(o.request("availableupsells:entity:findAll",i.model.get("productCode"))).then(e)},update:function(e,t,i){o.commands.execute("addedupsells:entity:update",e,t,i)},_getView:function(e){return new t.ListView({collection:e})}}},WOS),Store.module("ConfiguratorApp.Upsells",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.ItemView.extend({template:"#upsellitem-template",templateHelpers:function(){return{maxQuantity:t.globals.maxQuantity,maxLength:t.globals.maxQuantity.toString().length}},className:"colsize-5 colsize-5-1of5",ui:{title:".product-title",quantityinput:".form-control"},events:{"click .action-decrease":"changeQuantity","click .action-increase":"changeQuantity","change .form-control":"changeQuantity"},onShow:function(){r.Components.QuantityInput.init(this.$el,{pattern:this.quantityInputPattern})},initialize:function(){if(this.quantityInputPattern="9",1<t.globals.maxQuantity.toString().length){this.quantityInputPattern+="?";for(var e=1;e<t.globals.maxQuantity.toString().length;e++)this.quantityInputPattern+="9"}},changeQuantity:function(){var e=this.ui.quantityinput,t=parseInt(e.data("oldvalue"),10),i=parseInt(e.data("newvalue"),10),n=i-t;this.trigger("quantitychange",this.model,n,i)},adjustHeight:function(e){this.ui.title.css("height",e)},getHeight:function(){return this.ui.title.css("height","auto").innerHeight()}}),e.ListView=n.CompositeView.extend({template:"#upsellsection-template",itemViewContainer:"#upsell-items .colsize-5-row",itemView:e.ItemView,itemViewEventPrefix:"addedupsells",onShow:function(){o(window).on("resize.configurator",s.bind(this.adjustHeight,this)),this.adjustHeight()},onClose:function(){o(window).off("resize.configurator")},adjustHeight:function(){var i=0;this.children.each(function(e){var t=e.getHeight();i<t&&(i=t)}),this.children.each(function(e){e.adjustHeight(i)})}})},WOS),Store.module("LoadingApp",function(e,t,i,n,o,s,r){"use strict";var a=function(){e.Controller.showLoader()},l=function(){e.Controller.hideLoader()};e.addInitializer(function(){t.vent.on("app:loading:start",a),t.vent.on("app:loading:end",l)})},WOS),Store.module("LoadingApp",function(e,t,i,n,o,s,r){"use strict";e.Controller={showLoader:function(){this._getView().showView()},hideLoader:function(){this._getView().hideView()},_getView:function(){return this.loadingView||(this.loadingView=new e.ItemView({})),this.loadingView}}},WOS),Store.module("LoadingApp",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.Layout.extend({el:"#loading-view",showView:function(){this.$el.removeClass("hidden")},hideView:function(){this.$el.addClass("hidden")}})},WOS),Store.module("PromotionApp.AddedPromotionalItems",function(n,e,t,i,o,s,r){"use strict";var a=function(e){n.Controller.list(e)},l=function(e,t,i){n.Controller.update(e,t,i)};n.addInitializer(function(){e.vent.on("promotion:loaded",a),e.vent.on("addedpromotionalitems:quantitychange",l)})},WOS),Store.module("PromotionApp.AddedPromotionalItems",function(t,n,e,i,o,s,r){"use strict";t.Controller={list:function(i){var e=s.bind(function(e){var t=this._getView(e);t.on("addedpromotionalitems:meal:removed",function(e,t){n.vent.trigger("addedpromotionalitems:meal:removed",e,t)}),t.on("addedpromotionalitems:view:loaded",function(e){n.vent.trigger("addedpromotionalitems:view:loaded",e)}),t.on("addedpromotionalitems:view:customization:view:selectionchanged",function(e){n.vent.trigger("addedpromotionalitems:view:customization:view:selectionchanged",e)}),t.on("addedpromotionalitems:view:customization:view:loaded",function(e){n.vent.trigger("addedpromotionalitems:view:customization:view:loaded",e)}),i.addedItemsRegion.show(t)},this);o.when(n.request("addedpromotionalitems:entity:findAll")).then(e)},update:function(e,t,i){n.commands.execute("addedpromotionalitems:entity:update",e,t,i)},_getView:function(e){return new t.ListView({collection:e})}}},WOS),Store.module("PromotionApp.AddedPromotionalItems",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.Layout.extend({className:"selected-meal-item",template:"#addedpromotionalset-template",regions:{componentsRegion:".components-column",choicesRegion:".choices-column",customizeRegion:".meal-customization",customizeDetailsRegion:".customization-details"},ui:{toggleCustomization:".action-customize",header:".header-info-column"},initialize:function(){this.customising=!1},events:{"click .action-delete":"destroy","click .action-customize":"toggleCustomization"},onShow:function(){this.trigger("loaded"),r.Components.Popovers.init(this.ui.header)},destroy:function(e){e.preventDefault(),this.model.destroy()},toggleCustomization:function(e){this[this.customizing?"hideCustomization":"showCustomization"](),this.customizing=!this.customizing},toggleCustomizeButton:function(e){this.ui.toggleCustomization.prop("disabled",!e),this.ui.toggleCustomization.addClass(e?"":"disabled")},showCustomization:function(){this.$el.addClass("selected-meal-expanded"),this.ui.toggleCustomization.find("span").text(this.ui.toggleCustomization.data("expanded-text"))},hideCustomization:function(){this.$el.removeClass("selected-meal-expanded"),this.ui.toggleCustomization.find("span").text(this.ui.toggleCustomization.data("collapsed-text"))}}),e.EmptyView=n.ItemView.extend({template:"#addedpromotionalsetempty-template"}),e.ListView=n.CollectionView.extend({itemView:e.ItemView,emptyView:e.EmptyView,itemViewEventPrefix:"addedpromotionalitems:view",collectionEvents:{remove:"mealRemoved"},mealRemoved:function(e,t){this.trigger("addedpromotionalitems:meal:removed",e,t)}})},WOS),Store.module("PromotionApp.AvailableChoices",function(i,e,t,n,o,s,r){"use strict";var a=function(e,t){i.Controller.list(e,t)};i.addInitializer(function(){e.vent.on("addedpromotionalitems:choice:changing",function(e,t){a(e,t)})})},WOS),Store.module("PromotionApp.AvailableChoices",function(n,o,e,t,i,s,r){"use strict";n.Controller={list:function(e,n){var t=s.bind(function(e,t){var i=this._getRadioListView(t,e,n.model);i.on("availablechoices:view:hidden",i.close),i.on("availablechoices:choices:save",function(e,t,i){o.commands.execute("addedpromotionalchoices:entity:update",e,t,i),n.view.trigger("changed")}),o.choicesModalsRegion.show(i)},this);o.vent.trigger("app:loading:start"),i.when(o.request("availablechoices:entity:findAll",n.model)).then(t).always(function(){o.vent.trigger("app:loading:end")})},_getRadioListView:function(e,t,i){return new n.RadioListView({collection:t,model:i,displayOptions:e})}}},WOS),Store.module("PromotionApp.AvailableChoices",function(e,t,i,n,d,o,s){"use strict";e.RadioItemView=n.ItemView.extend({template:"#available-choice-template",triggers:{"ifChecked :radio":"selected"},ui:{radio:"input:radio",radioGroup:".radio"},onRender:function(){setTimeout(o.bind(function(){s.Forms.InputStates.init(this.ui.radioGroup)},this),1)},onShow:function(){this.model.get("productCode")==this.options.productCode&&this.ui.radio.iCheck("check")}}),e.RadioListView=n.CompositeView.extend({template:"#available-choices-template",templateHelpers:function(){return{columnsToDisplay:this.getColumnsToDisplay()}},className:"modal-available-choices modal fade",itemView:e.RadioItemView,itemViewOptions:function(){return{productCode:this.model.get("selectedSolutionCode")}},itemViewContainer:".available-choices-list",itemViewEventPrefix:"availablechoice",itemEvents:{selected:"onChoiceSelected"},events:{"click .btn-submit":"onSave"},ui:{radioGroups:".radio",choiceImage:".choice-image",dialog:".modal-dialog",choicesContainer:".available-choices-list"},initialize:function(){this.$el.on("hidden.bs.modal",o.bind(function(){this.trigger("availablechoices:view:hidden")},this))},onShow:function(){this.$el.modal("show")},onChoiceSelected:function(e,t,i){this.selectedChoice=i.model,this.ui.choiceImage.attr("src",i.model.get("images")[0].imageUrl)},onSave:function(e){var t,i;e.preventDefault(),this.selectedChoice&&(i={mealid:(t=d.extend(!0,{},this.model.toJSON())).mealid,productCode:t.productCode,selectedSolutionCode:this.selectedChoice.get("productCode"),selectedSolutionCartName:this.selectedChoice.get("cartName"),selectedSolutionPath:this.selectedChoice.get("solutionPath"),selectedSolutionHierarchyPath:this.selectedChoice.get("solutionHierarchyPath"),selectedQuantity:1,included:this.selectedChoice.get("included"),addons:this.selectedChoice.get("addons"),choices:this.selectedChoice.get("choices"),components:this.selectedChoice.get("components")},this.trigger("availablechoices:choices:save",[i],t,!1)),this.$el.modal("hide")},getColumnsToDisplay:function(){var e=Math.ceil(this.collection.length/8);return 3<e?3:e},appendHtml:function(e,t,i){for(var n=this.getItemViewContainer(e),o=this.getColumnsToDisplay(),s="col-xs-"+(12/o).toString(),r=Math.ceil(this.collection.length/o),a=0;a<o;a++){var l=n.find(".column-"+a);l.length||(l=d('<div class="choices-column '+s+" column-"+a+'"></div>')),n.append(l)}var c=Math.floor(i/r);n.find(".choices-column").eq(c).append(t.el)}})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Choices",function(t,e,i,n,o,s,r){"use strict";var a=function(e){t.Controller.list(e)};t.addInitializer(function(){e.vent.on("addedpromotionalitems:view:loaded addedpromotionalitems:choice:changed",function(e){setTimeout(function(){a(e)},300)})})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Choices",function(t,n,e,i,o,s,r){"use strict";t.Controller={list:function(i){var e=s.bind(function(e){var t=this._getView(e);t.on("addedpromotionalitems:choice:changing",function(e,t){n.vent.trigger("addedpromotionalitems:choice:changing",e,t)}),t.on("addedpromotionalitems:choice:changed",function(e,t){n.vent.trigger("addedpromotionalitems:choice:changed",i,e,t)}),i.choicesRegion.show(t)},this);o.when(n.request("addedpromotionalchoices:entity:findAllByMeal",i.model)).then(e)},_getView:function(e){return new t.ListView({collection:e})}}},WOS),Store.module("PromotionApp.AddedPromotionalItems.Choices",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.Layout.extend({template:"#addedset-choice-template",ui:{changeLink:".action-change"},regions:{availableChoices:".modal-available-choices"},triggers:{"click .action-change":"changing"},modelEvents:{change:"render onChanged"},onChanged:function(){this.trigger("changed")}}),e.ListView=n.CollectionView.extend({itemView:e.ItemView,className:"fooditem",itemViewEventPrefix:"addedpromotionalitems:choice"})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Components",function(t,e,i,n,o,s,r){"use strict";var a=function(e){t.Controller.list(e)};t.addInitializer(function(){e.vent.on("addedpromotionalitems:view:loaded addedpromotionalitems:choice:changed",function(e){setTimeout(function(){a(e)},50)})})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Components",function(t,n,e,i,o,s,r){"use strict";t.Controller={list:function(i){var e;i.model.get("components").length&&(e=s.bind(function(e){var t=this._getView(e);i.componentsRegion.show(t)},this),o.when(n.request("addedpromotionalcomponents:entity:findAllByMeal",i.model)).then(e))},_getView:function(e){return new t.ListView({collection:e})}}},WOS),Store.module("PromotionApp.AddedPromotionalItems.Components",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.ItemView.extend({template:"#addedset-component-template",className:"fooditem"}),e.ListView=n.CollectionView.extend({itemView:e.ItemView})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Customization",function(t,e,i,n,o,s,r){"use strict";var a=function(e){t.Controller.list(e)};t.addInitializer(function(){e.config.enableGrilling&&e.vent.on("addedpromotionalitems:view:loaded addedpromotionalitems:choice:changed",function(e){setTimeout(function(){a(e)},50)})})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Customization",function(t,n,e,i,o,s,r){"use strict";t.Controller={list:function(i){var e=s.bind(function(e){i.toggleCustomizeButton(!!e.length);var t=this._getView(e);t.on("addedpromotionalitems:customization:view:loaded",function(e){n.vent.trigger("addedpromotionalitems:customization:view:loaded",e),i.trigger("customization:view:loaded")}),t.on("addedpromotionalitems:customization:view:selectionchanged",function(e){i.trigger("customization:view:selectionchanged")}),i.customizeRegion.show(t)},this);o.when(n.request("customizablepromotionalitems:entity:findAllByMeal",i.model)).then(e)},_getView:function(e){return new t.ListView({collection:e})}}},WOS),Store.module("PromotionApp.AddedPromotionalItems.Customization",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.Layout.extend({className:"customize-item",template:"#customize-item-template",regions:{includedRegion:".customization-options-included",addonsRegion:".customization-options-addons"},ui:{toggle:".item-toggle",body:".customize-item-body"},onShow:function(){this.trigger("loaded")},expand:function(){this.toggle(!0)},collapse:function(){this.toggle(!1)},toggle:function(e){this.ui.toggle[e?"removeClass":"addClass"]("collapsed"),this.ui.body[e?"addClass":"removeClass"]("in")}}),e.EmptyView=n.ItemView.extend({template:"#customize-items-empty-template"}),e.ListView=n.CompositeView.extend({itemView:e.ItemView,emptyView:e.EmptyView,template:"#customize-items-template",itemViewContainer:".customize-items",itemViewEventPrefix:"addedpromotionalitems:customization:view",onShow:function(){this.collection.length&&this.children.first().expand()}})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Customization.Options",function(t,e,i,n,o,s,r){"use strict";var a=function(e){t.Controller.list(e)};t.addInitializer(function(){e.vent.on("addedpromotionalitems:customization:view:loaded",function(e){setTimeout(function(){a(e)},50)})})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Customization.Options",function(t,i,e,n,s,r,o){"use strict";t.Controller={list:function(o){var e=r.bind(function(e,t){var i=this._getView(e),n=this._getView(t);i.on("addedpromotionalitems:customization:options:view:selectionchanged",function(e){o.trigger("selectionchanged")}),n.on("addedpromotionalitems:customization:options:view:selectionchanged",function(e){o.trigger("selectionchanged")}),o.includedRegion.show(i),o.addonsRegion.show(n)},this);s.when(i.request("customizablepromotionalitemoptions:entity:findAllByMealItem",o.model)).then(e)},_getView:function(e){return new t.ListView({collection:e})}}},WOS),Store.module("PromotionApp.AddedPromotionalItems.Customization.Options",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.ItemView.extend({className:"customize-item-option",template:"#customize-item-option-template",ui:{select:"select"},events:{"change @ui.select":"onSelectionChanged"},onShow:function(){this.ui.select.val(this.model.get("selected")),r.Forms.CustomSelect.init(this.$el)},onClose:function(){r.Forms.CustomSelect.destroy(this.ui.select)},onSelectionChanged:function(e){this.model.save({selected:this.ui.select.val()}),this.trigger("selectionchanged")}}),e.ListView=n.CollectionView.extend({itemView:e.ItemView,itemViewEventPrefix:"addedpromotionalitems:customization:options:view"})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Details",function(t,e,i,n,o,s,r){"use strict";var a=function(e){t.Controller.list(e)};t.addInitializer(function(){e.config.enableGrilling&&e.vent.on("addedpromotionalitems:view:loaded addedpromotionalitems:choice:changed addedpromotionalitems:view:customization:view:selectionchanged",function(e){setTimeout(function(){a(e)},50)})})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Details",function(t,n,e,i,o,s,r){"use strict";t.Controller={list:function(i){var e=s.bind(function(e){var t=this._getView(e);t.on("addedpromotionalitems:details:view:loaded",function(e){n.vent.trigger("addedpromotionalitems:details:view:loaded",e)}),i.customizeDetailsRegion.show(t)},this);o.when(n.request("customizablepromotionalitems:entity:findAllByMeal",i.model)).then(e)},_getView:function(e){return new t.ListView({collection:e})}}},WOS),Store.module("PromotionApp.AddedPromotionalItems.Details",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.Layout.extend({template:"#customize-item-details-template",regions:{includedRegion:"span.options-included",addonsRegion:"span.options-addons"},onShow:function(){this.trigger("loaded")}}),e.EmptyView=n.ItemView.extend({template:"#customize-item-details-empty-template"}),e.ListView=n.CollectionView.extend({tagName:"span",itemView:e.ItemView,emptyView:e.EmptyView,itemViewEventPrefix:"addedpromotionalitems:details:view"})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Details.Options",function(t,i,e,n,s,r,o){"use strict";t.Controller={list:function(o){var e=r.bind(function(e,t){var i=this._getView(e),n=this._getView(t);o.includedRegion.show(i),o.addonsRegion.show(n)},this);s.when(i.request("customizablepromotionalitemoptions:entity:findAllByMealItem",o.model)).then(e)},_getView:function(e){return new t.ListView({collection:e})}}},WOS),Store.module("PromotionApp.AddedPromotionalItems.Details.Options",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.ItemView.extend({template:"#customize-item-details-option-template",tagName:"span"}),e.ListView=n.CollectionView.extend({itemView:e.ItemView,tagName:"span"})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Details.Options",function(t,e,i,n,o,s,r){"use strict";var a=function(e){t.Controller.list(e)};t.addInitializer(function(){e.vent.on("addedpromotionalitems:details:view:loaded",function(e){setTimeout(function(){a(e)},50)})})},WOS),Store.module("PromotionApp.AvailableItems",function(t,e,i,n,o,s,r){"use strict";var a=function(e){t.Controller.list(e)};t.addInitializer(function(){e.vent.on("promotion:loaded",a)})},WOS),Store.module("PromotionApp.AvailableItems",function(i,o,e,t,s,r,n){"use strict";i.Controller={list:function(n){var e=r.bind(function(e,t){var i=this._getView(e[0],t);i.on("addedpromotionalitems:quantitychange",function(e,t,i,n){o.vent.trigger("addedpromotionalitems:quantitychange",t,i,n)}),n.availableItemsRegion.show(i)},this);s.when(o.request("availablepromotionalitems:entity:findAll",n.model.get("promoId")),o.request("addedpromotionalitems:entity:findAll")).then(e)},_getView:function(e,t){return new i.ListView({collection:e,addedPromotionalItemsCollection:t})}}},WOS),Store.module("PromotionApp.AvailableItems",function(e,i,t,n,o,s,r){"use strict";e.ItemView=n.ItemView.extend({tagName:"tr",template:"#productset-template",templateHelpers:function(){return{maxQuantity:i.globals.maxQuantity,maxLength:i.globals.maxQuantity.toString().length}},events:{"click @ui.quantitydecrease":"changeQuantity","click @ui.quantityincrease":"changeQuantity","change @ui.quantityinput":"changeQuantity"},ui:{quantityinput:".form-control",quantityincrease:".btn-increase",quantitydecrease:".btn-decrease"},onShow:function(){r.Components.QuantityInput.init(this.$el,{pattern:this.quantityInputPattern}),this.updateQuantity(null,this.options.addedPromotionalItemsCollection),this.setState(this.model.get("availability"))},initialize:function(e){if(this.listenTo(this.options.addedPromotionalItemsCollection,"add remove",this.updateQuantity),this.quantityInputPattern="9",1<i.globals.maxQuantity.toString().length){this.quantityInputPattern+="?";for(var t=1;t<i.globals.maxQuantity.toString().length;t++)this.quantityInputPattern+="9"}},changeQuantity:function(){var e=this.ui.quantityinput,t=parseInt(e.data("oldvalue"),10),i=parseInt(e.data("newvalue"),10),n=i-t,o=i;this.$el.toggleClass("selected",!!o),this.trigger("quantitychange",this.model,n,o)},updateQuantity:function(e,t){var i=t.where({productCode:this.model.get("productCode")}).length;this.ui.quantityinput.val(i),this.ui.quantityinput.data("newvalue",i),this.ui.quantityinput.data("oldvalue",i),this.$el.toggleClass("selected",!!i)},setState:function(e){this.$el.toggleClass("disabled",!e),this.ui.quantityinput.prop("disabled",!e),this.ui.quantityincrease.prop("disabled",!e),this.ui.quantitydecrease.prop("disabled",!e),this.ui.quantityincrease.toggleClass("disabled",!e),this.ui.quantitydecrease.toggleClass("disabled",!e)}}),e.ListView=n.CompositeView.extend({template:"#productsets-template",itemView:e.ItemView,itemViewEventPrefix:"addedpromotionalitems",itemViewContainer:"tbody",itemViewOptions:function(e,t){return{addedPromotionalItemsCollection:this.options.addedPromotionalItemsCollection}}})},WOS),Store.module("PromotionApp",function(i,n,e,t,o,s,r){"use strict";var a=t.AppRouter.extend({appRoutes:{"promotion/:promoId/new":"createOrder","promotion/:promoId/edit":"editOrder"}}),l={createOrder:function(e){var t=isNaN(e)?e:parseInt(e,10);n.globals.promoId=t,i.Controller.createOrder(t)},editOrder:function(e){var t=isNaN(e)?e:parseInt(e,10);n.globals.promoId=t,i.Controller.editOrder(t)}};i.addInitializer(function(){n.addInitializer(function(){new a({controller:l}),n.addRegions({menuRegion:"#food-menu",productCardsRegion:"#product-cards",configuratorRegion:"#product-configurator",orderWidgetRegion:"#order-widget",choicesModalsRegion:"#modals-choices"}),n.commands.execute("availablepromotionalitems:entity:reset"),n.commands.execute("addedpromotionalitems:entity:reset")}),n.vent.on("promotion:closed",function(){o(window).trigger("resize"),n.commands.execute("addedpromotionalitems:entity:reset"),n.commands.execute("availablepromotionalitems:entity:reset")}),n.vent.trigger("app:started","promotion")})},WOS),Store.module("PromotionApp",function(n,o,i,e,s,r,t){"use strict";n.Controller={createOrder:function(e){var t=r.bind(this._showView,this);o.vent.trigger("app:loading:start"),s.when(o.request("availablepromotionalitems:entity:findAll",e),o.request("addedpromotionalitems:entity:findAll")).then(t).always(function(){o.vent.trigger("app:loading:end")})},editOrder:function(e){var t=r.bind(this._showView,this);o.vent.trigger("app:loading:start"),s.when(o.request("addedpromotionalitems:entity:findAllByCartId",e)).then(t).always(function(){o.vent.trigger("app:loading:end")})},saveOrder:function(e){var t=r.bind(function(){i.history.navigate(""),o.vent.trigger("promotion:saveorder",e),o.config.debug||location.reload()},this);o.vent.trigger("app:loading:start"),s.when(o.request("promotionalcart:save")).then(t)},cancelOrder:function(e){o.vent.trigger("promotion:cancelorder",e),this._hideView()},_showView:function(e,t){var i=new n.View({model:e[0],maxQuantity:e[1],promoId:e[2],addedPromotionalItemsCollection:t,isNewOrder:!o.globals.promoId});i.on("promotion:loaded",function(e){o.vent.trigger("promotion:loaded",e)}),i.on("promotion:cancelorder",r.bind(n.Controller.cancelOrder,this)),i.on("promotion:saveorder",r.bind(n.Controller.saveOrder,this)),o.configuratorRegion.show(i)},_hideView:function(){o.configuratorRegion.close(),i.history.navigate(""),o.vent.trigger("promotion:closed")}}},WOS),Store.module("PromotionApp",function(e,t,i,n,o,s,r){"use strict";e.View=n.Layout.extend({template:"#promotion-configurator-template",templateHelpers:function(){return{isNewOrder:this.options.isNewOrder,maxQuantity:this.options.maxQuantity,promoId:this.options.promoId}},regions:{availableItemsRegion:"#available-sets",addedItemsRegion:"#added-sets"},ui:{header:".configurator-header",body:".configurator-body",footer:".configurator-footer",quantity:".added-quantity",instruction:".instruction",instructionError:".instruction-error-container",btnSave:".action-saveorder"},triggers:{"click .action-cancel":"promotion:cancelorder","click .action-saveorder":"promotion:saveorder"},initialize:function(e){this.listenTo(this.options.addedPromotionalItemsCollection,"add remove change:selectedQuantity",this.updateQuantity),this.listenTo(this.options.addedPromotionalItemsCollection,"add remove change:selectedQuantity",this.toggleSaveButton),this.listenTo(this.options.addedPromotionalItemsCollection,"add remove change:selectedQuantity",this.toggleErrorMessage)},onShow:function(){o("body").addClass("show-configurator show-promotion-configurator"),o(window).on("scroll.configurator",s.bind(this.onScroll,this)),document.body.scrollTop=document.documentElement.scrollTop=0,this.updateQuantity(),this.toggleSaveButton(),this.trigger("promotion:loaded",this)},onClose:function(){o("body").removeClass("show-configurator show-promotion-configurator"),o(window).off("scroll.configurator")},onScroll:r.Poll(function(){var e=o(window).scrollTop();this.ui.header[e<t.config.configurator.collapseOnScollLimit?"removeClass":"addClass"]("collapsed"),this.ui.body[e<t.config.configurator.collapseOnScollLimit?"removeClass":"addClass"]("expanded")},25),_getQuantity:function(){return this.options.addedPromotionalItemsCollection.length},updateQuantity:function(){this.ui.quantity.text(this._getQuantity())},toggleSaveButton:function(){var e=this._getQuantity(),t=this.options.addedPromotionalItemsCollection.length&&e<=this.options.maxQuantity;this.ui.btnSave[t?"removeClass":"addClass"]("disabled"),this.ui.btnSave.prop("disabled",!t)},toggleErrorMessage:function(){this._getQuantity()>this.options.maxQuantity?(this.ui.instructionError.show(),this.ui.instruction.hide()):(this.ui.instructionError.hide(),this.ui.instruction.show())}})},WOS),Store.module("SuggestionApp",function(i,n,e,t,o,s,r){"use strict";var a=t.AppRouter.extend({appRoutes:{"suggestions/:productCode":"chooseSuggestions"}}),l={chooseSuggestions:function(e){var t=isNaN(e)?e:parseInt(e,10);n.globals.productCode=t,i.Controller.chooseSuggestions(t),n.globals.errorMaxAddOn=[]}};i.addInitializer(function(){n.addInitializer(function(){new a({controller:l}),n.addRegions({menuRegion:"#food-menu",productCardsRegion:"#product-cards",configuratorRegion:"#product-configurator",orderWidgetRegion:"#order-widget",choicesModalsRegion:"#modals-choices"}),n.commands.execute("availableupsells:entity:reset"),n.commands.execute("addedupsells:entity:reset")}),n.vent.on("suggestion:closed",function(){o(window).trigger("resize"),n.commands.execute("availableupsells:entity:reset"),n.commands.execute("addedupsells:entity:reset")}),n.vent.trigger("app:started","suggestion")})},WOS),Store.module("SuggestionApp",function(n,o,i,e,s,r,t){"use strict";n.Controller={chooseSuggestions:function(e){var t=r.bind(this._showView,this);o.vent.trigger("app:loading:start"),s.when(o.request("availablemeals:entity:findOne",e)).then(t).always(function(){})},cancelOrder:function(e){o.vent.trigger("suggestion:cancelorder",e),this._hideView(),o.config.debug||setTimeout(function(){window.location.href=o.config.orderReviewUrl},200)},saveOrder:function(e){var t=r.bind(function(){i.history.navigate(""),o.vent.trigger("suggestion:saveorder",e),o.commands.execute("gtm:additem"),o.config.debug||setTimeout(function(){window.location.href=o.config.redirectOrderReviewUrl},200)},this);o.vent.trigger("app:loading:start"),s.when(o.request("suggestioncart:save")).then(t)},_showView:function(e,t){var i;e&&((i=new n.View({model:e,addedUpsellsCollection:t,isNewOrder:!o.globals.cartId})).on("suggestionApp:shown",function(){o.vent.trigger("suggestionApp:shown")}),o.vent.on("suggestion:insufficient:quantity",r.bind(n.Controller.cancelOrder,this)),i.on("suggestion:cancelorder",r.bind(n.Controller.cancelOrder,this)),i.on("suggestion:saveorder",r.bind(n.Controller.saveOrder,this)),o.vent.on("suggestion:upsell:loaded",function(){o.configuratorRegion.show(i)}),o.vent.trigger("suggestion:loaded",i))},_hideView:function(){o.configuratorRegion.close(),i.history.navigate(""),o.vent.trigger("suggestion:closed")}}},WOS),Store.module("SuggestionApp",function(e,t,i,n,o,s,r){"use strict";e.View=n.Layout.extend({template:"#suggestion-configurator-template",templateHelpers:function(){return{isNewOrder:this.options.isNewOrder}},regions:{upsellsRegion:"#suggestion-upsell-section",suggestionCostRegion:"#suggestion-cost-section",modalRegion:"#suggestion-modal-content"},className:"modal fade",ui:{body:".suggestion-body",footer:".suggestion-footer",quantity:".added-quantity",btnSave:".action-saveorder"},triggers:{"click .action-cancel":"suggestion:cancelorder","click .action-saveorder":"suggestion:saveorder"},initialize:function(e){},onShow:function(){this.$el.modal("show"),o("#product-configurator").find(".modal-backdrop").removeClass("modal-backdrop").addClass("modal"),this.trigger("suggestionApp:shown")},onClose:function(){this.$el.modal("hide"),o("body").removeClass("modal-open")},toggleSaveButton:function(){}})},WOS),Store.module("SuggestionApp.Cost",function(e,t,i,n,o,s,r){"use strict";var a=function(){e.Controller.list()};e.addInitializer(function(){t.config.enableSubtotal&&t.vent.on(["configurator:loaded","addedmeals:quantitychange","addedmeals:meal:removed","addedmeals:choice:changed","addedupsells:quantitychange","addedmeals:view:customization:view:selectionchanged"].join(" "),a)})},WOS),Store.module("SuggestionApp.Cost",function(t,i,e,n,o,s,r){"use strict";t.Controller={list:s.debounce(function(){var e=this._getSpinnerView();i.configuratorRegion.currentView.suggestionCostRegion.show(e);var t=s.bind(function(e){var t=this._getView(e);i.configuratorRegion.currentView.suggestionCostRegion.show(t)},this);o.when(i.request("suggestioncost:entity:findAll")).then(t)},500),_getView:function(e){return new t.View({model:new i.Entities.Model(e)})},_getSpinnerView:function(){return new t.SpinnerView}}},WOS),Store.module("SuggestionApp.Cost",function(e,t,i,n,o,s,r){"use strict";e.View=n.ItemView.extend({template:"#suggestion-cost-template"}),e.SpinnerView=n.ItemView.extend({template:"#suggestion-cost-loading-template"})},WOS),Store.module("SuggestionApp.Upsells",function(t,e,i,n,o,s,r){"use strict";var a=function(e){t.Controller.list(e)};t.addInitializer(function(){e.vent.on("suggestion:loaded",a)})},WOS),Store.module("SuggestionApp.Upsells",function(t,o,e,i,n,s,r){"use strict";t.Controller={list:function(i){var e=s.bind(function(e){var t;1<e.length?((t=this._getView(e)).on("addedupsells:quantitychange",function(e,t,i,n){o.vent.trigger("addedupsells:quantitychange",t,i,n)}),o.vent.on("suggestionApp:shown",function(){i.upsellsRegion.show(t)}),o.vent.trigger("suggestion:upsell:loaded")):o.vent.trigger("suggestion:insufficient:quantity")},this);n.when(o.request("availableupsells:entity:findAll",i.model.get("productCode"))).then(e).always(function(){o.vent.trigger("app:loading:end")})},_getView:function(e){return new t.ListView({collection:e})}}},WOS),Store.module("SuggestionApp.Upsells",function(e,t,i,n,o,s,r){"use strict";e.ItemView=n.ItemView.extend({template:"#suggestion-upsellitem-template",templateHelpers:function(){return{maxQuantity:t.globals.maxQuantity,maxLength:t.globals.maxQuantity.toString().length}},className:"colsize-5 colsize-5-1of5",ui:{title:".product-title",quantityinput:".form-control"},events:{"click .action-decrease":"changeQuantity","click .action-increase":"changeQuantity","change .form-control":"changeQuantity"},onShow:function(){r.Components.QuantityInput.init(this.$el,{pattern:this.quantityInputPattern})},initialize:function(){if(this.quantityInputPattern="9",1<t.globals.maxQuantity.toString().length){this.quantityInputPattern+="?";for(var e=1;e<t.globals.maxQuantity.toString().length;e++)this.quantityInputPattern+="9"}},changeQuantity:function(){var e=this.ui.quantityinput,t=parseInt(e.data("oldvalue"),10),i=parseInt(e.data("newvalue"),10),n=i-t;this.trigger("quantitychange",this.model,n,i),this.toggleBtn()},adjustHeight:function(e){e=0==e?"30px":e,this.ui.title.css("height",e)},getHeight:function(){return this.ui.title.css("height","auto").innerHeight()},toggleBtn:function(){var e=0,t=0;o(".form-control",o("#suggestion-upsell-items")).each(function(){t=parseInt(o(this).data("newvalue"),10),e+=t}),0<e?o("#product-configurator").find(".action-saveorder").removeClass("disabled").addClass("enabled"):o("#product-configurator").find(".action-saveorder").removeClass("enabled").addClass("disabled")}}),e.ListView=n.CompositeView.extend({template:"#suggestion-upsellsection-template",itemViewContainer:"#suggestion-upsell-items .colsize-5-row",itemView:e.ItemView,itemViewEventPrefix:"addedupsells",onShow:function(){o(window).on("resize.configurator",s.bind(this.adjustHeight,this)),this.adjustHeight(),this.adjustWidth()},onClose:function(){o(window).off("resize.configurator")},adjustWidth:function(){var e=0,t=this.children.length,i="colsize-5 colsize-5-1of5";t<=5?(e=20*t+"%",i="colsize-"+t+" colsize-"+t+"-1of"+t):e="100%",o("#suggestion-upsell-items").find(".colsize-5").removeClass("colsize-5 colsize-5-1of5").addClass(i),o("body").find(".suggestive-sell-container").children(".modal-dialog").css("width",e)},adjustHeight:function(){var i=0;this.children.each(function(e){var t=e.getHeight();i<t&&(i=t)}),this.children.each(function(e){e.adjustHeight(i)})}})},WOS),Store.module("Entities",function(e,t,i,n,o,s){e.Model=i.Model.extend({}),e.Collection=i.Collection.extend({initialize:function(e,t){this.options=t}})}),Store.module("Entities",function(e,o,t,i,l,c){"use strict";var d=0,u=o.Entities.Model.extend({idAttribute:"___id",defaults:{type:"choice"},services:{create:function(e,t){var i=l.Deferred();i.done(function(e){o.commands.execute("customizableitemoptions:entity:insert:choice",e)}),i.done(t.success);var n=o.db.added.choices.insert(l.extend(!0,{},e.toJSON())).first();return i.resolve(n),i.promise()},read:function(e,t){var i=l.Deferred(),n=o.db.added.choices(e.id).first();return i.done(t.success),i.resolve(n),i.promise()},update:function(e,t){var i=l.Deferred(),n=o.db.added.choices(e.id).update(e.toJSON()).first();return i.done(function(e){o.commands.execute("customizableitemoptions:entity:destroy:choice",e),o.commands.execute("customizableitemoptions:entity:insert:choice",e)}),i.done(t.success),i.resolve(n),i.promise()},delete:function(e,t){var i=l.Deferred(),n=o.db.added.choices(e.id).remove();return i.done(function(e){o.commands.execute("customizableitemoptions:entity:destroy:choice",e),o.commands.execute("addedcomponents:entity:destroy",{parentId:e.___id}),o.commands.execute("addedchoices:entity:destroy",{parentId:e.___id})}),i.done(t.success),n&&i.resolve(e.toJSON()),i.promise()}},sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)}}),s=o.Entities.Collection.extend({model:u,sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{read:function(e,t){var i=l.Deferred(),n=o.db.added.choices().order("selectedSolutionPath asec").get();return i.done(t.success),i.resolve(n),i.promise()}},comparator:"displayOrder"}),n={_getChoices:function(e){var t=new s;t.on("reset",e),t.fetch({reset:!0})},findAllByMeal:function(n){var o=l.Deferred();return this._getChoices(function(e){var t=e.where({mealid:n.id}),i=new s(t);o.resolve(i)}),o.promise()},findAllByListId:function(n){var o=l.Deferred();return this._getChoices(function(e){var t=e.where({mealid:n.get("mealid"),productCode:n.get("productCode")}),i=new s(t);o.resolve(i)}),o.promise()},update:function(e,i,t){o.commands.execute("addedchoices:entity:destroy",{___id:i.___id});var n={___id:i.mealid,choices:[],components:[]};c.each(e,function(t){t.defaultQuantity=1,t.minQuantity=i.minQuantity,t.maxQuantity=i.maxQuantity,t.parentId=i.parentId,t.displayOrder=i.displayOrder,n.choices.push(t),t.hasOwnProperty("choices")&&t.choices.length&&c.each(t.choices,function(e){n.choices.push(e)}),t.hasOwnProperty("components")&&t.components.length&&c.each(t.components,function(e){e.mealid=t.mealid,e.parentId=i.parentId,o.commands.execute("addedcomponents:entity:insert",e)})}),this.insertByMeal(n)},insertByMeal:function(t){var i=0,a=[];c.each(t.choices,function(e){e.mealid=t.___id,e.selectedSolutionCode=e.defaultSolutionCode||e.selectedSolutionCode,e.selectedSolutionCartName=e.defaultSolutionCartName||e.selectedSolutionCartName,e.selectedSolutionPath=e.defaultSolutionPath||e.selectedSolutionPath,e.selectedQuantity=1,e.depth=r(e.selectedSolutionPath),i=e.depth>i?e.depth:i});for(var n=1;n<=i;n++){!function(e,r){c.each(e,function(o){var t=h(o.selectedSolutionPath),e=c.filter(a,function(e){return e.depth==r-1&&e.solutionPath==t});if(e.length)c.each(e,function(e){for(var t=0;t<o.defaultQuantity;t++){var i=l.extend(!0,{parentId:e.id,displayOrder:++d},o),n=new u(i);n.save(),a.push({depth:r,solutionPath:o.selectedSolutionPath,id:n.id})}});else for(var i=0;i<o.defaultQuantity;i++){var n=l.extend(!0,{parentId:null,displayOrder:++d},o),s=new u(n);s.save(),a.push({depth:r,solutionPath:o.selectedSolutionPath,id:s.id})}})}(c.filter(t.choices,function(e){return e.depth==n}),n)}},insertbyEditCart:function(t){var i=0,a=[];c.each(t.choices,function(e){e.mealid=t.___id,e.selectedSolutionCode=e.defaultSolutionCode||e.selectedSolutionCode,e.selectedSolutionCartName=e.defaultSolutionCartName||e.selectedSolutionCartName,e.selectedSolutionPath=e.defaultSolutionPath||e.selectedSolutionPath,e.selectedQuantity=1,e.depth=r(e.selectedSolutionPath),e.displayOrder=++d,i=e.depth>i?e.depth:i});for(var n=1;n<=i;n++){!function(e,r){c.each(e,function(e,t){var i,n,o=h(e.selectedSolutionPath),s=c.filter(a,function(e){return e.depth==r-1&&e.solutionPath==o});i=s.length?l.extend(!0,{parentId:s[t%s.length].id},e):l.extend(!0,{parentId:null},e),(n=new u(i)).save(),a.push({depth:r,solutionPath:e.selectedSolutionPath,id:n.id})})}(c.filter(t.choices,function(e){return e.depth==n}),n)}},destroy:function(i){this._getChoices(function(e){var t=e.where(i);new s(t).each(function(e){setTimeout(function(){e.destroy()},1)})})}};function r(e){return Math.floor((e.match(/\|/g)||[]).length/2)}function h(e){return e=(e=e.substring(0,e.lastIndexOf("|"))).substring(0,e.lastIndexOf("|"))}o.reqres.setHandlers({"addedchoices:entity:findAllByListId":function(e){return n.findAllByListId(e)}}),o.commands.setHandlers({})}),Store.module("Entities",function(e,o,t,i,s,r){"use strict";var a=o.Entities.Model.extend({idAttribute:"___id",defaults:{type:"component"},services:{create:function(e,t){var i=s.Deferred();i.done(function(e){o.commands.execute("customizableitemoptions:entity:insert:component",e)}),i.done(t.success);var n=o.db.added.components.insert(s.extend(!0,{},e.toJSON())).first();return i.resolve(n),i.promise()},read:function(e,t){var i=s.Deferred(),n=o.db.added.components(e.id).first();return i.done(t.success),i.resolve(n),i.promise()},update:function(e,t){var i=s.Deferred(),n=o.db.added.components(e.id).update(e.toJSON()).first();return i.done(function(e){o.commands.execute("customizableitemoptions:entity:destroy:component",e),o.commands.execute("customizableitemoptions:entity:insert:component",e)}),i.done(t.success),i.resolve(n),i.promise()},delete:function(e,t){var i=s.Deferred(),n=o.db.added.components(e.id).remove();return i.done(function(e){o.commands.execute("customizableitemoptions:entity:destroy:component",e)}),i.done(t.success),n&&i.resolve(e.toJSON()),i.promise()}},sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)}}),l=o.Entities.Collection.extend({model:a,sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{read:function(e,t){var i=s.Deferred(),n=o.db.added.components().get();return i.done(t.success),i.resolve(n),i.promise()}}}),n={_getComponents:function(e){var t=new l;t.on("reset",e),t.fetch({reset:!0})},findAllByMeal:function(n){var o=s.Deferred();return this._getComponents(function(e){var t=e.where({mealid:n.id}),i=new l(t);o.resolve(i)}),o.promise()},findById:function(e){var i=s.Deferred();return this._getComponents(function(e){var t=unfiltered.get(e);i.resolve(t)}),i.promise()},insertByMeal:function(n){n.alacarte?new a({productCode:n.productCode,cartName:n.cartName,selectedSolutionPath:n.productCode,selectedQuantity:1,mealid:n.___id,included:n.included,addons:n.addons}).save():r.each(n.components,function(e){e.mealid=n.___id;for(var t=e.selectedQuantity,i=0;i<t;i++){new a(s.extend(!0,{},e)).save()}})},insert:function(e){for(var t=e.selectedQuantity,i=0;i<t;i++){new a(s.extend(!0,{},e)).save()}},destroy:function(i){this._getComponents(function(e){var t=e.where(i);new l(t).each(function(e){e.destroy()})})}};o.reqres.setHandlers({"addedcomponents:entity:findById":function(e){return n.findById(e)}}),o.commands.setHandlers({})}),Store.module("Entities",function(e,s,t,i,a,l,n,o){"use strict";var c,r=s.Entities.Model.extend({idAttribute:"___id",services:{create:function(e,t){var i=a.Deferred(),n=s.db.added.condiments.insert(a.extend(!0,{},e.toJSON())).first();return i.done(t.success),i.resolve(n),i.promise()},read:function(e,t){var i=a.Deferred(),n=s.db.added.condiments(e.id);return i.done(t.success),i.resolve(n),i.promise()},update:function(e,t){var i=a.Deferred(),n=s.db.added.condiments(e.id).update(e.toJSON()).first();return i.done(t.success),i.resolve(n),i.promise()},delete:function(e,t){var i=a.Deferred();return s.db.added.condiments(e.id).remove()&&i.resolve(e.toJSON()),i.done(t.success),i.promise()}},sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)}}),d=s.Entities.Collection.extend({model:r,services:{read:function(e,t){var i=a.Deferred(),n=s.db.added.condiments().get();return i.done(t.success),i.resolve(n),i.promise()}},sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)}}),u={_getCondiments:function(o){var e=a.Deferred();return a.ajax(s.config.api.condiments.edit).done(function(e,t,i){var n=e.cartItems;s.commands.execute("addedcondiments:entity:reset"),a.when(s.request("availablecondiments:entity:findAll")).done(function(e){l.each(n,function(e){var t=s.db.available.condiments().filter({productCode:e.productCode}).first();delete t.___id;for(var i=a.extend(!0,{},t,e),n=0;n<e.selectedQuantity;n++){var o=a.extend(!0,{},i);o.selectedQuantity=1,c.create(o)}}),o.call(c,c)})}),e.promise()},findAll:function(){var e=a.Deferred();return this._getCondiments(function(){e.resolve(c)}),e.promise()},update:function(e,t,i){var n=e.unset("___id").toJSON();if(0<t)for(var o=0;o<t;o++)c.create(a.extend(!0,{},n));else{var s=c.where({productCode:e.get("productCode")}),r=l.last(s,Math.abs(t));l.each(r,function(e){e.destroy()})}},save:function(){var i=a.Deferred(),e={status:{refCartId:null,refProductCode:null}},t=l.map(c.toJSON(),function(e,t){return{productCode:e.productCode,selectedQuantity:1}});return e.condimentItems=t,s.config.debug&&(console.log("Saving: "),console.dir(e)),a.ajax(s.config.api.condiments.save,{data:JSON.stringify(e),type:"POST",dataType:"json",contentType:"application/json",complete:function(e,t){i.resolve()}}),i.promise()},init:function(){s.db.added.condiments=o()},reset:function(){this.init(),c&&c.reset()}};e.addInitializer(function(){u.init(),c=new d(s.db.added.condiments().get())}),s.reqres.setHandlers({"addedcondiments:entity:findAll":function(){return u.findAll()},"addedcondiments:save":function(){return u.save()}}),s.commands.setHandlers({"addedcondiments:entity:update":function(e,t,i){u.update(e,t,i)},"addedcondiments:entity:init":function(){u.init()},"addedcondiments:entity:reset":function(){u.reset()}})},WOS,TAFFY),Store.module("Entities",function(e,o,t,i,d,u){"use strict";var h=0,p=o.Entities.Model.extend({idAttribute:"___id",services:{create:function(e,t){var i=d.Deferred();i.done(function(e){"component"==e.type?o.commands.execute("customizableitemoptions:entity:insert:component",e):o.commands.execute("customizableitemoptions:entity:insert:choice",e)}),i.done(t.success);var n=o.db.added.foodItems.insert(d.extend(!0,{},e.toJSON())).first();return i.resolve(n),i.promise()},read:function(e,t){var i=d.Deferred(),n=o.db.added.foodItems(e.id).first();return i.done(t.success),i.resolve(n),i.promise()},update:function(e,t){var i=d.Deferred(),n=o.db.added.foodItems(e.id).update(e.toJSON()).first();return i.done(function(e){"component"==e.type?(o.commands.execute("customizableitemoptions:entity:destroy:component",e),o.commands.execute("customizableitemoptions:entity:insert:component",e)):(o.commands.execute("customizableitemoptions:entity:destroy:choice",e),o.commands.execute("customizableitemoptions:entity:insert:choice",e))}),i.done(t.success),i.resolve(n),i.promise()},delete:function(e,t){var i=d.Deferred(),n=o.db.added.foodItems(e.id).remove();return i.done(function(e){"component"==e.type?o.commands.execute("customizableitemoptions:entity:destroy:component",e):o.commands.execute("customizableitemoptions:entity:destroy:choice",e),o.commands.execute("addedfooditems:entity:destroy",{parentId:e.___id})}),i.done(t.success),n&&i.resolve(e.toJSON()),i.promise()}},sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)}}),r=o.Entities.Collection.extend({model:p,sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{read:function(e,t){var i=d.Deferred(),n=o.db.added.foodItems().order("displayOrder asec").get();return i.done(t.success),i.resolve(n),i.promise()},comparator:"displayOrder"}}),n={_getFoodItems:function(e){var t=new r;t.on("reset",e),t.fetch({reset:!0})},findAllByMeal:function(n,o){var s=d.Deferred();return this._getFoodItems(function(e){var t=e.where({mealid:o.id,type:n}),i=new r(t);s.resolve(i)}),s.promise()},insertComponents:function(e){for(var t=e.selectedQuantity,i=0;i<t;i++){new p(d.extend(!0,{},e)).save()}},updateChoices:function(e,i,t){o.commands.execute("addedfooditems:entity:destroy",{___id:i.___id});var n={___id:i.mealid,choices:[],components:[]};u.each(e,function(t){t.defaultQuantity=1,t.minQuantity=i.minQuantity,t.maxQuantity=i.maxQuantity,t.parentId=i.parentId,t.displayOrder=i.displayOrder,t.type="choice",n.choices.push(t),t.hasOwnProperty("choices")&&t.choices.length&&u.each(t.choices,function(e){e.type="choice",n.choices.push(e)}),t.hasOwnProperty("components")&&t.components.length&&u.each(t.components,function(e){e.mealid=t.mealid,e.parentId=i.parentId,e.type="component",o.commands.execute("addedcomponents:entity:insert",e)})}),n.fooditems=d.merge([],n.choices),this.insertByMeal(n)},insertByMeal:function(t){t.alacarte&&new p({productCode:t.productCode,cartName:t.cartName,selectedSolutionPath:t.productCode,selectedQuantity:1,type:"component",mealid:t.___id,included:t.included,addons:t.addons,maxAddOn:t.maxAddOn}).save();var i=0,c=[];u.each(t.fooditems,function(e){e.mealid=t.___id,e.selectedSolutionCode=e.defaultSolutionCode||e.selectedSolutionCode,e.selectedSolutionCartName=e.defaultSolutionCartName||e.selectedSolutionCartName,e.selectedSolutionPath=e.defaultSolutionPath||e.selectedSolutionPath,e.selectedSolutionHierarchyPath=e.defaultSolutionHierarchyPath||e.selectedSolutionHierarchyPath,e.selectedQuantity=1,e.depth=s(e.selectedSolutionHierarchyPath),i=e.depth>i?e.depth:i});for(var n=1;n<=i;n++){!function(e,l){u.each(e,function(o,e){var t=f(o.selectedSolutionHierarchyPath),i=u.filter(c,function(e){return e.depth==l-1&&e.solutionPath==t});if(i.length)u.each(i,function(e){for(var t=0;t<o.defaultQuantity;t++){var i=d.extend(!0,{parentId:e.id,displayOrder:++h},o),n=new p(i);n.save(),c.push({depth:l,solutionPath:o.selectedSolutionPath,id:n.id})}});else{var n=o.defaultQuantity;"component"==o.type&&(n=o.selectedQuantity);for(var s=0;s<n;s++){var r=d.extend(!0,{parentId:null,displayOrder:++h},o),a=new p(r);a.save(),c.push({depth:l,solutionPath:o.selectedSolutionPath,id:a.id})}}})}(u.filter(t.fooditems,function(e){return e.depth==n}),n)}},insertbyEditCart:function(t){var i=0,a=[];u.each(t.fooditems,function(e){e.mealid=t.___id,e.selectedSolutionCode=e.defaultSolutionCode||e.selectedSolutionCode,e.selectedSolutionCartName=e.defaultSolutionCartName||e.selectedSolutionCartName,e.selectedSolutionPath=e.defaultSolutionPath||e.selectedSolutionPath,e.selectedSolutionHierarchyPath=e.defaultSolutionHierarchyPath||e.selectedSolutionHierarchyPath,e.selectedQuantity=1,e.depth=s(e.selectedSolutionHierarchyPath),e.displayOrder=++h,i=e.depth>i?e.depth:i});for(var n=1;n<=i;n++){!function(e,r){u.each(e,function(e,t){var i,n,o=f(e.selectedSolutionHierarchyPath),s=u.filter(a,function(e){return e.depth==r-1&&e.solutionPath==o});i=s.length?d.extend(!0,{parentId:s[t%s.length].id},e):d.extend(!0,{parentId:null},e),(n=new p(i)).save(),a.push({depth:r,solutionPath:e.selectedSolutionPath,id:n.id})})}(u.filter(t.fooditems,function(e){return e.depth==n}),n)}},destroy:function(i){this._getFoodItems(function(e){var t=e.where(i);new r(t).each(function(e){setTimeout(function(){e.destroy()},5)})})}};function s(e){return e.split(",").length-1}function f(e){return(e=e.substring(0,e.lastIndexOf(","))).replace(/,/g,"")}o.reqres.setHandlers({"addedcomponents:entity:findAllByMeal":function(e){return n.findAllByMeal("component",e)},"addedchoices:entity:findAllByMeal":function(e){return n.findAllByMeal("choice",e)}}),o.commands.setHandlers({"addedchoices:entity:update":function(e,t,i){n.updateChoices(e,t,i)},"addedfooditems:entity:insertbymeal":function(e){n.insertByMeal(e)},"addedfooditems:entity:insertbyeditcart":function(e){n.insertbyEditCart(e)},"addedcomponents:entity:insert":function(e){n.insertComponents(e)},"addedfooditems:entity:destroy":function(e){n.destroy(e)}})}),Store.module("Entities",function(e,l,t,i,c,d,n,o){"use strict";var u,s=l.Entities.Model.extend({idAttribute:"___id",sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{create:function(e,t){var i=c.Deferred();i.done(function(e){l.commands.execute("addedfooditems:entity:insertbymeal",e)}),i.done(t.success);var n=l.db.added.meals.insert(c.extend(!0,{},e.toJSON())).first();return i.resolve(n),i.promise()},read:function(e,t){var i=c.Deferred(),n=l.db.added.meals(e.id);return i.done(t.success),i.resolve(n),i.promise()},update:function(e,t){var i=c.Deferred(),n=l.db.added.meals(e.id).update(e.toJSON()).first();return i.done(t.success),i.resolve(n),i.promise()},delete:function(e,t){var i=c.Deferred(),n=l.db.added.meals(e.id).remove();return i.done(t.success),n&&(l.commands.execute("addedfooditems:entity:destroy",{mealid:e.id}),i.resolve(e.toJSON())),i.promise()}}}),r=l.Entities.Collection.extend({model:s,sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{read:function(e,t){var i=c.Deferred(),n=l.db.added.meals().get();return i.done(t.success),i.resolve(n),i.promise()}}}),a={_getMeals:function(e){var t=new r;t.on("reset",e),t.fetch({reset:!0})},_getMealsByCartId:function(e,n){c.ajax(l.config.api.cart.edit,{data:{cartId:e}}).done(function(i,e,t){c.when(l.request("availablemeals:entity:findOne",i.status.refProductCode)).then(function(e){var t=i.cartItems;d.each(t,function(e){var t=c.extend(!0,{},l.db.available.meals().filter({productCode:e.productCode}).first());delete t.___id,delete t.choices,delete t.components,delete t.fooditems;var i=c.extend(!0,{},t,e),n=i.choices.slice(0),o=i.components.slice(0);delete i.choices,d.each(o,function(e){e.type="component"}),d.each(n,function(e){e.type="choice"});for(var s=0;s<e.selectedQuantity;s++){var r=c.extend(!0,{},i);r.selectedQuantity=1;var a=u.create(r);l.commands.execute("addedfooditems:entity:insertbyeditcart",c.extend(!0,{},a.toJSON(),{fooditems:c.merge(c.merge([],o),n)}))}}),n.call(u,u,e)})})},findAll:function(){var e=c.Deferred();return e.resolve(u),e.promise()},findAllByCartId:function(e){var i=c.Deferred();return this._getMealsByCartId(e,function(e,t){i.resolve(t,u)}),i.promise()},update:function(e,t,i){var n=e.unset("___id").toJSON();if(0<t)for(var o=0;o<t;o++)u.create(c.extend(!0,{},n));else{var s=u.where({productCode:e.get("productCode")}),r=d.last(s,Math.abs(t));d.each(r,function(e){e.destroy()})}},init:function(){l.db.added.meals=o(),l.db.added.choices=o(),l.db.added.components=o(),l.db.added.foodItems=o(),l.db.added.customization=o()},reset:function(){this.init(),u&&u.reset()}};e.addInitializer(function(){a.init(),(u=new r).fetch()}),l.reqres.setHandlers({"addedmeals:entity:findAll":function(){return a.findAll()},"addedmeals:entity:findAllByCartId":function(e){return a.findAllByCartId(e)}}),l.commands.setHandlers({"addedmeals:entity:update":function(e,t,i){a.update(e,t,i)},"addedmeals:entity:init":function(){a.init()},"addedmeals:entity:reset":function(){a.reset()}})},WOS,TAFFY),Store.module("Entities",function(e,o,t,i,l,c){"use strict";var d=0,u=o.Entities.Model.extend({idAttribute:"___id",services:{create:function(e,t){var i=l.Deferred();i.done(function(e){o.commands.execute("customizablepromotionalitemoptions:entity:insert:choice",e)}),i.done(t.success);var n=o.db.added.promotionalChoices.insert(l.extend(!0,{},e.toJSON())).first();return i.resolve(n),i.promise()},read:function(e,t){var i=l.Deferred(),n=o.db.added.promotionalChoices(e.id).first();return i.done(t.success),i.resolve(n),i.promise()},update:function(e,t){var i=l.Deferred(),n=o.db.added.promotionalChoices(e.id).update(e.toJSON()).first();return i.done(function(e){o.commands.execute("customizablepromotionalitemoptions:entity:destroy:choice",e),o.commands.execute("customizablepromotionalitemoptions:entity:insert:choice",e)}),i.done(t.success),i.resolve(n),i.promise()},delete:function(e,t){var i=l.Deferred(),n=o.db.added.promotionalChoices(e.id).remove();return i.done(function(e){o.commands.execute("customizablepromotionalitemoptions:entity:destroy:choice",e),o.commands.execute("addedpromotionalcomponents:entity:destroy",{parentId:e.___id}),o.commands.execute("addedpromotionalchoices:entity:destroy",{parentId:e.___id})}),i.done(t.success),n&&i.resolve(e.toJSON()),i.promise()}},sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)}}),s=o.Entities.Collection.extend({model:u,sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{read:function(e,t){var i=l.Deferred(),n=o.db.added.promotionalChoices().order("selectedSolutionPath asec").get();return i.done(t.success),i.resolve(n),i.promise()}},comparator:"displayOrder"}),n={_getChoices:function(e){var t=new s;t.on("reset",e),t.fetch({reset:!0})},findAllByMeal:function(n){var o=l.Deferred();return this._getChoices(function(e){var t=e.where({mealid:n.id}),i=new s(t);o.resolve(i)}),o.promise()},findAllByListId:function(n){var o=l.Deferred();return this._getChoices(function(e){var t=e.where({mealid:n.get("mealid"),productCode:n.get("productCode")}),i=new s(t);o.resolve(i)}),o.promise()},update:function(e,i,t){o.commands.execute("addedpromotionalchoices:entity:destroy",{___id:i.___id});var n={___id:i.mealid,choices:[],components:[]};c.each(e,function(t){t.defaultQuantity=1,t.minQuantity=i.minQuantity,t.maxQuantity=i.maxQuantity,t.parentId=i.parentId,t.displayOrder=i.displayOrder,n.choices.push(t),t.hasOwnProperty("choices")&&t.choices.length&&c.each(t.choices,function(e){n.choices.push(e)}),t.hasOwnProperty("components")&&t.components.length&&c.each(t.components,function(e){e.mealid=t.mealid,e.parentId=i.parentId})}),this.insertByMeal(n)},insertByMeal:function(t){var i=0,a=[];c.each(t.choices,function(e){e.mealid=t.___id,e.selectedSolutionCode=e.defaultSolutionCode||e.selectedSolutionCode,e.selectedSolutionCartName=e.defaultSolutionCartName||e.selectedSolutionCartName,e.selectedSolutionPath=e.defaultSolutionPath||e.selectedSolutionPath,e.selectedQuantity=1,e.depth=r(e.selectedSolutionPath),i=e.depth>i?e.depth:i});for(var n=1;n<=i;n++){!function(e,r){c.each(e,function(o){var t=h(o.selectedSolutionPath),e=c.filter(a,function(e){return e.depth==r-1&&e.solutionPath==t});if(e.length)c.each(e,function(e){for(var t=0;t<o.defaultQuantity;t++){var i=l.extend(!0,{parentId:e.id,displayOrder:++d},o),n=new u(i);n.save(),a.push({depth:r,solutionPath:o.selectedSolutionPath,id:n.id})}});else for(var i=0;i<o.defaultQuantity;i++){var n=l.extend(!0,{parentId:null,displayOrder:++d},o),s=new u(n);s.save(),a.push({depth:r,solutionPath:o.selectedSolutionPath,id:s.id})}})}(c.filter(t.choices,function(e){return e.depth==n}),n)}},insertbyEditCart:function(t){var i=0,a=[];c.each(t.choices,function(e){e.mealid=t.___id,e.selectedSolutionCode=e.defaultSolutionCode||e.selectedSolutionCode,e.selectedSolutionCartName=e.defaultSolutionCartName||e.selectedSolutionCartName,e.selectedSolutionPath=e.defaultSolutionPath||e.selectedSolutionPath,e.selectedQuantity=1,e.depth=r(e.selectedSolutionPath),i=e.depth>i?e.depth:i});for(var n=1;n<=i;n++){!function(e,r){c.each(e,function(e,t){var i,n,o=h(e.selectedSolutionPath),s=c.filter(a,function(e){return e.depth==r-1&&e.solutionPath==o});i=s.length?l.extend(!0,{parentId:s[t%s.length].id},e):l.extend(!0,{parentId:null},e),(n=new u(i)).save(),a.push({depth:r,solutionPath:e.selectedSolutionPath,id:n.id})})}(c.filter(t.choices,function(e){return e.depth==n}),n)}},destroy:function(i){this._getChoices(function(e){var t=e.where(i);new s(t).each(function(e){setTimeout(function(){e.destroy()},1)})})}};function r(e){return Math.floor((e.match(/\|/g)||[]).length/2)}function h(e){return e=(e=e.substring(0,e.lastIndexOf("|"))).substring(0,e.lastIndexOf("|"))}o.reqres.setHandlers({"addedpromotionalchoices:entity:findAllByListId":function(e){return n.findAllByListId(e)}}),o.commands.setHandlers({})}),Store.module("Entities",function(e,o,t,i,s,n){"use strict";var r=o.Entities.Model.extend({idAttribute:"___id",services:{create:function(e,t){var i=s.Deferred();i.done(function(e){o.commands.execute("customizablepromotionalitemoptions:entity:insert:component",e)}),i.done(t.success);var n=o.db.added.promotionalComponents.insert(s.extend(!0,{},e.toJSON())).first();return i.resolve(n),i.promise()},read:function(e,t){var i=s.Deferred(),n=o.db.added.promotionalComponents(e.id).first();return i.done(t.success),i.resolve(n),i.promise()},update:function(e,t){var i=s.Deferred(),n=o.db.added.promotionalComponents(e.id).update(e.toJSON()).first();return i.done(function(e){o.commands.execute("customizablepromotionalitemoptions:entity:destroy:component",e),o.commands.execute("customizablepromotionalitemoptions:entity:insert:component",e)}),i.done(t.success),i.resolve(n),i.promise()},delete:function(e,t){var i=s.Deferred(),n=o.db.added.promotionalComponents(e.id).remove();return i.done(function(e){o.commands.execute("customizablepromotionalitemoptions:entity:destroy:component",e)}),i.done(t.success),n&&i.resolve(e.toJSON()),i.promise()}},sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)}});o.Entities.Collection.extend({model:r,sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{read:function(e,t){var i=s.Deferred(),n=o.db.added.promotionalComponents().order("selectedSolutionPath asec").get();return i.done(t.success),i.resolve(n),i.promise()}}});o.reqres.setHandlers({}),o.commands.setHandlers({})}),Store.module("Entities",function(e,o,t,i,d,u){"use strict";var h=0,p=o.Entities.Model.extend({idAttribute:"___id",services:{create:function(e,t){var i=d.Deferred();i.done(function(e){"component"==e.type?o.commands.execute("customizablepromotionalitemoptions:entity:insert:component",e):o.commands.execute("customizablepromotionalitemoptions:entity:insert:choice",e)}),i.done(t.success);var n=o.db.added.promotionalFoodItems.insert(d.extend(!0,{},e.toJSON())).first();return i.resolve(n),i.promise()},read:function(e,t){var i=d.Deferred(),n=o.db.added.promotionalFoodItems(e.id).first();return i.done(t.success),i.resolve(n),i.promise()},update:function(e,t){var i=d.Deferred(),n=o.db.added.promotionalFoodItems(e.id).update(e.toJSON()).first();return i.done(function(e){"component"==e.type?(o.commands.execute("customizablepromotionalitemoptions:entity:destroy:component",e),o.commands.execute("customizablepromotionalitemoptions:entity:insert:component",e)):(o.commands.execute("customizablepromotionalitemoptions:entity:destroy:choice",e),o.commands.execute("customizablepromotionalitemoptions:entity:insert:choice",e))}),i.done(t.success),i.resolve(n),i.promise()},delete:function(e,t){var i=d.Deferred(),n=o.db.added.promotionalFoodItems(e.id).remove();return i.done(function(e){"component"==e.type?o.commands.execute("customizablepromotionalitemoptions:entity:destroy:component",e):o.commands.execute("customizablepromotionalitemoptions:entity:destroy:choice",e),o.commands.execute("addedpromotionalfooditems:entity:destroy",{parentId:e.___id})}),i.done(t.success),n&&i.resolve(e.toJSON()),i.promise()}},sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)}}),r=o.Entities.Collection.extend({model:p,sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{read:function(e,t){var i=d.Deferred(),n=o.db.added.promotionalFoodItems().order("productCode asec").get();return i.done(t.success),i.resolve(n),i.promise()},comparator:"displayOrder"}}),n={_getFoodItems:function(e){var t=new r;t.on("reset",e),t.fetch({reset:!0})},findAllByMeal:function(n,o){var s=d.Deferred();return this._getFoodItems(function(e){var t=e.where({mealid:o.id,type:n}),i=new r(t);s.resolve(i)}),s.promise()},insertComponents:function(e){for(var t=e.selectedQuantity,i=0;i<t;i++){new p(d.extend(!0,{},e)).save()}},updateChoices:function(e,i,t){o.commands.execute("addedpromotionalfooditems:entity:destroy",{___id:i.___id});var n={___id:i.mealid,choices:[],components:[]};u.each(e,function(t){t.defaultQuantity=1,t.minQuantity=i.minQuantity,t.maxQuantity=i.maxQuantity,t.parentId=i.parentId,t.displayOrder=i.displayOrder,t.type="choice",n.choices.push(t),t.hasOwnProperty("choices")&&t.choices.length&&u.each(t.choices,function(e){e.type="choice",n.choices.push(e)}),t.hasOwnProperty("components")&&t.components.length&&u.each(t.components,function(e){e.mealid=t.mealid,e.parentId=i.parentId,e.type="component",o.commands.execute("addedpromotionalcomponents:entity:insert",e)})}),n.fooditems=d.merge([],n.choices),this.insertByMeal(n)},insertByMeal:function(t){t.alacarte&&new p({productCode:t.productCode,cartName:t.cartName,selectedSolutionPath:t.productCode,selectedQuantity:1,type:"component",mealid:t.___id,included:t.included,addons:t.addons}).save();var i=0,c=[];u.each(t.fooditems,function(e){e.mealid=t.___id,e.selectedSolutionCode=e.defaultSolutionCode||e.selectedSolutionCode,e.selectedSolutionCartName=e.defaultSolutionCartName||e.selectedSolutionCartName,e.selectedSolutionPath=e.defaultSolutionPath||e.selectedSolutionPath,e.selectedSolutionHierarchyPath=e.defaultSolutionHierarchyPath||e.selectedSolutionHierarchyPath,e.selectedQuantity=1,e.depth=s(e.selectedSolutionHierarchyPath),i=e.depth>i?e.depth:i});for(var e=u.sortBy(t.fooditems,"productCode"),n=1;n<=i;n++){!function(e,l){u.each(e,function(o,e){var t=f(o.selectedSolutionHierarchyPath),i=u.filter(c,function(e){return e.depth==l-1&&e.solutionPath==t});if(i.length)u.each(i,function(e){for(var t=0;t<o.defaultQuantity;t++){var i=d.extend(!0,{parentId:e.id,displayOrder:++h},o),n=new p(i);n.save(),c.push({depth:l,solutionPath:o.selectedSolutionPath,id:n.id})}});else{var n=o.defaultQuantity;"component"==o.type&&(n=o.selectedQuantity);for(var s=0;s<n;s++){var r=d.extend(!0,{parentId:null,displayOrder:++h},o),a=new p(r);a.save(),c.push({depth:l,solutionPath:o.selectedSolutionPath,id:a.id})}}})}(u.filter(e,function(e){return e.depth==n}),n)}},insertbyEditCart:function(t){var i=0,a=[];u.each(t.fooditems,function(e){e.mealid=t.___id,e.selectedSolutionCode=e.defaultSolutionCode||e.selectedSolutionCode,e.selectedSolutionCartName=e.defaultSolutionCartName||e.selectedSolutionCartName,e.selectedSolutionPath=e.defaultSolutionPath||e.selectedSolutionPath,e.selectedSolutionHierarchyPath=e.defaultSolutionHierarchyPath||e.selectedSolutionHierarchyPath,e.selectedQuantity=1,e.depth=s(e.selectedSolutionHierarchyPath),e.displayOrder=++h,i=e.depth>i?e.depth:i});for(var n=1;n<=i;n++){!function(e,r){u.each(e,function(e,t){var i,n,o=f(e.selectedSolutionHierarchyPath),s=u.filter(a,function(e){return e.depth==r-1&&e.solutionPath==o});i=s.length?d.extend(!0,{parentId:s[t%s.length].id},e):d.extend(!0,{parentId:null},e),(n=new p(i)).save(),a.push({depth:r,solutionPath:e.selectedSolutionPath,id:n.id})})}(u.filter(t.fooditems,function(e){return e.depth==n}),n)}},destroy:function(i){this._getFoodItems(function(e){var t=e.where(i);new r(t).each(function(e){setTimeout(function(){e.destroy()},5)})})}};function s(e){return e.split(",").length-1}function f(e){return(e=e.substring(0,e.lastIndexOf(","))).replace(/,/g,"")}o.reqres.setHandlers({"addedpromotionalcomponents:entity:findAllByMeal":function(e){return n.findAllByMeal("component",e)},"addedpromotionalchoices:entity:findAllByMeal":function(e){return n.findAllByMeal("choice",e)}}),o.commands.setHandlers({"addedpromotionalchoices:entity:update":function(e,t,i){n.updateChoices(e,t,i)},"addedpromotionalfooditems:entity:insertbymeal":function(e){n.insertByMeal(e)},"addedpromotionalfooditems:entity:insertbyeditcart":function(e){n.insertbyEditCart(e)},"addedpromotionalcomponents:entity:insert":function(e){n.insertComponents(e)},"addedpromotionalfooditems:entity:destroy":function(e){n.destroy(e)}})}),Store.module("Entities",function(e,l,t,i,c,d,n,o){"use strict";var u,s=l.Entities.Model.extend({idAttribute:"___id",sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{create:function(e,t){var i=c.Deferred();i.done(function(e){l.commands.execute("addedpromotionalfooditems:entity:insertbymeal",e)}),i.done(t.success);var n=l.db.added.promotionalItems.insert(c.extend(!0,{},e.toJSON())).first();return i.resolve(n),i.promise()},read:function(e,t){var i=c.Deferred(),n=l.db.added.promotionalItems(e.id);return i.done(t.success),i.resolve(n),i.promise()},update:function(e,t){var i=c.Deferred(),n=l.db.added.promotionalItems(e.id).update(e.toJSON()).first();return i.done(t.success),i.resolve(n),i.promise()},delete:function(e,t){var i=c.Deferred(),n=l.db.added.promotionalItems(e.id).remove();return i.done(t.success),n&&(l.commands.execute("addedpromotionalfooditems:entity:destroy",{mealid:e.id}),i.resolve(e.toJSON())),i.promise()}}}),r=l.Entities.Collection.extend({model:s,sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{read:function(e,t){var i=c.Deferred(),n=l.db.added.promotionalItems().get();return i.done(t.success),i.resolve(n),i.promise()}}}),a={_getMealsByCartId:function(e,n){c.ajax(l.config.api.promotion.edit,{data:{cartId:e}}).done(function(i,e,t){c.when(l.request("availablepromotionalitems:entity:findAll",i.status.promoId)).then(function(e){var t=i.cartItems;d.each(t,function(e){var t=c.extend(!0,{},l.db.available.promotionalItems().filter({productCode:e.productCode}).first());delete t.___id,delete t.choices,delete t.components,delete t.fooditems;u.where({productCode:e.productCode}).length;var i=c.extend(!0,{},t,e),n=i.choices.slice(0),o=i.components.slice(0);delete i.choices,d.each(o,function(e){e.type="component"}),d.each(n,function(e){e.type="choice"});for(var s=0;s<e.selectedQuantity;s++){var r=c.extend(!0,{},i);r.selectedQuantity=1;var a=u.create(r);l.commands.execute("addedpromotionalfooditems:entity:insertbyeditcart",c.extend(!0,{},a.toJSON(),{fooditems:c.merge(c.merge([],o),n)}))}}),n.call(u,u,e,i.status.selectCount,i.status.promoId)})})},update:function(e,t,i){var n=e.unset("___id").toJSON();(s=u.where({productCode:e.get("productCode")})).length;if(0<t)for(var o=0;o<t;o++)u.create(c.extend(!0,{},n));else{var s=u.where({productCode:e.get("productCode")}),r=d.last(s,Math.abs(t));d.each(r,function(e){e.destroy()})}},findAll:function(){var e=c.Deferred();return e.resolve(u),e.promise()},findAllByCartId:function(e){var s=c.Deferred();return this._getMealsByCartId(e,function(e,t,i,n){var o=[t,i,n];s.resolve(o,u)}),s.promise()},init:function(){l.db.added.promotionalItems=o(),l.db.added.promotionalChoices=o(),l.db.added.promotionalComponents=o(),l.db.added.promotionalFoodItems=o(),l.db.added.promotionalCustomization=o()},reset:function(){this.init(),u&&u.reset()}};e.addInitializer(function(){a.init(),(u=new r).fetch()}),l.reqres.setHandlers({"addedpromotionalitems:entity:findAll":function(){return a.findAll()},"addedpromotionalitems:entity:findAllByCartId":function(e){return a.findAllByCartId(e)}}),l.commands.setHandlers({"addedpromotionalitems:entity:update":function(e,t,i){a.update(e,t,i)},"addedpromotionalitems:entity:init":function(){a.init()},"addedpromotionalitems:entity:reset":function(){a.reset()}})},WOS,TAFFY),Store.module("Entities",function(e,o,t,i,a,l,n,s){"use strict";var c,r=o.Entities.Model.extend({idAttribute:"___id",services:{create:function(e,t){var i=a.Deferred(),n=o.db.added.upsells.insert(a.extend(!0,{},e.toJSON())).first();return i.done(t.success),i.resolve(n),i.promise()},read:function(e,t){var i=a.Deferred(),n=o.db.added.upsells(e.id);return i.done(t.success),i.resolve(n),i.promise()},update:function(e,t){var i=a.Deferred(),n=o.db.added.upsells(e.id).update(e.toJSON()).first();return i.done(t.success),i.resolve(n),i.promise()},delete:function(e,t){var i=a.Deferred();o.db.added.upsells(e.id).remove();return i.done(t.success),i.resolve(e.toJSON()),i.promise()}},sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)}}),d=o.Entities.Collection.extend({model:r,services:{read:function(e,t){var i=a.Deferred(),n=new d(o.db.added.upsells().get());return i.done(t.success),i.resolve(n),i.promise()}},sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)}}),u={findAll:function(){var e=a.Deferred();return e.resolve(c),e.promise()},update:function(e,t,i){var n=e.unset("___id").toJSON();if(0<t)for(var o=0;o<t;o++)c.create(a.extend(!0,{},n));else{var s=c.where({productCode:e.get("productCode")}),r=l.last(s,Math.abs(t));l.each(r,function(e){e.destroy()})}},init:function(){o.db.added.upsells=s()},reset:function(){this.init(),c.reset()}};e.addInitializer(function(){u.init(),c=new d(o.db.added.upsells().get())}),o.reqres.setHandlers({"addedupsells:entity:findAll":function(){return u.findAll()}}),o.commands.setHandlers({"addedupsells:entity:update":function(e,t,i){u.update(e,t,i)},"addedupsells:entity:init":function(){u.init()},"addedupsells:entity:reset":function(){u.reset()}})},WOS,TAFFY),Store.module("Entities",function(e,n,t,i,d,u,o,s){"use strict";var r=n.Entities.Model.extend({idAttribute:"productCode"}),h=n.Entities.Collection.extend({model:r}),a={findAll:function(e){var l=d.Deferred(),c=e.get("productCode"),t=e.get("selectedSolutionPath"),i=e.get("selectedSolutionHierarchyPath");return d.ajax(n.config.api.availableChoices.findAll,{data:{solutionPath:t,solutionHierarchyPath:i}}).then(function(e,t,i){var n=e.products,o={noSelection:e.noSelection,displayType:e.displayType},s=[],r=u.map(n,function(e){var t,i;return e.hasOwnProperty("category")&&(t=u.map(e.category,function(e){return e.categoryID}),e.choiceCategoriesID=t,i=u.map(e.category,function(e){return u({}).extend(e)}),d.merge(s,i)),e.isHidden=!1,e.listid=c,e}),s=u.uniq(s,function(e){return e.categoryID}),a=new h(r);l.resolve(a,o,s)}),l.promise()},init:function(){n.db.available.choices=s()},reset:function(){this.init()}};n.reqres.setHandlers({"availablechoices:entity:findAll":function(e){return a.findAll(e)}}),n.commands.setHandlers({"availablechoices:entity:init":function(){a.init()},"availablechoices:entity:reset":function(){a.reset()}})},WOS,TAFFY),Store.module("Entities",function(e,s,t,i,r,n,o,a){"use strict";var l=s.Entities.Model.extend({idAttribute:"productCode"}),c=s.Entities.Collection.extend({model:l,sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{read:function(e,t){var i=r.Deferred(),n=s.db.available.condiments().get();return i.done(t.success),i.resolve(n),i.promise()}}}),d={_getCondiments:function(){var o=r.Deferred();return!!s.db.available.condiments().count()?o.resolve(s.db.available.condiments().get()):r.ajax(s.config.api.condiments.findAll).done(function(e,t,i){var n=e.products;s.db.available.condiments.insert(n),o.resolve(n)}),o.promise()},findAll:function(){var i=r.Deferred();return this._getCondiments().done(function(e){var t=new c(e);i.resolve(t)}),i.promise()},init:function(){s.db.available.condiments=a()},reset:function(){this.init()}};s.reqres.setHandlers({"availablecondiments:entity:findAll":function(e){return d.findAll(e)}}),s.commands.setHandlers({"availablecondiments:entity:init":function(){d.init()},"availablecondiments:entity:reset":function(){d.reset()}})},WOS,TAFFY),Store.module("Entities",function(e,r,t,i,a,l,n,o){"use strict";var s=r.Entities.Model.extend({idAttribute:"productCode"}),c=r.Entities.Collection.extend({model:s,sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{read:function(e,t){var i=a.Deferred(),n=r.db.available.meals().get();return i.done(t.success),i.resolve(n),i.promise()}}}),d={_getMeals:function(o){var s=a.Deferred();return!!r.db.available.meals().filter({productCode:o}).count()?s.resolve(r.db.available.meals().get()):a.ajax(r.config.api.availableMeals.findAll,{data:{productCode:o}}).done(function(e,t,i){var n=e.products;n?(l.each(n,function(e){e.alacarte=!e.components.length;var n=[];l.each(e.choices,function(e){e.mealid=o,e.type="choice",e.selectedSolutionCode=e.selectedSolutionCode||e.defaultSolutionCode||"",e.selectedSolutionCartName=e.selectedSolutionCartName||e.defaultSolutionCartName||"",e.selectedSolutionPath=e.selectedSolutionPath||e.defaultSolutionPath||""}),l.each(e.components,function(e){e.mealid=o,e.selectedQuantity=1,e.type="component";var t=e.defaultQuantity;delete e.defaultQuantity;for(var i=0;i<t;i++)n.push(a.extend({},e))}),e.components=n,e.fooditems=a.merge(a.merge([],e.components),e.choices)}),r.db.available.meals.insert(n),s.resolve(n)):s.reject()}),s.promise()},findOne:function(i){var n=a.Deferred();return this.findAll(i).done(function(e){var t=e.findWhere({productCode:i});n.resolve(t)}).fail(function(){return n.reject()}),n.promise()},findAll:function(e){var i=a.Deferred();return this._getMeals(e).done(function(e){var t=new c(e);i.resolve(t)}).fail(function(){return i.reject()}),i.promise()},init:function(){r.db.available.meals=o(),r.db.available.defaultChoices=o(),r.db.available.defaultComponents=o()},reset:function(){this.init()}};r.reqres.setHandlers({"availablemeals:entity:findOne":function(e){return d.findOne(e)},"availablemeals:entity:findAll":function(e){return d.findAll(e)}}),r.commands.setHandlers({"availablemeals:entity:init":function(){d.init()},"availablemeals:entity:reset":function(){d.reset()}})},WOS,TAFFY),Store.module("Entities",function(e,s,t,i,r,a){"use strict";var n=s.Entities.Model.extend({idAttribute:"productCode"}),l=s.Entities.Collection.extend({model:n,sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{read:function(e,t){var i=r.Deferred(),n=s.db.available.promotionalItems().get();return i.done(t.success),i.resolve(n),i.promise()}}}),c=0,d=0,o={_getMeals:function(e,n){var o;r.Deferred();!!s.db.available.promotionalItems().count()?(o=s.db.available.promotionalItems().get(),n.call(o,o,c,d)):r.ajax(s.config.api.promotion.findAll,{data:{promoId:e}}).done(function(e,t,i){c=e.status.selectCount,d=e.status.promoId,o=e.products,a.each(o,function(e){e.alacarte=!e.components.length;var n=[];a.each(e.choices,function(e){e.mealid=e.productCode,e.type="choice",e.selectedSolutionCode=e.selectedSolutionCode||e.defaultSolutionCode||"",e.selectedSolutionCartName=e.selectedSolutionCartName||e.defaultSolutionCartName||"",e.selectedSolutionPath=e.selectedSolutionPath||e.defaultSolutionPath||""}),a.each(e.components,function(e){e.mealid=e.productCode,e.selectedQuantity=1,e.type="component";var t=e.defaultQuantity;delete e.defaultQuantity;for(var i=0;i<t;i++)n.push(r.extend({},e))}),e.components=n,e.fooditems=r.merge(r.merge([],e.components),e.choices)}),s.db.available.promotionalItems.insert(o),n.call(o,o,c,d)})},findAll:function(e){var o=r.Deferred();return this._getMeals(e,function(e,t,i){var n=new l(e);o.resolve(n,t,i)}),o.promise()},init:function(){s.db.available.promotionalItems=TAFFY()},reset:function(){this.init()}};e.addInitializer(function(){o.init()}),s.reqres.setHandlers({"availablepromotionalitems:entity:findAll":function(e){return o.findAll(e)}}),s.commands.setHandlers({"availablepromotionalitems:entity:init":function(){o.init()},"availablepromotionalitems:entity:reset":function(){o.reset()}})}),Store.module("Entities",function(e,s,t,i,r,a,n,o){"use strict";var l=s.Entities.Model.extend({idAttribute:"productCode"}),c=s.Entities.Collection.extend({model:l,sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{read:function(e,t){var i=r.Deferred(),n=s.db.available.upsells().get();return i.done(t.success),i.resolve(n),i.promise()}}}),d={_getUpsells:function(e){var o=r.Deferred();return r.ajax(s.config.api.availableUpsells.findAll,{data:{productCode:e}}).done(function(e,t,i){var n=e.products;a.each(n,function(e){a.each(e.choices,function(e){e.selectedSolutionCode=e.selectedSolutionCode||e.defaultSolutionCode||"",e.selectedSolutionCartName=e.selectedSolutionCartName||e.defaultSolutionCartName||"",e.selectedSolutionPath=e.selectedSolutionPath||e.defaultSolutionPath||"",e.selectedQuantity=e.selectedQuantity||e.defaultQuantity||""})}),s.db.available.upsells.insert(n),o.resolve(n)}),o.promise()},findAll:function(e){var i=r.Deferred();return this._getUpsells(e).done(function(e){var t=new c(e);i.resolve(t)}),i.promise()},init:function(){s.db.available.upsells=o()},reset:function(){this.init()}};s.reqres.setHandlers({"availableupsells:entity:findAll":function(e){return d.findAll(e)}}),s.commands.setHandlers({"availableupsells:entity:init":function(){d.init()},"availableupsells:entity:reset":function(){d.reset()}})},WOS,TAFFY),Store.module("Entities",function(e,l,t,i,r,c,n,o){"use strict";l.reqres.setHandlers({"cart:create":function(){var s=r.Deferred();return r.when(l.request("addedmeals:entity:findAll"),l.request("addedupsells:entity:findAll")).done(function(e,t){var a={status:{refCartId:l.globals.cartId,refProductCode:l.globals.productCode},cartItems:[],upsellItems:[]},i=e.toJSON();c.each(i,function(e){var t,i,n,o,s,r={productCode:e.productCode,choices:[],components:[],included:[],addons:[],solutionPath:e.solutionPath,solutionHierarchyPath:e.solutionPath};e.alacarte?(t=l.db.added.foodItems().filter({mealid:e.___id,type:"component"}).first(),i=l.db.added.customization().filter({mealitemid:["component",t.___id].join("_"),mealitemtype:"component",optiongroup:"included"}).get(),c.each(i,function(e){var t={name:e.name,selected:e.selected};r.included.push(t)}),n=l.db.added.customization().filter({mealitemid:["component",t.___id].join("_"),mealitemtype:"component",optiongroup:"addons"}).get(),c.each(n,function(e){var t={name:e.name,selected:e.selected};r.addons.push(t)}),o=l.db.added.foodItems().filter({mealid:e.___id,type:"choice"}).get(),c.each(o,function(e){var t={productCode:e.productCode,maxQuantity:e.maxQuantity,minQuantity:e.minQuantity,selectedQuantity:e.selectedQuantity,selectedSolutionCode:e.selectedSolutionCode,selectedSolutionPath:e.selectedSolutionPath,selectedSolutionHierarchyPath:e.selectedSolutionHierarchyPath,included:[],addons:[]};r.choices.push(t)})):(o=l.db.added.foodItems().filter({mealid:e.___id,type:"choice"}).get(),c.each(o,function(e){var i={productCode:e.productCode,maxQuantity:e.maxQuantity,minQuantity:e.minQuantity,selectedQuantity:e.selectedQuantity,selectedSolutionCode:e.selectedSolutionCode,selectedSolutionPath:e.selectedSolutionPath,selectedSolutionHierarchyPath:e.selectedSolutionHierarchyPath,included:[],addons:[]},t=l.db.added.customization().filter({mealitemid:["choice",e.___id].join("_"),mealitemtype:"choice",optiongroup:"included"}).get();c.each(t,function(e){var t={name:e.name,selected:e.selected};i.included.push(t)});var n=l.db.added.customization().filter({mealitemid:["choice",e.___id].join("_"),mealitemtype:"choice",optiongroup:"addons"}).get();c.each(n,function(e){var t={name:e.name,selected:e.selected};i.addons.push(t)}),r.choices.push(i)}),s=l.db.added.foodItems().filter({mealid:e.___id,type:"component"}).get(),c.each(s,function(e){var i={productCode:e.productCode,selectedQuantity:e.selectedQuantity,selectedSolutionPath:e.selectedSolutionPath,selectedSolutionHierarchyPath:e.selectedSolutionHierarchyPath,included:[],addons:[]},t=l.db.added.customization().filter({mealitemid:["component",e.___id].join("_"),mealitemtype:"component",optiongroup:"included"}).get();c.each(t,function(e){var t={name:e.name,selected:e.selected};i.included.push(t)});var n=l.db.added.customization().filter({mealitemid:["component",e.___id].join("_"),mealitemtype:"component",optiongroup:"addons"}).get();c.each(n,function(e){var t={name:e.name,selected:e.selected};i.addons.push(t)}),r.components.push(i)})),a.cartItems.push(r)});var n,o=t.toJSON();0<o.length&&0==i.length&&(n={productCode:l.globals.productCode,choices:[],components:[],included:[],addons:[],solutionPath:l.globals.productCode,solutionHierarchyPath:l.globals.productCode},a.cartItems.push(n)),c.each(o,function(e){var i={productCode:e.productCode,choices:[],components:[]};c.each(e.choices,function(e){for(var t=0;t<e.defaultQuantity;t++)i.choices.push(r.extend({},e,{selectedQuantity:1}))}),c.each(e.components,function(e){for(var t=0;t<e.defaultQuantity;t++)i.components.push(r.extend({},e,{selectedQuantity:1}))}),a.upsellItems.push(i)}),s.resolve(a)}),s.promise()},"cart:save":function(){var i=r.Deferred();return r.when(l.request("cart:create")).done(function(e){l.config.debug&&(console.log("Saving: "),console.dir(e)),r.ajax(l.config.api.cart.save,{data:JSON.stringify(e),type:"POST",dataType:"json",contentType:"application/json",complete:function(e,t){i.resolve()}})}),i.promise()},"suggestioncart:save":function(){var i=r.Deferred();return r.when(l.request("cart:create")).done(function(e){e.cartItems=[],r.ajax(l.config.api.cart.save,{data:JSON.stringify(e),type:"POST",dataType:"json",contentType:"application/json",complete:function(e,t){i.resolve()}})}),i.promise()}})},WOS,TAFFY),Store.module("Entities",function(e,r,t,i,n,o,s,a){"use strict";var l={localHash:"",requestStatus:"completed"},c={findAll:function(){var t=n.Deferred();return l.localHash=(new Date).getTime(),this._getCosts(function(e){t.resolve(e)}),t.promise()},findAllForSuggestions:function(){var t=n.Deferred();return l.localHash=(new Date).getTime(),this._getSuggestionCosts(function(e){t.resolve(e)}),t.promise()},_getCosts:function(o){var s=this;"completed"==l.requestStatus&&n.when(r.request("cart:create")).then(function(e){e.cartItems.length||e.upsellItems.length?(e.status.hash=l.localHash,n.ajax(r.config.api.cart.cost,{data:JSON.stringify(e),method:"POST",contentType:"application/json",dataType:"json",beforeSend:function(){r.config.debug&&console.log("[...] GET COST with ",e.cartItems.length," item(s)."),l.requestStatus="requesting"}}).always(function(){l.requestStatus="completed"}).done(function(e,t,i){var n=e.cost;r.config.debug&&console.log("[ OK ] COST: ",n),parseInt(n.hash,10)!=l.localHash?(l.localHash=(new Date).getTime(),l.requestStatus="completed",s._getCosts(o)):o.call(s,n)})):o.call(s,{subtotal:!1,tax:!1})})},_getSuggestionCosts:function(o){var s=this;"completed"==l.requestStatus&&n.when(r.request("cart:create")).then(function(e){e.upsellItems.length?(e.cartItems=[],e.status.hash=l.localHash,n.ajax(r.config.api.cart.cost,{data:JSON.stringify(e),method:"POST",contentType:"application/json",dataType:"json",beforeSend:function(){r.config.debug&&console.log("[...] GET COST with ",e.cartItems.length," item(s)."),l.requestStatus="requesting"}}).always(function(){l.requestStatus="completed"}).done(function(e,t,i){var n=e.cost;r.config.debug&&console.log("[ OK ] COST: ",n),parseInt(n.hash,10)!=l.localHash?(l.localHash=(new Date).getTime(),l.requestStatus="completed",s._getCosts(o)):o.call(s,n)})):o.call(s,{subtotal:!1,tax:!1})})}};r.reqres.setHandlers({"cost:entity:findAll":function(){return c.findAll()},"suggestioncost:entity:findAll":function(){return c.findAllForSuggestions()}})},WOS,TAFFY),Store.module("Entities",function(e,s,t,i,a,u,n,o){"use strict";var r=s.Entities.Model.extend({idAttribute:"___id",sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{create:function(e,t){var i=a.Deferred(),n=s.db.added.customization.insert(a.extend(!0,{},e.toJSON())).first();return i.done(t.success),i.resolve(n),i.promise()},read:function(e,t){var i=a.Deferred(),n=s.db.added.customization(e.id).first();return i.done(t.success),i.resolve(n),i.promise()},update:function(e,t){var i=a.Deferred(),n=s.db.added.customization(e.id).update(e.toJSON()).first();return i.done(t.success),i.resolve(n),i.promise()},delete:function(e,t){var i=a.Deferred(),n=s.db.added.customization(e.id).remove();return i.done(t.success),n&&i.resolve(e.toJSON()),i.promise()}}}),h=s.Entities.Collection.extend({model:r,sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{read:function(e,t){var i=a.Deferred(),n=s.db.added.customization().get();return i.done(t.success),i.resolve(n),i.promise()}}}),l={_getItems:function(e){var t=new h;t.on("reset",e),t.fetch({reset:!0})},findAllByMealItem:function(s){var r=a.Deferred();return this._getItems(function(e){var t=e.where({mealitemid:s.id,mealitemtype:s.get("type"),optiongroup:"included"}),i=e.where({mealitemid:s.id,mealitemtype:s.get("type"),optiongroup:"addons"}),n=new h(t),o=new h(i);r.resolve(n,o)}),r.promise()},findCustomizedOptionsByMealItem:function(e){var d=a.Deferred(),t=u.bind(function(e,t){var i=e[0].toJSON(),n=e[1].toJSON(),o=t[0],s=t[1],r=u.pluck(o,"name"),a=u.pluck(s,"name"),l=u.filter(i,function(e){return-1<u.indexOf(r,e.name)}),c=u.filter(n,function(e){return-1<u.indexOf(a,e.name)}),i=new h(l),n=new h(c);d.resolve(i,n)},this);return a.when(s.request("customizableitemoptions:entity:findAllByMealItem",e),s.request("customizableitemoptions:entity:diffByMealItem",e)).then(t),d.promise()},diffByMealItem:function(e){var o=a.Deferred(),t=u.bind(function(e,t){var i=u.filter(e.toJSON(),function(e){return e.selected!=e.defaultOption}),n=u.filter(t.toJSON(),function(e){return e.selected!=e.defaultOption});o.resolve(i,n)},this);return a.when(s.request("customizableitemoptions:entity:findAllByMealItem",e)).then(t),o.promise()},insert:function(i,n){u.each(n.included,function(e){var t=a.extend(!0,{},{mealitemid:[i,n.___id].join("_"),mealitemtype:i,optiongroup:"included"},e);new r(t).save()}),u.each(n.addons,function(e){var t=a.extend(!0,{},{mealitemid:[i,n.___id].join("_"),mealitemtype:i,optiongroup:"addons"},e);new r(t).save()})},destroy:function(e,t){s.db.added.customization().filter({mealitemid:[e,t.___id].join("_"),mealitemtype:e}).remove()}};s.reqres.setHandlers({"customizableitemoptions:entity:findAllByMealItem":function(e){return l.findAllByMealItem(e)},"customizableitemoptions:entity:findCustomizedOptionsByMealItem":function(e){return l.findCustomizedOptionsByMealItem(e)},"customizableitemoptions:entity:diffByMealItem":function(e){return l.diffByMealItem(e)}}),s.commands.setHandlers({"customizableitemoptions:entity:insert:component":function(e){l.insert("component",e)},"customizableitemoptions:entity:insert:choice":function(e){l.insert("choice",e)},"customizableitemoptions:entity:destroy:component":function(e){l.destroy("component",e)},"customizableitemoptions:entity:destroy:choice":function(e){l.destroy("choice",e)}})},WOS,TAFFY),Store.module("Entities",function(e,o,t,i,c,d,n,s){"use strict";var r=o.Entities.Model.extend({idAttribute:"itemid",sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{create:function(e,t){},read:function(e,t){},update:function(e,t){},delete:function(e,t){}}}),u=o.Entities.Collection.extend({model:r}),a={findAll:function(e){var l=c.Deferred();return c.when(o.request("addedcomponents:entity:findAllByMeal",e),o.request("addedchoices:entity:findAllByMeal",e)).then(function(e,t){var i=d.filter(e.toJSON(),function(e){return e.addons.length||e.included.length}),n=d.filter(t.toJSON(),function(e){return e.addons.length||e.included.length}),o=d.map(i,function(e,t){return{itemid:"component_"+e.___id,addons:e.addons,included:e.included,mealid:e.mealid,productCode:e.productCode,cartName:e.cartName,type:e.type,maxAddOn:(0<e.maxAddOn?e.maxAddOn:0)||0}}),s=d.map(n,function(e,t){return{itemid:"choice_"+e.___id,addons:e.addons,included:e.included,mealid:e.mealid,productCode:e.selectedSolutionCode,cartName:e.selectedSolutionCartName,type:e.type,maxAddOn:(0<e.maxAddOn?e.maxAddOn:0)||0}}),r=c.merge(c.merge([],o),s),a=new u(r);l.resolve(a)}),l.promise()},findCustomizedItemsByMeal:function(e){var t=c.Deferred(),i=d.bind(function(e){var n=[];e.each(function(i){c.when(o.request("customizableitemoptions:entity:diffByMealItem",i)).then(function(e,t){(e&&e.length||t&&t.length)&&n.push(i.toJSON())})}),t.resolve(new u(n))},this);return c.when(this.findAll(e)).then(i),t.promise()},diffByMeal:function(e){var t=c.Deferred(),i=d.bind(function(e){var i={included:[],addons:[]};e.each(function(e){c.when(o.request("customizableitemoptions:entity:diffByMealItem",e)).then(function(e,t){e&&e.length&&i.included.push(e),e&&t.length&&i.addons.push(t)})}),t.resolve(i)},this);return c.when(o.request("customizableitems:entity:findAllByMeal",e)).then(i),t.promise()}};o.reqres.setHandlers({"customizableitems:entity:findAllByMeal":function(e){return a.findAll(e)},"customizableitems:entity:findCustomizedItemsByMeal":function(e){return a.findCustomizedItemsByMeal(e)},"customizableitems:entity:diffByMeal":function(e){return a.diffByMeal(e)}})},WOS,TAFFY),Store.module("Entities",function(e,o,t,i,a,s,n,r){"use strict";var l=o.Entities.Model.extend({idAttribute:"___id",sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{create:function(e,t){var i=a.Deferred(),n=o.db.added.promotionalCustomization.insert(a.extend(!0,{},e.toJSON())).first();return i.done(t.success),i.resolve(n),i.promise()},read:function(e,t){var i=a.Deferred(),n=o.db.added.promotionalCustomization(e.id).first();return i.done(t.success),i.resolve(n),i.promise()},update:function(e,t){var i=a.Deferred(),n=o.db.added.promotionalCustomization(e.id).update(e.toJSON()).first();return i.done(t.success),i.resolve(n),i.promise()},delete:function(e,t){var i=a.Deferred(),n=o.db.added.promotionalCustomization(e.id).remove();return i.done(t.success),n&&i.resolve(e.toJSON()),i.promise()}}}),c=o.Entities.Collection.extend({model:l,sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{read:function(e,t){var i=a.Deferred(),n=o.db.added.promotionalCustomization().get();return i.done(t.success),i.resolve(n),i.promise()}}}),d={_getItems:function(e){var t=new c;t.on("reset",e),t.fetch({reset:!0})},findAllByMealItem:function(s){var r=a.Deferred();return this._getItems(function(e){var t=e.where({mealitemid:s.id,mealitemtype:s.get("type"),optiongroup:"included"}),i=e.where({mealitemid:s.id,mealitemtype:s.get("type"),optiongroup:"addons"}),n=new c(t),o=new c(i);r.resolve(n,o)}),r.promise()},insert:function(i,n){s.each(n.included,function(e){var t=a.extend(!0,{},{mealitemid:[i,n.___id].join("_"),mealitemtype:i,optiongroup:"included"},e);new l(t).save()}),s.each(n.addons,function(e){var t=a.extend(!0,{},{mealitemid:[i,n.___id].join("_"),mealitemtype:i,optiongroup:"addons"},e);new l(t).save()})},destroy:function(e,t){o.db.added.promotionalCustomization().filter({mealitemid:[e,t.___id].join("_"),mealitemtype:e}).remove()}};o.reqres.setHandlers({"customizablepromotionalitemoptions:entity:findAllByMealItem":function(e){return d.findAllByMealItem(e)}}),o.commands.setHandlers({"customizablepromotionalitemoptions:entity:insert:component":function(e){d.insert("component",e)},"customizablepromotionalitemoptions:entity:insert:choice":function(e){d.insert("choice",e)},"customizablepromotionalitemoptions:entity:destroy:component":function(e){d.destroy("component",e)},"customizablepromotionalitemoptions:entity:destroy:choice":function(e){d.destroy("choice",e)}})},WOS,TAFFY),Store.module("Entities",function(e,t,i,n,c,d,o,s){"use strict";var r=t.Entities.Model.extend({idAttribute:"itemid",sync:function(e,t,i){return t.services[e.toLowerCase()].call(t,t,i)},services:{create:function(e,t){},read:function(e,t){},update:function(e,t){},delete:function(e,t){}}}),u=t.Entities.Collection.extend({model:r}),a=function(e){var l=c.Deferred();return c.when(t.request("addedpromotionalcomponents:entity:findAllByMeal",e),t.request("addedpromotionalchoices:entity:findAllByMeal",e)).then(function(e,t){var i=d.filter(e.toJSON(),function(e){return e.addons.length||e.included.length}),n=d.filter(t.toJSON(),function(e){return e.addons.length||e.included.length}),o=d.map(i,function(e,t){return{itemid:"component_"+e.___id,addons:e.addons,included:e.included,mealid:e.mealid,productCode:e.productCode,cartName:e.cartName,type:"component"}}),s=d.map(n,function(e,t){return{itemid:"choice_"+e.___id,addons:e.addons,included:e.included,mealid:e.mealid,productCode:e.selectedSolutionCode,cartName:e.selectedSolutionCartName,type:"choice"}}),r=c.merge(c.merge([],o),s),a=new u(r);l.resolve(a)}),l.promise()};t.reqres.setHandlers({"customizablepromotionalitems:entity:findAllByMeal":function(e){return a(e)}})},WOS,TAFFY),Store.module("Entities",function(e,t,i,n,o,s,r,a){"use strict";t.commands.setHandlers({"gtm:components":function(e){var t=o.Deferred();return"undefined"!=typeof pushComponentsInfo&&pushComponentsInfo instanceof Function&&pushComponentsInfo(e),t.promise()},"gtm:additem":function(){var e=o.Deferred();return o.when(t.request("cart:create")).done(function(e){"undefined"!=typeof pushAddItemInfo&&pushAddItemInfo instanceof Function&&pushAddItemInfo(e)}),e.promise()}})},WOS,TAFFY),Store.module("Entities",function(e,l,t,i,n,c,o,s){"use strict";l.reqres.setHandlers({"promotionalcart:save":function(){var i=n.Deferred();return n.when(l.request("addedpromotionalitems:entity:findAll")).done(function(e){var a={status:{refCartId:l.globals.promoId,promoId:l.globals.promoId},cartItems:[]},t=e.toJSON();c.each(t,function(e){var t,i,n,o,s,r={productCode:e.productCode,choices:[],components:[],included:[],addons:[],promoType:e.promoType,originalPlu:e.originalPlu,rewardId:e.rewardId,solutionPath:e.solutionPath,solutionHierarchyPath:e.solutionPath};e.alacarte?(t=l.db.added.promotionalFoodItems().filter({mealid:e.___id,type:"component"}).first(),i=l.db.added.promotionalCustomization().filter({mealitemid:["component",t.___id].join("_"),mealitemtype:"component",optiongroup:"included"}).get(),c.each(i,function(e){var t={name:e.name,selected:e.selected};r.included.push(t)}),n=l.db.added.promotionalCustomization().filter({mealitemid:["component",t.___id].join("_"),mealitemtype:"component",optiongroup:"addons"}).get(),c.each(n,function(e){var t={name:e.name,selected:e.selected};r.addons.push(t)}),o=l.db.added.promotionalFoodItems().filter({mealid:e.___id,type:"choice"}).get(),c.each(o,function(e){var t={productCode:e.productCode,maxQuantity:e.maxQuantity,minQuantity:e.minQuantity,selectedQuantity:e.selectedQuantity,selectedSolutionCode:e.selectedSolutionCode,selectedSolutionPath:e.selectedSolutionPath,selectedSolutionHierarchyPath:e.selectedSolutionHierarchyPath,included:[],addons:[]};r.choices.push(t)})):(o=l.db.added.promotionalFoodItems().filter({mealid:e.___id,type:"choice"}).get(),c.each(o,function(e){var i={productCode:e.productCode,maxQuantity:e.maxQuantity,minQuantity:e.minQuantity,selectedQuantity:e.selectedQuantity,selectedSolutionCode:e.selectedSolutionCode,selectedSolutionPath:e.selectedSolutionPath,selectedSolutionHierarchyPath:e.selectedSolutionHierarchyPath,included:[],addons:[]},t=l.db.added.promotionalCustomization().filter({mealitemid:["choice",e.___id].join("_"),mealitemtype:"choice",optiongroup:"included"}).get();c.each(t,function(e){var t={name:e.name,selected:e.selected};i.included.push(t)});var n=l.db.added.promotionalCustomization().filter({mealitemid:["choice",e.___id].join("_"),mealitemtype:"choice",optiongroup:"addons"}).get();c.each(n,function(e){var t={name:e.name,selected:e.selected};i.addons.push(t)}),r.choices.push(i)}),s=l.db.added.promotionalFoodItems().filter({mealid:e.___id,type:"component"}).get(),c.each(s,function(e){var i={productCode:e.productCode,selectedQuantity:e.selectedQuantity,selectedSolutionPath:e.selectedSolutionPath,selectedSolutionHierarchyPath:e.selectedSolutionHierarchyPath,included:[],addons:[]},t=l.db.added.promotionalCustomization().filter({mealitemid:["component",e.___id].join("_"),mealitemtype:"component",optiongroup:"included"}).get();c.each(t,function(e){var t={name:e.name,selected:e.selected};i.included.push(t)});var n=l.db.added.promotionalCustomization().filter({mealitemid:["component",e.___id].join("_"),mealitemtype:"component",optiongroup:"addons"}).get();c.each(n,function(e){var t={name:e.name,selected:e.selected};i.addons.push(t)}),r.components.push(i)})),a.cartItems.push(r)}),l.config.debug&&(console.log("Saving: "),console.dir(a)),n.ajax(l.config.api.promotion.save,{data:JSON.stringify(a),type:"POST",dataType:"json",contentType:"application/json",complete:function(e,t){i.resolve()}})}),i.promise()}})},WOS,TAFFY);